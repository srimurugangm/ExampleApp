function serviceFunc(e,t,n,a,i,o,r,s){function l(e){var a=function(n){if(t.debug("[notification.fct.js] Push received:",n),void 0!==e.config&&e.config.length>0){var a=o.get("ActionFactory");e.config.forEach(function(e){if("push-event"==e["item-type"]){var t={$notification:n},i=!0;e.operations.length>0&&(i=a.evalOperations(e.operations,t)),i===!0&&a.triggerEvent("push-received",e.actions,t)}})}};if(void 0!==window.device&&void 0!==window.device.platform&&void 0!==e&&void 0!==e.settings&&void 0!==e.settings["push-notifications"]){var i=e.settings["push-notifications"],s=null;switch(device.platform.toLowerCase()){case"android":void 0!==i.android&&i.android.enabled===!0&&(s={senderID:i.android.id});break;case"win32nt":void 0!==i.wp&&i.wp.enabled===!0&&(s={channelName:i.wp.channelName});break;case"ios":void 0!==i.ios&&i.ios.enabled===!0&&(s={badge:"true",sound:"true",alert:"true"})}if(null!==s){var l=r.getSource("notification");l!==!1&&(t.debug("Registering for push notifications..."),l.registerForPush(function(e){t.debug("Registered for push:",e),n.set("notification.token",e),l.on("pushReceived",a)},function(e){t.error("Error registering for push:",e)},s))}}}function c(){return r.getSource("notification")!==!1}function u(e){for(var t=5381,n=0;n<e.length;n++){var a=e.charCodeAt(n);t=(t<<5)+t+a}return t}function d(){var e=r.getSource("notification");f===!1&&c()&&(e.on("interactedWith",function(e){var t=i.getSchemaConfigItemsByItemType("device-notification");if(t.length>0){var n=o.get("ActionFactory");angular.forEach(t,function(t){if(void 0!==t.name&&u(t.name)==e.id&&void 0!==t.actions&&t.actions.length>0)if(void 0===e.actionResponseIdentifier)n.triggerEvent("click",t.actions,{$notification:e});else{var a=e.actionResponseIdentifier+"-interaction-pressed";n.triggerEvent(a,t.actions,{$notification:e})}})}}),f=!0)}function p(l){var p=e.defer();if(void 0!==l.name){var m=i.getSchemaConfigItemByName(l.name);if(void 0!==m)if("device-notification"==m["item-type"])if(c()){var f=r.getSource("notification"),g=l.title||m.title;void 0!==g&&g.indexOf("{{")>-1&&(g=n.parse(g)),g=s.translate(g);var v=l.text||m.text;void 0!==v&&v.indexOf("{{")>-1&&(v=n.parse(v)),v=s.translate(v);var h=l.name+"_category",y={id:u(l.name),title:g,text:v};if(void 0!==m.interactions&&m.interactions.length>0&&(y.category={identifier:h,actions:[]},m.interactions.forEach(function(e){var t={title:s.translate(e.label),identifier:e.name,textInput:e.text===!0};y.category.actions.push(t)})),l.options.schedule===!0)if(l.options.dynamic===!0&&void 0!==l.options.model){var b=n.parse(l.options.model);try{var $=new Date(b)}catch(w){t.error("Invalid date provided:",w)}}else{if(void 0!==l.options.date)try{var $=new Date(l.options.date)}catch(w){t.error("Invalid date provided:",w)}else var $=new Date;if(void 0!==$&&void 0!==l.options.time){try{var T=new Date(l.options.time)}catch(w){t.error("Invalid date provided:",w)}$.setHours(T.getHours()),$.setSeconds(T.getSeconds()),$.setMinutes(T.getMinutes())}}void 0!==$&&(y.at=$),f.schedule(y),d(),p.resolve()}else{var S="Native notifications are not available on this platform.";t.info(S),p.reject(S)}else{var x=null;switch(m.style){case"success":case"error":case"warning":x=m.style;break;case"info":default:x="info"}if(null!==x){var g=l.title||m.title||"";angular.isString(g)===!1&&void 0!==g.toString&&(g=g.toString()),g=s.translate(g);var A=l.text||m.text||"";if(angular.isString(A)===!1&&void 0!==A.toString&&(A=A.toString()),A=s.translate(A),void 0!==m.actions&&m.actions.length>0){var E=o.get("ActionFactory");m.options.onHidden=function(e){e===!0&&E.triggerEvent("click",m.actions)}}a[x](A,g,m.options),p.resolve()}}else p.reject("Notification with name '"+l.name+"' could not be found in app config.")}else p.reject("Notification name has not been specified.");return p.promise}var m={call:p,init:l},f=!1;return m}serviceFunc.$inject=["$q","$log","StoreFactory","toastr","SchemaHelper","$injector","Plugin","TranslationService"],function(){"use strict";function e(){return++c}function t(e){return e&&e.window===e}function n(e){return"string"==typeof e}function a(e){if(null==e||t(e))return!1;var a=e.length;return!(1!==e.nodeType||!a)||(n(e)||Array.isArray(e)||0===a||"number"==typeof a&&a>0&&a-1 in e)}function i(){return Object.create(null)}function o(t,n){var a,i=typeof t;return"function"==i||"object"==i&&null!==t?"function"==typeof(a=t.$$hashKey)?a=t.$$hashKey():void 0===a&&(a=t.$$hashKey=(n||e)()):a=t,i+":"+a}function r(e,t,n){var a,i,o=[],r=[];for(a=0;a<t.length;a++)for(i=0;i<e.length;i++)e[i][n]?e[i][n]===t[a]&&r.push(e[i]):o.push(e[i]);return r=r.concat(o)}function s(e){var t=e[0],n=e[e.length-1],a=[t];do{if(t=t.nextSibling,!t)break;a.push(t)}while(t!==n);return angular.element(a)}function l(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}var c=0,u=function(e){return e.clone[0]},d=function(e){return e.clone[e.clone.length-1]},p=function(e,t,n,a,i,o,r,s){e[n]=a,i&&(e[i]=o),e.$index=t,e.$first=0===t,e.$last=t===r-1,e.$middle=!(e.$first||e.$last),e.$odd=!(e.$even=0===(1&t)),s&&(e.$group=s)},m=function(e,t){e.data("isolateScope",t)},f=function(e,t){var n,a=e.length;if(0===a)return!1;for(n=0;n<a;n++)if(T(t,e[n]))return!0;return!1},g=function(e,t){var n,a=e.length;if(0===a)return-1;for(n=0;n<a;n++)if(T(t,e[n]))return n;return-1},v=function(e,t,n){var a,i=e,o=typeof n;if(e==t)return null;do if("string"===o){if(a=" "+i.className+" ",1===i.nodeType&&a.replace(/[\t\r\n\f]/g," ").indexOf(n)>=0)return i}else if(i==n)return i;while((i=i.parentNode)&&i!=t&&9!==i.nodeType);return null},h=function(e){var t,n=e.className.replace(/[\t\r\n\f]/g," ").trim();t=n.split(" ");for(var a=0;a<t.length;a++)/\s+/.test(t[a])&&(t.splice(a,1),a--);return t},y=function(e,t){var n=h(e);return n.indexOf(t)!==-1},b=function(e,t){var n,a,i,o=e.children(),r=o.length;if(r>0)for(var s=0;s<r;s++){if(n=o.eq(s),a=!0,i=h(n[0]),i.length>0)for(var l=0;l<t.length;l++)if(i.indexOf(t[l])===-1){a=!1;break}if(a)return n}return[]},$=function(e,t){var n,a,i;if(e.text().toLowerCase().indexOf(t.toLowerCase())!==-1)return!0;for(n=e.children(),i=n.length,a=0;a<i;a++)if(n.eq(a).text().toLowerCase().indexOf(t.toLowerCase())!==-1)return!0;return!1},w=angular.element,T=angular.equals,S=angular.copy,x=angular.extend,A=angular.module("nya.bootstrap.select",[]);A.provider("nyaBsConfig",function(){var e=null,t={"en-us":{defaultNoneSelection:"Nothing selected",noSearchResult:"NO SEARCH RESULT",numberItemSelected:"%d item selected",selectAll:"Select All",deselectAll:"Deselect All"}},n=S(t);this.setLocalizedText=function(e,t){if(!e)throw new Error("localeId must be a string formatted as languageId-countryId");n[e]||(n[e]={}),n[e]=x(n[e],t)},this.useLocale=function(t){e=t},this.$get=["$locale",function(a){var i;return i=e?n[e]:n[a.id],i||(i=t["en-us"]),i}]}),A.controller("nyaBsSelectCtrl",function(){var e=this;e.keyIdentifier=null,e.valueIdentifier=null,e.isMultiple=!1,e.onCollectionChange=function(){},e.setId=function(t){e.id=t||"id#"+Math.floor(1e4*Math.random())}}),A.directive("nyaBsSelect",["$parse","$document","$timeout","nyaBsConfig",function(e,t,n,a){var i="Nothing selected",o='<button class="btn btn-default dropdown-toggle" type="button"><span class="pull-left filter-option"></span>&nbsp;<span class="caret"></span></button>',r='<div class="dropdown-menu open"></div>',s='<div class="bs-searchbox"><input type="text" class="form-control"></div>',c='<ul class="dropdown-menu inner"></ul>',u='<li class="no-search-result"><span>NO SEARCH RESULT</span></li>',d='<div class="bs-actionsbox"><div class="btn-group btn-group-sm btn-block"><button class="actions-btn bs-select-all btn btn-default">SELECT ALL</button><button class="actions-btn bs-deselect-all btn btn-default">DESELECT ALL</button></div></div>';return{restrict:"ECA",require:["ngModel","nyaBsSelect"],controller:"nyaBsSelectCtrl",compile:function(p,m){p.addClass("btn-group");var x,A,E,C,k,I,F,D,_=function(){var e;return e=m.titleTpl?w(m.titleTpl):m.title?document.createTextNode(m.title):R.defaultNoneSelectionTpl?w(R.defaultNoneSelectionTpl):R.defaultNoneSelection?document.createTextNode(R.defaultNoneSelection):document.createTextNode(i)},P=p.children(),N=w(o),M=w(r),O=w(c),R=a,U="undefined"!=typeof m.multiple;for(C=h(p[0]),C.forEach(function(e){/btn-(?:primary|info|success|warning|danger|inverse)/.test(e)&&(p.removeClass(e),N.removeClass("btn-default"),N.addClass(e)),/btn-(?:lg|sm|xs)/.test(e)&&(p.removeClass(e),N.addClass(e)),"form-control"===e&&N.addClass(e)}),O.append(P),k=P.length,I=0;I<k;I++)F=P.eq(I),(F.hasClass("nya-bs-option")||F.attr("nya-bs-option"))&&(F.find("a").attr("tabindex","0"),D=F.attr("value"),angular.isString(D)&&""!==D&&(F.attr("data-value",D),F.removeAttr("value")));return"true"===m.liveSearch&&(x=w(s),R.noSearchResultTpl?u=u.replace("NO SEARCH RESULT",R.noSearchResultTpl):R.noSearchResult&&(u=u.replace("NO SEARCH RESULT",R.noSearchResult)),A=w(u),M.append(x),O.append(A)),"true"===m.actionsBox&&U&&(R.selectAllTpl?d=d.replace("SELECT ALL",R.selectAllTpl):R.selectAll&&(d=d.replace("SELECT ALL",R.selectAll)),R.deselectAllTpl?d=d.replace("DESELECT ALL",R.deselectAllTpl):R.selectAll&&(d=d.replace("DESELECT ALL",R.deselectAll)),E=w(d),M.append(E)),N.children().eq(0).append(_()),M.append(O),p.append(N),p.append(M),function(a,i,o,r){function s(){var e,t,n=j.children(),a=n.length;for(e=0;e<a;e++)if(t=n.eq(e),t.hasClass("active")&&t.hasClass("nya-bs-option")&&!t.hasClass("not-match"))return t;return null}function c(e){for(var t,n=e.childNodes,a=n.length,i=0;i<a;i++)if(t=n[i],1===t.nodeType&&"a"===t.tagName.toLowerCase()){t.focus();break}}function u(e){var t;t=e?j.children().eq(0):j.children().eq(j.children().length-1);for(var n=0;n<j.children().length;n++){var a=j.children().eq(n);if(!a.hasClass("not-match")&&a.hasClass("selected"))return j.children().eq(n)[0]}return!t.hasClass("nya-bs-option")||t.hasClass("disabled")||t.hasClass("not-match")?e?d(t[0],"nextSibling"):d(t[0],"previousSibling"):t[0]}function d(e,t){if(!e||y(e,"nya-bs-option")){for(var n=e;(n=l(n,t))&&n.nodeType;)if(y(n,"nya-bs-option")&&!y(n,"disabled")&&!y(n,"not-match"))return n;return null}}function p(e){if(M&&!P){var t,n,i;if(t=j.find("li"),t.length>0){n=F.$modelValue,i=Array.isArray(n)?S(n):[];for(var o=0;o<t.length;o++){var r=w(t[o]);if(!r.hasClass("disabled")){var s,l;s=h(r),"undefined"!=typeof s&&(l=g(i,s),e&&l==-1?(i.push(s),r.addClass("selected")):e||l==-1||(i.splice(l,1),r.removeClass("selected")))}}F.$setViewValue(i),a.$digest(),A()}}}function m(e){var t,n,o,r=F.$modelValue;t=h(e),"undefined"!=typeof t&&(M?(n=Array.isArray(r)?S(r):[],o=g(n,t),o===-1?(n.push(t),e.addClass("selected")):(n.splice(o,1),e.removeClass("selected"))):(j.children().removeClass("selected"),n=t,e.addClass("selected"))),T(n,r)||i.triggerHandler("change"),F.$setViewValue(n),a.$digest(),M||(i.hasClass("open")&&i.triggerHandler("blur"),i.removeClass("open")),A()}function h(e){var t;return I?(t=e.data("isolateScope"),I(t)):D.valueIdentifier||D.keyIdentifier?(t=e.data("isolateScope"),t[D.valueIdentifier]||t[D.keyIdentifier]):e.attr("data-value")}function x(e){var t=e.find("a");return 0===t.children().length||t.children().eq(0).hasClass("check-mark")?t[0].firstChild.cloneNode(!1):t.children().eq(0)[0].cloneNode(!0)}function A(){var e=F.$modelValue,t=O.children().eq(0);return"undefined"==typeof e?(t.empty(),void t.append(_())):void(M&&0===e.length?(t.empty(),t.append(_())):n(function(){var n,a,i,r,s,l,c=j.children(),u=c.length,d=[];if(M&&"count"===o.selectedTextFormat?l=1:M&&o.selectedTextFormat&&(s=o.selectedTextFormat.match(/\s*count\s*>\s*(\d+)\s*/))&&(l=parseInt(s[1],10)),"undefined"!=typeof l&&e.length>l)return t.empty(),void(R.numberItemSelectedTpl?t.append(w(R.numberItemSelectedTpl.replace("%d",e.length))):R.numberItemSelected?t.append(document.createTextNode(R.numberItemSelected.replace("%d",e.length))):t.append(document.createTextNode(e.length+" items selected")));for(i=0;i<u;i++)a=c.eq(i),a.hasClass("nya-bs-option")&&(n=h(a),M?Array.isArray(e)&&f(e,n)&&(r=a.attr("title"),r?d.push(document.createTextNode(r)):d.push(x(a))):T(e,n)&&(r=a.attr("title"),r?d.push(document.createTextNode(r)):d.push(x(a))));if(0===d.length)t.empty(),t.append(_());else if(1===d.length)t.empty(),t.append(d[0]);else for(t.empty(),i=0;i<d.length;i++)t.append(d[i]),i<d.length-1&&t.append(document.createTextNode(", "))}))}function E(){var e,t,n=j.find("li"),a=n.length;for(t=0;t<a;t++)if(e=n.eq(t),e.hasClass("nya-bs-option")||e.attr("nya-bs-option")){C=e[0].clientHeight;break}if(/\d+/.test(o.size)){var i=parseInt(o.size,10);j.css("max-height",i*C+"px"),j.css("overflow-y","auto")}}var C,k,I,F=r[0],D=r[1],P=!1,N=e(D.valueExp),M="undefined"!=typeof o.multiple,O=b(i,["dropdown-toggle"]),U=O.next(),j=b(U,["dropdown-menu","inner"]),L=b(U,["bs-searchbox"]),q=b(j,["no-search-result"]),V=b(U,["bs-actionsbox"]);D.valueExp&&(I=function(e,t){return N(e,t)}),D.setId(i.attr("id")),M&&(D.isMultiple=!0,F.$isEmpty=function(e){return!e||0===e.length}),O.on("focus",function(){P||i.triggerHandler("focus")}),"undefined"!=typeof o.disabled&&a.$watch(o.disabled,function(e){e?(O.addClass("disabled"),k=O.attr("tabindex"),O.attr("tabindex","-1"),P=!0):(O.removeClass("disabled"),k?O.attr("tabindex",k):O.removeAttr("tabindex"),P=!1)}),D.onCollectionChange=function(e){var t,n,i=[],o=F.$modelValue;if(o){if(Array.isArray(e)&&e.length>0){if(I)for(t=0;t<e.length;t++)i.push(I(a,e[t]));else for(t=0;t<e.length;t++)D.valueIdentifier?i.push(e[t][D.valueIdentifier]):D.keyIdentifier&&i.push(e[t][D.keyIdentifier]);if(M){for(n=o.length,t=0;t<o.length;t++)f(i,o[t])||(o.splice(t,1),t--);n!==o.length&&(o=S(o))}else f(i,o)||(o=i[0])}F.$setViewValue(o),A()}},j.on("click",function(e){if(e.stopPropagation(),!P&&!w(e.target).hasClass("dropdown-header")){var t,n=v(e.target,j[0],"nya-bs-option");if(null!==n){if(t=w(n),t.hasClass("disabled"))return;m(t)}}});var G=function(e){null===v(e.target,i.parent()[0],i[0])&&(i.hasClass("open")&&i.triggerHandler("blur"),i.removeClass("open"))};t.on("click",G),O.on("blur",function(){i.hasClass("open")||i.triggerHandler("blur")}),O.on("click",function(){var e;i.toggleClass("open"),i.hasClass("open")&&"undefined"==typeof C&&E(),"true"===o.liveSearch&&i.hasClass("open")?(e=u(!0),e&&(j.children().removeClass("active"),w(e).addClass("active"))):i.hasClass("open")&&(e=u(!0),e&&c(e))}),"true"===o.actionsBox&&M&&(V.find("button").eq(0).on("click",function(){p(!0)}),V.find("button").eq(1).on("click",function(){p(!1)})),"true"===o.liveSearch&&L.children().on("input",function(){var e,t,n,a=L.children().val(),i=0,o=j.children(),r=o.length;if(a){for(e=0;e<r;e++)t=o.eq(e),t.hasClass("nya-bs-option")&&($(t.find("a"),a)?(t.removeClass("not-match"),i++):t.addClass("not-match"));0===i?q.addClass("show"):q.removeClass("show")}else{for(e=0;e<r;e++)t=o.eq(e),t.hasClass("nya-bs-option")&&t.removeClass("not-match");q.removeClass("show")}n=u(!0),n&&(o.removeClass("active"),w(n).addClass("active"))}),F.$render=function(){var e,t,n=F.$modelValue,a=j.children(),i=a.length;if("undefined"==typeof n)for(e=0;e<i;e++)a.eq(e).hasClass("nya-bs-option")&&a.eq(e).removeClass("selected");else for(e=0;e<i;e++)a.eq(e).hasClass("nya-bs-option")&&(t=h(a.eq(e)),M?f(n,t)?a.eq(e).addClass("selected"):a.eq(e).removeClass("selected"):T(n,t)?a.eq(e).addClass("selected"):a.eq(e).removeClass("selected"));A()},i.on("keydown",function(e){var t=e.keyCode;if(27===t||13===t||38===t||40===t){if(e.preventDefault(),P)return void e.stopPropagation();var n,a,r,l,p=v(e.target,i[0],O[0]);"true"===o.liveSearch?a=v(e.target,i[0],L[0]):n=v(e.target,i[0],U[0]),p?13!==t&&38!==t&&40!==t||i.hasClass("open")||(e.stopPropagation(),i.addClass("open"),"undefined"==typeof C&&E(),"true"===o.liveSearch?(L.children().eq(0)[0].focus(),l=u(!0),l&&(j.children().removeClass("active"),w(l).addClass("active"))):(l=u(!0),l&&c(l))):n?27===t?(O[0].focus(),i.hasClass("open")&&i.triggerHandler("blur"),i.removeClass("open"),e.stopPropagation()):38===t?(e.stopPropagation(),l=d(e.target.parentNode,"previousSibling"),l?c(l):(l=u(!1),l&&c(l))):40===t?(e.stopPropagation(),l=d(e.target.parentNode,"nextSibling"),l?c(l):(l=u(!0),l&&c(l))):13===t&&(e.stopPropagation(),r=w(e.target.parentNode),r.hasClass("nya-bs-option")&&(m(r),M||O[0].focus())):a&&(27===t?(O[0].focus(),i.removeClass("open"),e.stopPropagation()):38===t?(e.stopPropagation(),r=s(),r&&(l=d(r[0],"previousSibling"),l?(r.removeClass("active"),w(l).addClass("active")):(l=u(!1),l&&(r.removeClass("active"),w(l).addClass("active"))))):40===t?(e.stopPropagation(),r=s(),r&&(l=d(r[0],"nextSibling"),l?(r.removeClass("active"),w(l).addClass("active")):(l=u(!0),l&&(r.removeClass("active"),w(l).addClass("active"))))):13===t&&(r=s(),r&&(m(r),M||O[0].focus())))}}),a.$on("$destroy",function(){j.off(),O.off(),L.off(),t.off("click",G)})}}}}]),A.directive("nyaBsOption",["$parse",function(e){var t=/^\s*(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/;return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,require:["^nyaBsSelect","^ngModel"],compile:function(n,l){var c=l.nyaBsOption,g=document.createComment(" end nyaBsOption: "+c+" "),v=c.match(t);if(!v)throw new Error("invalid expression");var h,y,b,$,S,x=l.value,A=x?e(x):null,E=v[3]||v[1],C=v[2],k=v[4],I=v[5]?e(v[5]):null,F=v[6],D={$id:o},_={};return F?$=e(F):(h=function(e,t){return o(t)},y=function(e){return e}),function(e,t,n,o,l){function c(e){var n,o,c,$,x,A,k,I,D,_,N,O,R,U,j,L=t[0],q=i(),V=[];if(S&&(O=[]),a(e))A=e,x=b||h;else{x=b||y,A=[];for(var G in e)e.hasOwnProperty(G)&&"$"!=G.charAt(0)&&A.push(G);A.sort()}for(k=A.length,I=new Array(k),n=0;n<k;n++)if(o=e===A?n:A[n],c=e[o],$=x(o,c,n),j={},C&&(j[C]=o),j[E]=c,V.push(j),S&&(_=S(o,c),O.indexOf(_)===-1&&_&&O.push(_)),M[$])D=M[$],delete M[$],S&&(D.group=_),D.key=o,D.value=c,q[$]=D,I[n]=D;else{if(q[$])throw I.forEach(function(e){e&&e.scope&&(M[e.id]=e)}),new Error("Duplicates in a select are not allowed. Use 'track by' expression to specify unique keys.");I[n]={id:$,scope:void 0,clone:void 0,key:o,value:c},q[$]=!0,_&&(I[n].group=_)}O&&O.length>0&&(I=r(I,O,"group"));for(var B in M)D=M[B],U=s(D.clone),U.removeData("isolateScope"),U.remove(),D.scope.$destroy();for(n=0;n<k;n++)D=I[n],D.scope?(N=L,u(D)!=N&&w(L).after(D.clone),L=d(D),p(D.scope,n,E,D.value,C,D.key,k,D.group)):l(function(e,t){m(e,t),D.scope=t;var a=g.cloneNode(!1);e[e.length++]=a,w(L).after(e),e.addClass("nya-bs-option"),c=v?v(D.key,D.value):D.value||D.key,F.isMultiple?Array.isArray(P.$modelValue)&&f(P.$modelValue,c)&&e.addClass("selected"):T(c,P.$modelValue)&&e.addClass("selected"),L=a,D.clone=e,q[D.id]=D,p(D.scope,n,E,D.value,C,D.key,k,D.group)}),O&&void 0!=O&&O.length>0&&(R&&R===D.group?D.clone.removeClass("first-in-group"):D.clone.addClass("first-in-group"),R=D.group,D.clone.addClass("group-item"));M=q,F.onCollectionChange(V)}var v,F=o[0],P=o[1],N={};$&&(b=function(t,n,a){return C&&(D[C]=t),D[E]=n,D.$index=a,$(e,D)}),I&&(S=function(t,n){return C&&(_[C]=t),_[E]=n,I(e,_)}),C&&(F.keyIdentifier=C),E&&(F.valueIdentifier=E),A&&(F.valueExp=x,v=function(t,n){return C&&(N[C]=t),N[E]=n,A(e,N)});var M=i();"true"===n.deepWatch?e.$watch(k,c,!0):e.$watchCollection(k,c)}}}}])}(),angular.module("angular-datepicker",[]).directive("pickADate",["$timeout",function(e){return{restrict:"A",scope:{pickADate:"=",pickADateOptions:"="},link:function(t,n){function a(n){"function"==typeof p&&p.apply(this,arguments),t.$$phase||t.$root.$$phase||e(function(){n.hasOwnProperty("clear")?t.pickADate=null:n.hasOwnProperty("select")&&(t.pickADate=l(new Date(n.select)))},0)}function i(e){"function"==typeof m&&m.apply(this,arguments)}function o(e){if("function"==typeof f&&f.apply(this,arguments),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard){var t=function(){window.cordova.plugins.Keyboard.close(),window.removeEventListener("native.keyboardshow",this)};window.addEventListener("native.keyboardshow",t),setTimeout(function(){window.removeEventListener("native.keyboardshow",t)},500)}}function r(e){return 1===e.toString().length?"0"+e:e.toString()}function s(e){return e&&e.getUTCDate?new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0):null}function l(e){return e.getFullYear()+"-"+r(e.getMonth()+1)+"-"+r(e.getDate())}function c(e){var t=null,n=/\d{4}-\d{2}-\d{2}/;return"string"==typeof e&&n.test(e)?t=n.exec(e)[0]:e instanceof Date&&(t=e.getFullYear()+"-"+r(e.getMonth()+1)+"-"+r(e.getDate())),t?s(new Date(t)):null}function u(e){var t=c(e);t&&n.pickadate("picker").set("select",t)}var d=t.pickADateOptions||{},p=d.onSet,m=d.onOpen,f=d.onClose;d.min&&"string"==typeof d.min?"current"===d.min?d.min=s(new Date):d.min=c(d.min):d.min="",d.max&&"string"==typeof d.max?"current"===d.max?d.max=s(new Date):d.max=c(d.max):d.max="",d["default"]&&"string"==typeof d["default"]&&!t.pickADate&&("current"===d["default"]?(t.pickADate=l(new Date),t.$parent.updateStore(t.pickADate)):(t.pickADate=l(c(d["default"])),t.$parent.updateStore(t.pickADate))),d.selectYears===!0&&(d.selectYears=200),n.pickadate(angular.extend(d,{onOpen:i,onSet:a,onClose:o,container:document.body})),t.pickADate&&u(t.pickADate),t.$watch("pickADate",function(e,n){e!==n&&(u(e),t.$parent.updateStore(e))})}}}]).directive("pickATime",["$timeout",function(e){return{restrict:"A",scope:{pickATime:"=",pickATimeOptions:"="},link:function(t,n){function a(n){"function"==typeof p&&p.apply(this,arguments),t.$$phase||t.$root.$$phase||e(function(){if(n.hasOwnProperty("clear"))t.pickATime=null;else if(n.hasOwnProperty("select")){var e=n.select,a=Math.floor(e/60),i=e%60;t.pickATime=r(a)+":"+r(i)}},0)}function i(e){"function"==typeof m&&m.apply(this,arguments)}function o(e){if("function"==typeof f&&f.apply(this,arguments),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard){var t=function(){window.cordova.plugins.Keyboard.close(),window.removeEventListener("native.keyboardshow",this)};window.addEventListener("native.keyboardshow",t),setTimeout(function(){window.removeEventListener("native.keyboardshow",t)},500)}}function r(e){return 1===e.toString().length?"0"+e:e.toString()}function s(e){return e&&e.getUTCDate?new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),0,0):null}function l(e){return r(e.getHours())+":"+r(e.getMinutes())}function c(e){var t=null,n=/\d{2}:\d{2}/;return"string"==typeof e&&n.test(e)?t=n.exec(e)[0]:e instanceof Date&&(t=r(e.getHours())+":"+r(e.getMinutes())),t?s(new Date("1970-01-01T"+t+":00Z")):null}function u(e){var t=c(e);t&&n.pickatime("picker").set("select",t)}var d=t.pickATimeOptions||{},p=d.onSet,m=d.onOpen,f=d.onClose;d.min&&"string"==typeof d.min?"current"===d.min?d.min=new Date:d.min=c(d.min):d.min="",d.max&&"string"==typeof d.max?"current"===d.max?d.max=new Date:d.max=c(d.max):d.max="",d["default"]&&"string"==typeof d["default"]&&!t.pickATime&&("current"===d["default"]?(t.pickATime=l(new Date),t.$parent.updateStore(t.pickATime)):(t.pickATime=l(c(d["default"])),t.$parent.updateStore(t.pickATime))),n.pickatime(angular.extend(d,{onSet:a,onOpen:i,onClose:o,container:document.body})),t.pickATime&&u(t.pickATime),t.$watch("pickATime",function(e,n){e!==n&&(u(e),t.$parent.updateStore(e))})}}}]),angular.module("gettext",[]),angular.module("gettext").constant("gettext",function(e){return e}),angular.module("gettext").factory("gettextCatalog",["gettextPlurals","$http","$cacheFactory","$interpolate","$rootScope",function(e,t,n,a,i){function o(e){return void 0===e||null===e||"string"!=typeof e||0==e.trim().length}function r(){i.$broadcast("gettextLanguageChanged")}var s,l="$$noContext",c='<span id="test" title="test" class="tested">test</span>',u=angular.element("<span>"+c+"</span>").html()!==c,d=function(e){return s.debug&&s.currentLanguage!==s.baseLanguage?s.debugPrefix+e+s.debugSuffix:e},p=function(e){return s.showTranslatedMarkers?s.translatedMarkerPrefix+e+s.translatedMarkerSuffix:e};return s={debug:!1,debugPrefix:"[MISSING]: ",debugSuffix:"",showTranslatedMarkers:!1,translatedMarkerPrefix:"[",translatedMarkerSuffix:"]",strings:{},baseLanguage:"en",currentLanguage:"en",cache:n("strings"),setCurrentLanguage:function(e){this.currentLanguage=e,r()},getCurrentLanguage:function(){return this.currentLanguage},setStrings:function(e,t){this.strings[e]||(this.strings[e]={});for(var n in t){var a=t[n];if(u&&(n=angular.element("<span>"+n+"</span>").html()),angular.isString(a)||angular.isArray(a)){var i={};i[l]=a,a=i}for(var o in a){var s=a[o];a[o]=angular.isArray(s)?s:[s]}this.strings[e][n]=a}r()},getStringForm:function(e,t,n){if(o(e))return"";var a=this.strings[this.currentLanguage]||this.strings["*"]||{},i=a[e]||{},r=i[n||l]||[];return r[t]},getString:function(e,t,n){return o(e)?"":(e=this.getStringForm(e,0,n)||d(e),e=t?a(e)(t):e,p(e))},getPlural:function(t,n,i,r,s){if(o(n))return"";var l=e(this.currentLanguage,t);return n=this.getStringForm(n,l,s)||d(1===t?n:i),r&&(r.$count=t,n=a(n)(r)),p(n)},loadRemote:function(e){return t({method:"GET",url:e,cache:s.cache}).success(function(e){for(var t in e)s.setStrings(t,e[t])})}}}]),angular.module("gettext").directive("translate",["gettextCatalog","$parse","$animate","$compile","$window",function(e,t,n,a,i){function o(e,t,n){if(!e)throw new Error("You should add a "+t+" attribute whenever you add a "+n+" attribute.")}var r=function(){return String.prototype.trim?function(e){return"string"==typeof e?e.trim():e}:function(e){return"string"==typeof e?e.replace(/^\s*/,"").replace(/\s*$/,""):e}}(),s=parseInt((/msie (\d+)/.exec(angular.lowercase(i.navigator.userAgent))||[])[1],10);return{restrict:"AE",terminal:!0,compile:function(i,l){o(!l.translatePlural||l.translateN,"translate-n","translate-plural"),o(!l.translateN||l.translatePlural,"translate-plural","translate-n");var c=r(i.html()),u=l.translatePlural,d=l.translateContext;return s<=8&&"<!--IE fix-->"===c.slice(-13)&&(c=c.slice(0,-13)),{post:function(i,o,r){function s(){var t;u?(i=p||(p=i.$new()),i.$count=l(i),t=e.getPlural(i.$count,c,u,null,d)):t=e.getString(c,null,d);var r=angular.element("<span>"+t+"</span>");a(r.contents())(i);var s=o.contents(),m=r.contents();n.enter(m,o),n.leave(s)}var l=t(r.translateN),p=null;r.translateN&&i.$watch(r.translateN,s),i.$on("gettextLanguageChanged",s),s()}}}}}]),angular.module("gettext").filter("translate",["gettextCatalog",function(e){function t(t,n){return e.getString(t,null,n)}return t.$stateful=!0,t}]),angular.module("gettext").factory("gettextPlurals",function(){return function(e,t){switch(e){case"ay":case"bo":case"cgg":case"dz":case"fa":case"id":case"ja":case"jbo":case"ka":case"kk":case"km":case"ko":case"ky":case"lo":case"ms":case"my":case"sah":case"su":case"th":case"tt":case"ug":case"vi":case"wo":case"zh":return 0;case"is":return t%10!=1||t%100==11?1:0;case"jv":return 0!=t?1:0;case"mk":return 1==t||t%10==1?0:1;case"ach":case"ak":case"am":case"arn":case"br":case"fil":case"fr":case"gun":case"ln":case"mfe":case"mg":case"mi":case"oc":case"pt_BR":case"tg":case"ti":case"tr":case"uz":case"wa":case"zh":return t>1?1:0;case"lv":return t%10==1&&t%100!=11?0:0!=t?1:2;case"lt":return t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2;case"be":case"bs":case"hr":case"ru":case"sr":case"uk":return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;case"mnk":return 0==t?0:1==t?1:2;case"ro":return 1==t?0:0==t||t%100>0&&t%100<20?1:2;case"pl":return 1==t?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;case"cs":case"sk":return 1==t?0:t>=2&&t<=4?1:2;case"sl":return t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0;case"mt":return 1==t?0:0==t||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3;case"gd":return 1==t||11==t?0:2==t||12==t?1:t>2&&t<20?2:3;case"cy":return 1==t?0:2==t?1:8!=t&&11!=t?2:3;case"kw":return 1==t?0:2==t?1:3==t?2:3;case"ga":return 1==t?0:2==t?1:t<7?2:t<11?3:4;case"ar":return 0==t?0:1==t?1:2==t?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5;default:return 1!=t?1:0}}});var cti={};angular.module("app",["app.core","app.templates"]),angular.module("cti-directives",[]),angular.module("app.core",["cti-directives","ngSanitize","ngAnimate","ngRoute","ngTouch","LocalStorageModule","vr.directives.slider","tmh.dynamicLocale","angularLoad","angles","toastr","base64","ngMessages","angular-datepicker","nya.bootstrap.select","mobile-router","ngElectron","gettext"]).config(["localStorageServiceProvider","$compileProvider","$logProvider",function(e,t,n){n.debugEnabled(!1),e.setPrefix(""),t.debugInfoEnabled(!1),t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|content|file|ms-appx|cdvfile):/),angular.module("cti-directives").directive=t.directive}]).run(["Router","RouterConfig","SchemaHelper","SchemaService","StoreFactory","StoreProvider","Auth","$rootScope",function(e,t,n,a,i,o,r,s){function l(e,t){try{for(var n=e.split(/\?(.+)?/)[1].split("&"),a=0;a<n.length;a++){var i=n[a];if(i.indexOf(t+"=")>-1){var o=i.split(/=(.+)?/);return o[1]}}}catch(r){return}}function c(e){for(var t={},n=e.split(","),a=0;a<n.length;a++){var i=n[a],o=i.split(/=(.+)?/),r=o[0].split("."),s=o[1];s=u(s),p(t,r,0,s)}return t}function u(e){return d(e)&&(e=parseInt(e)),e}function d(e){return!isNaN(parseFloat(e))&&isFinite(e)}function p(e,t,n,a){n<t.length-1?(e=null==e[t[n]]?e[t[n]]={}:e[t[n]],p(e,t,n+1,a)):e[t[n]]=a}window.handleOpenURL=function(n){setTimeout(function(){var a=l(n,"initial_data"),r=l(n,"page");null!=a&&(a=decodeURIComponent(a));var s=null;if(null!=a&&(s=c(a)),null!=r){r=decodeURIComponent(r);var u=e.getCurrent();void 0!==u?(null!=s&&i.mergeInitialData(s),e.go("/"+r)):(null!=s&&o.set("initialData",s),t.set("startPage","/"+r))}},0)},document.addEventListener("resume",function(){s.$broadcast("device-resume");var t=e.getCurrent();(void 0!==n.schema.settings&&n.schema.settings.auth===!0||void 0!==t&&t.auth===!0)&&r.authenticate("Please re-authenticate").then(function(){})["catch"](function(){e.go("/error")})},!1)}]),angular.module("app.routes",[]).config(["$routeProvider",function(e){e.when("/error",{templateUrl:"components/error/error.tpl.html"}).otherwise({redirectTo:"/"})}]),angular.module("app.core").directive("mdApp",["$rootScope","$compile","$q","$timeout","$log","SchemaService","localStorageService","StudioStorage","Router","Plugin","TranslationService",function(e,t,n,a,i,o,r,s,l,c,u){return{scope:{mdApp:"@",debug:"@",json:"="},restrict:"A",compile:function(){return{pre:function(d,p){function m(){return u.init()}function f(){cti.store.preferences={};var e=c.getSource("preferences");return e?void e.getAllPreferences(function(e){return cti.store.preferences=e,n.resolve()},function(e){return i.error("Error obtaining preferences",e),n.resolve()}):n.resolve()}function g(){l.init(),p.html("<div mobile-view></div>"),t(p.contents())(d),e.currentLanguage&&window.document.body.setAttribute("class","language-"+e.currentLanguage),document.getElementById("splash-screen").style.display="none",window.document.querySelectorAll("body div.view-frame")[0].style.display="block"}var v=!1,h=/iPhone|iPad|iPod|IEMobile|Android/i.test(navigator.userAgent),y=function(){o.initApp(d.mdApp).then(m).then(f).then(g)};if(d.mdApp)h===!0?(document.addEventListener("deviceready",function(){y(),v=!0}),a(function(){v===!1&&y()},5e3)):y();else{var b=r.get("appName");s.init().then(function(){var e=s.getData(b);if("object"!=typeof e&&(e=angular.fromJson(e)),null!==e){var t=function(){o.buildDom(e).then(m).then(f).then(g)};h===!0?(document.addEventListener("deviceready",function(){t(),v=!0}),a(function(){v===!1&&t()},5e3)):t()}else alert("NO APP SCHEMA SET IN LOCAL STORAGE - CANNOT CONTINUE!")})}}}}}}]),angular.module("app.core").controller("PageController",["$scope",function(e){var t=this;t.name=e.$parent.route.id,t.meta={valid:!1}}]),angular.module("app.core").directive("pageInfo",function(){return{restrict:"A",scope:!1,controller:["$scope",function(e){return{name:e.$parent.route.id}}]}}),angular.module("app.core").directive("mdForm",function(){return{restrict:"A",require:"^form",link:function(e,t,n,a){e.$watch(function(){return a.$valid},function(t){
e.$parent.page.meta.valid=t})}}}),angular.module("app.core").directive("isolateForm",[function(){return{restrict:"A",require:"?form",link:function(e,t,n,a){if(a){var i={};angular.copy(a,i);var o=t.parent().controller("form");o.$removeControl(a);var r={$setValidity:function(e,t,n){i.$setValidity(e,t,n),o.$setValidity(e,!0,a)},$setDirty:function(){t.removeClass("ng-pristine").addClass("ng-dirty"),a.$dirty=!0,a.$pristine=!1}};angular.extend(a,r)}}}}]),angular.module("app.core").directive("mdContent",["markdownConverter","$compile","StoreFactory","$timeout","TranslationService","AssetFactory",function(e,t,n,a,i,o){return{restrict:"E",scope:{name:"@",itemType:"@",content:"@",classes:"@"},transclude:!0,link:function(n,a,r,s,l){var c=l();if("markdown"==n.itemType){var u=c.text();u=i.translate(u),c=e.makeHtml(u)}else{var d=c.html();d=i.translate(d),c=d}c=o.rewriteAssetPaths(c),a.append(angular.element('<div class="content-block {{classes}}"></div>').html(c)),t(a.contents())(n)}}}]).provider("markdownConverter",function(){var e={};return{config:function(t){e=t},$get:function(){return new Showdown.converter(e)}}}),angular.module("app.core").directive("starRating",function(){return{restrict:"A",scope:{ratingValue:"=",max:"=",disabled:"=",actions:"=",onRatingSelected:"&"},template:['<ul class="rating">','   <li ng-repeat="star in stars track by $index"        ng-class="star"        ng-click="toggle($index)" ','       md-actions="{{actions}}">','       <i class="fa fa-star" ng-class="{ \'star-disabled\': (disabled) }"></i>',"   </li>","</ul>"].join(""),link:function(e){function t(){e.stars=[];for(var t=0;t<e.max;t++)e.stars.push({filled:t<e.ratingValue})}e.toggle=function(t){e.disabled||(e.ratingValue=t+1,e.onRatingSelected({rating:t+1}))},e.$watch("ratingValue",function(){t()})}}}),angular.module("app.core").directive("takePhoto",["$log","StoreFactory","Camera",function(e,t,n){return{restrict:"E",require:"ngModel",scope:{imageUrl:"=",source:"@",quality:"=","disabled:":"="},template:['<div class="photo-control-container">','   <button class="btn btn-primary btn-lg">','       <span ng-if="sourceIndex == 1">','           <span class="fa fa-camera"></span> {{ "Take Photo" | translate }}',"       </span>",'       <span ng-if="sourceIndex == 2">','           <span class="fa fa-picture-o"></span> {{ "Choose Photo" | translate }}}',"       </span>","   </button>","</div>"].join(""),link:function(e,t){switch(e.imageData=null,e.quality=void 0===e.quality?75:e.quality,e.source){case"gallery":e.sourceIndex=2;break;case"camera":default:e.sourceIndex=1}e.destination=1,e.encodingType=1,t.find("button").on("click",function(){2===e.source?n.selectPhoto().then(function(t){e.loadThumbnail(t)}):n.takePhoto(e.quality).then(function(t){e.loadThumbnail(t)})}),e.loadThumbnail=function(t){e.$parent.$parent.updateStore(t),e.imageData=t},e.removePhoto=function(){e.imageData=null,e.$parent.$parent.updateStore(void 0)};var a=function(){"undefined"!=typeof e.imageUrl&&e.loadThumbnail(e.imageUrl)};document.addEventListener("deviceready",a),window.parent.document.addEventListener("deviceready",a)}}}]),angular.module("app.core").directive("takeBarcode",["$log","Plugin",function(e,t){return{restrict:"E",require:"ngModel",replace:!0,templateUrl:"components/mdDynamicForm/fields/md-barcode.tpl.html",link:function(n,a,i,o){n.codeType=i.codeType,a.on("click",function(){var a=t.getSource("barcodeScanner");a!==!1&&a.scan(function(e){var t="object"==typeof e?e.text:e;n.$parent.$parent.updateStore(t),o.$setViewValue(t)},function(t){o.$setValidity("error",!1),e.error(t)})}),n.clear=function(){n.$parent.$parent.updateStore(""),o.$setViewValue("")}}}}]),angular.module("app.core").directive("mdSignature",function(){return{restrict:"A",disabled:"=",require:"ngModel",link:function(e,t,n,a){var i=t[0],o=new SignaturePad(i);o.onEnd=function(){var e=o.toDataURL();a.$setViewValue(e)};var r=i.getContext("2d");if(window.devicePixelRatio){var s=i.width,l=i.height,c=s,u=l;i.setAttribute("width",s*window.devicePixelRatio),i.setAttribute("height",l*window.devicePixelRatio),t.css("width",c+"px"),t.css("height",u+"px"),r.scale(window.devicePixelRatio,window.devicePixelRatio)}void 0!=e.inputModel&&""!=e.inputModel&&o.fromDataURL(e.inputModel),e.$watch("inputModel",function(e,t){void 0==e?o.clear():e!=t&&o.fromDataURL(e)}),e.$watch("disabled",function(){e.disabled?o.off():o.on()})}}}),angular.module("app.core").directive("mdSelect",["$rootScope","StoreFactory","$parse","$filter","$timeout","OptionFactory","TranslationService",function(e,t,n,a,i,o,r){return{restrict:"A",require:"ngModel",link:function(n,s,l,c){var u=null,d=o.get(n.pageName+"."+n.name);n.options=void 0===d?n.$parent.options:d,angular.forEach(n.options,function(e){e.label=r.translate(e.label),e.hasOwnProperty("group")&&(e.group=r.translate(e.group))}),n.$parent.searchable===!0&&(u=$(s),i(function(){u.selectpicker(),u.change(function(){c.$setViewValue(u.val())})})),"undefined"!=typeof n.$parent.optionsfilter&&(n.selectionValid=function(){var e=n.$parent.inputModel,o=!1;angular.forEach(n.$parent.optionsfilter,function(e,n){var a=t.evaluate(e);"undefined"!=typeof a&&(o===!1&&(o={}),o[n]=a)});var r=!1;if(o!==!1){var s=a("filter")(n.$parent.options,o);angular.forEach(s,function(t){t.value==e&&(r=!0)})}r===!1&&(c.$setViewValue(""),null!==u&&i(function(){u.selectpicker("deselectAll").selectpicker("refresh")}))},n.calcFilter=function(){"undefined"!=typeof n.optionsfilter&&(n.filterString={},angular.forEach(n.optionsfilter,function(e,a){var i=t.evaluate(e);"undefined"!=typeof i&&(n.filterString[a]=i)}),null!==u&&i(function(){u.selectpicker("refresh")}))},e.$on("StoreChanged",function(){n.calcFilter(),n.selectionValid()}),n.calcFilter(),n.selectionValid())}}}]),angular.module("app.core").directive("mdCheckbox",["OptionFactory",function(e){return{restrict:"E",replace:!0,scope:{required:"=",options:"=",disabled:"=",name:"=",model:"=",iconSelected:"@",iconUnselected:"@",actions:"@",validators:"@"},templateUrl:"components/mdDynamicForm/fields/md-checkbox.tpl.html",require:"^form",link:function(t,n,a,i){var o=e.get(t.$parent.$parent.pageName+"."+t.$parent.name);t.options=void 0===o?t.$parent.options:o;var r=function(){var e=!0;t.required!==!0&&"true"!=t.required||(e=!1,angular.forEach(t.model,function(t){t===!0&&(e=!0)})),i[t.name].$setValidity("validationValid",e)};r(),t.makeSelection=function(e){t.disabled||(void 0==t.model&&(t.model={}),t.model[e]=!t.model[e],r())},t.getClasses=function(e){var n={};if(void 0!==e["icon-selected"]?n[e["icon-selected"]]=void 0!=t.model&&1==t.model[e.id]:n[t.iconSelected]=void 0!=t.model&&1==t.model[e.id],void 0!==e["icon-unselected"]?n[e["icon-unselected"]]=void 0===t.model||1!=t.model[e.id]:n[t.iconUnselected]=void 0==t.model||1!=t.model[e.id],1===Object.keys(n).length){var a=void 0!==n[t.iconUnselected]?t.iconUnselected:e["icon-unselected"];n[a]=!0}return n}}}}]),angular.module("app.core").directive("mdRadio",["OptionFactory",function(e){return{restrict:"E",replace:!0,scope:{required:"=",options:"=",disabled:"=",name:"=",model:"=",iconSelected:"@",iconUnselected:"@",validators:"@",actions:"@"},templateUrl:"components/mdDynamicForm/fields/md-radio.tpl.html",require:"^form",link:function(t,n,a,i){var o=e.get(t.$parent.$parent.pageName+"."+t.$parent.name);t.options=void 0===o?t.$parent.options:o;var r=function(){var e=!0;t.required!==!0&&"true"!=t.required||(e="undefined"!=typeof t.model),i[t.name].$setValidity("validationValid",e)};r(),t.makeSelection=function(e){t.disabled||(t.model=e,r())},t.getClasses=function(e){var n={};if(void 0!==e["icon-selected"]?n[e["icon-selected"]]=void 0!=t.model&&t.model==e.value:n[t.iconSelected]=void 0!=t.model&&t.model==e.value,void 0!==e["icon-unselected"]?n[e["icon-unselected"]]=void 0==t.model||t.model!=e.value:n[t.iconUnselected]=void 0==t.model||t.model!=e.value,1===Object.keys(n).length){var a=void 0!==n[t.iconUnselected]?t.iconUnselected:e["icon-unselected"];n[a]=!0}return n}}}}]),angular.module("app.core").directive("validation",["ValidationFactory","$log",function(ValidationFactory,$log){return{restrict:"A",require:"ngModel",link:function($scope,elem,attrs,ctrl){var validationObject=!1;"undefined"!=typeof attrs.validation&&""!=attrs.validation&&(validationObject=angular.fromJson(attrs.validation)),validationObject!==!1&&angular.forEach(validationObject,function(validation){if(void 0!=validation.name&&void 0!=validation.type){var validationFunction=null;if("custom"!=validation.type)validationFunction=function(e,t){return ValidationFactory.isValid(t,validation,$scope.pageName,attrs.name)};else try{var code="validationFunction = "+validation.content;eval(code)}catch(e){$log.error("Could not eval validation function code.")}null!==validationFunction&&(ctrl.$validators[validation.name]=validationFunction)}}),$scope.$on("StoreChanged",function(){angular.forEach(validationObject,function(e){void 0!=e.name&&"regex"!=e.type&&ctrl.$setValidity(e.name,ctrl.$validators[e.name](null,ctrl.$viewValue))})})}}}]),angular.module("app.core").directive("validEmail",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var i=function(e){return a.$setValidity("email",/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)),e};a.$formatters.push(i),a.$parsers.push(i)}}}),angular.module("app.core").directive("mdGroup",["StoreFactory","$rootScope",function(e,t){return{scope:{name:"@",repeat:"=",classes:"@"},restrict:"E",replace:!1,transclude:!0,template:['<div id="{{name}}" class="{{ classes }}">',"   <ng-transclude></ng-transclude>",'   <div ng-if="repeat" class="group-controls">','       <button class="btn btn-success" ng-disabled="form.$invalid" ng-click="addItem()">','           <span class="icon icon-plus-circle2"></span> {{ "Add" | translate }}',"       </button>","   </div>","</div>"].join(""),require:"?form",link:function(t,n,a,i){var o=null,r=t.$parent.$parent.page;t.repeat&&(t.form=i,o="repeater."+r.name+"."+t.name),t.addItem=function(){var t={},a=n.find("md-question");angular.forEach(a,function(n){var a=angular.element(n).attr("name");t[a]=e.get("pages."+r.name+"."+a)}),null!==o&&(e.push(o,t),angular.forEach(a,function(t){var n=angular.element(t).attr("name");e.set("pages."+r.name+"."+n,void 0)}))}}}}]),angular.module("app.core").directive("mdList",["StoreFactory","$interpolate","ActionFactory","$timeout","$log",function(e,t,n,a,i){return{scope:{name:"@",content:"=",model:"@",theme:"@",search:"=",classes:"@",actions:"=",autoscroll:"="},restrict:"E",replace:!1,transclude:!0,templateUrl:"components/area/mdList/mdList.tpl.html",require:"?^scrollableItem",controller:["$scope","$element",function(t,a){var o=angular.element(a)[0].attributes.row;return void 0!=o&&(t.row=o.value),t.listItemClasses="",void 0!=t.classes&&t.classes.length>0&&(t.listItemClasses=t.classes),"bootstrap"==t.theme&&(t.listItemClasses+=" list-group-item ",t.listClasses="list-group"),t.show=!0,t.clickListItem=function(a){if(void 0!=t.actions&&t.actions.length>0){var o=void 0;if(void 0!=t.model)try{o=e.get(t.model)[a]}catch(r){i.error(r)}else o=t.content[a];n.triggerEvent("click",t.actions,{$item:o})}},t.remove=function(n){void 0!=t.model&&e.remove(t.model,n)},t.getItems=function(){return void 0!==t.model?e.get(t.model):t.content},t}],link:function(t,i,o,r){if(t.autoscroll===!0&&(a(function(){r.scrollToBottom()}),void 0!==t.model)){var s=null;t.$watchCollection(function(){return e.get(t.model)},function(){null!==s&&a.cancel(s),s=a(function(){n.triggerEvent("data-changed",t.actions)},500),a(function(){r.scrollToBottom()})})}}}}]),angular.module("app.core").directive("compileListRow",["$compile","$rootScope","AssetFactory",function(e,t,n){return{restrict:"A",scope:{item:"="},require:"^mdList",controller:["$scope",function(e){return{$index:e.$parent.$index}}],link:function(a,i,o,r){a.compile=function(){var s=t.$new(),l=a.item;l.$index=a.$parent.$index,s.$data={$item:l,$items:r.getItems()},s.$store=cti.store;var c=n.rewriteAssetPaths(o.rowTemplate);i.html(c),e(i.contents())(s)},a.compile(),a.$watch("item",function(e,t){e!=t&&a.compile()})}}}]),angular.module("app.core").directive("deleteBtn",function(){return{restrict:"E",scope:{},transclude:!0,require:["^compileListRow","^mdList"],template:'<button class="btn btn-default" ng-click="remove()"><ng-transclude></ng-transclude></button>',link:function(e,t,n,a){e.remove=function(){a[1].remove(a[0].$index)}}}}),angular.module("app.core").directive("mdTitle",["$compile","TranslationService",function(e,t){return{restrict:"E",replace:!1,scope:{classes:"@"},transclude:!0,link:function(n,a,i,o,r){var s=r().html();s='<div class="{{classes}}">'+t.translate(s)+"</div>";var l=e(s)(n);a[0].appendChild(l[0])}}}]),angular.module("app.core").directive("mdQuestion",["$http","$rootScope","$parse","$filter","$timeout","SchemaService","$templateCache","$log","StoreFactory","ActionFactory","TranslationService",function(e,t,n,a,i,o,r,s,l,c,u){return{scope:{itemType:"@",id:"@",name:"@",label:"@",placeholder:"@",message:"@","default":"@",validators:"=",show:"@",disabled:"@",required:"@",model:"@",description:"@","extends":"=",leftIcon:"@",rightIcon:"@",classes:"@",options:"=",optionsfilter:"=",searchable:"=",multiline:"=",debounce:"=",content:"@",max:"@",min:"@",dual:"=",step:"@",actions:"=",optionSource:"@",labelProperty:"@",valueProperty:"@",groupProperty:"@",onText:"@",offText:"@",vertical:"=",iconSelected:"@",iconUnselected:"@",displayValue:"=",decimals:"@"},restrict:"E",template:["<div id=\"{{::name}}\" ng-if=\"show\" class=\"form-group item-{{itemType}} {{classes}}\" ng-class=\"{'has-error': (form[name].$invalid === true && showValidations()), 'has-success': (form[name].$invalid === false && showValidations()), 'no-error': (type == 'static')}\">",'   <label class="control-label">','       {{label | translate}} <span class="required-asterix fa fa-star" ng-if="required == \'true\'  && form[name].$invalid === true"></span>',"   </label>",'   <p class="description" ng-if="description">{{description | translate}}</p>','   <div ng-include="templateUrl"></div>','   <div ng-show="form[name].$invalid === true && showValidations()" ng-messages="form[name].$error">','       <div class="form-input-error" ng-message="required">','           <span class="fa fa-times"></span> {{message | translate}}',"       </div>",'        <div class="form-input-error" ng-message="email">','           <span class="fa fa-times"></span> {{defaultMessage | translate}}',"       </div>",'       <div class="form-input-error" ng-repeat="validation in validators" ng-message-exp="validation.name">','           <span class="fa fa-times"></span> {{validation.message | translate}}',"       </div>","   </div>","</div>"].join(""),require:"^form",link:function(e,t,n,a){function i(e){if("number"==typeof e||"boolean"==typeof e)return!1;if("undefined"==typeof e||null===e)return!0;if("undefined"!=typeof e.length)return 0==e.length;var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return 0==t}function o(e){if(!n)return!1;if(!n.mdExpressions)return!1;var t=JSON.parse(n.mdExpressions);return t.hasOwnProperty(e)}e.setTemplate=function(){switch(e.itemType){case"select":e.templateUrl="components/mdDynamicForm/fields/templates/select.tpl.html",e.defaultMessage="Please make a selection";break;case"radio":e.templateUrl="components/mdDynamicForm/fields/templates/radio.tpl.html",e.defaultMessage="Please make a selection";break;case"checkbox":e.templateUrl="components/mdDynamicForm/fields/templates/checkbox.tpl.html",e.defaultMessage="Please make a selection";break;case"date":e.templateUrl="components/mdDynamicForm/fields/templates/date.tpl.html",e.defaultMessage="Please provide a valid date";break;case"time":e.templateUrl="components/mdDynamicForm/fields/templates/time.tpl.html",e.defaultMessage="Please provide a valid time";break;case"datetime":e.templateUrl="components/mdDynamicForm/fields/templates/datetime.tpl.html",e.defaultMessage="Please provide a valid date & time";break;case"number":e.templateUrl="components/mdDynamicForm/fields/templates/number.tpl.html",e.defaultMessage="Please provide a number";break;case"email":e.templateUrl="components/mdDynamicForm/fields/templates/email.tpl.html",e.defaultMessage="Please provide a valid email address";break;case"slider":e.dual?e.templateUrl="components/mdDynamicForm/fields/templates/range-slider.tpl.html":e.templateUrl="components/mdDynamicForm/fields/templates/slider.tpl.html",e.defaultMessage="Please choose a value";break;case"rating":e.templateUrl="components/mdDynamicForm/fields/templates/rating.tpl.html",e.defaultMessage="Please provide a rating";break;case"barcode":e.templateUrl="components/mdDynamicForm/fields/templates/barcode.tpl.html",e.defaultMessage="Please capture the barcode";break;case"qrcode":e.templateUrl="components/mdDynamicForm/fields/templates/qrcode.tpl.html",e.defaultMessage="Please capture the QR code";break;case"signature":e.templateUrl="components/mdDynamicForm/fields/templates/signature.tpl.html",e.defaultMessage="Please provide your signature";break;case"switch":e.templateUrl="components/mdDynamicForm/fields/templates/switch.tpl.html",e.defaultMessage="Please make a selection";break;case"password":e.templateUrl="components/mdDynamicForm/fields/templates/password.tpl.html",e.defaultMessage="This is a required field";break;case"text":e.multi=void 0!=e.multiline&&e.multiline,e.templateUrl="components/mdDynamicForm/fields/templates/text.tpl.html",e.defaultMessage="This is a required field";break;default:void 0!==e["extends"]&&(e.type=e["extends"].type,e.itemType=e["extends"]["item-type"],e.setTemplate())}},e.setTemplate(),e.message="undefined"!=typeof e.message?e.message:e.defaultMessage,e.form=a;var r=e.$parent.$parent.page||e.$parent.$parent.$parent.page;if(e.pageName=r.name,e.key=e.pageName+"."+e.name,e.inputModel=l.get("pages."+e.key),e.updateStore=function(t){l.set("pages."+e.key,t)},e.$watch("inputModel",function(t,n){if(t!==n){e.updateStore(t);var a=["checkbox","radio","rating","smiley","thumbs","signature","barcode","record-audio"];a.indexOf(e.itemType)!==-1&&c.triggerEvent("change",e.actions)}},!0),void 0===e.inputModel&&void 0!==e["default"]&&!o("default")){var s=u.translate(e["default"]);e.updateStore(s),e.inputModel=s}e.disabled=void 0!=e.disabled&&e.disabled,e.required=void 0!=e.required&&e.required,e.show=void 0==e.show||e.show,e.search=void 0!=e.search&&e.search,e.evalModel=function(){void 0!=e.model&&(e.inputModel=l.evaluate(e.model))},e.userInput=function(){void 0!==a[e.name]&&a[e.name].$setTouched(!0)},e.evalModel(),e.$on("StoreChanged",function(){e.evalModel()}),e.$watch(function(){return l.get("pages."+e.key)},function(t){e.inputModel=t,void 0!==e.form[e.name]&&(e.form[e.name].$pristine=!1)},!0),"select"==e.itemType&&void 0!=e.optionSource&&e.$watchCollection(function(){return l.get(e.optionSource)},function(t){var n=[];void 0!=e.labelProperty||void 0!=e.valueProperty||void 0!=e.groupValue?angular.forEach(t,function(t){var a={value:void 0!=e.valueProperty?t[e.valueProperty]:t.value,label:void 0!=e.labelProperty?t[e.labelProperty]:t.label,group:void 0!=e.groupProperty?t[e.groupProperty]:t.group};n.push(a)}):n=t,e.options=n}),e.showValidations=function(){return!i(e.inputModel)||e.form[e.name].$pristine===!1}}}}]),angular.module("app.core").directive("numberFormat",["$filter",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,a,i){var o=parseInt(a.decimalPlaces);isNaN(o)===!1&&(i.$formatters.push(function(t){var n=parseFloat(t);if(isNaN(n)!==!0)return void 0!==t&&(t=e("number")(t,o),t=parseFloat(t.replace(",",""))),i.$setViewValue(t),t}),i.$parsers.push(function(e){if(void 0!==e&&null!==e){var t=e.toString(),n=t.split(".");if(void 0!==n[1]&&n[1].length>o)return i.$setViewValue(i.$modelValue),i.$render(),i.$modelValue}return e}))}}}]),angular.module("app.core").directive("mdChart",["$http","StoreFactory",function(e,t){return{restrict:"E",replace:!0,scope:{name:"@",title:"@",options:"@","default":"=",width:"@",height:"@",itemType:"@",model:"@",classes:"@"},template:['<div class="chart-block {{classes}}">','   <h4 ng-if="title">{{title | translate}}</h4>','   <canvas chart="{{itemType}}" options="options" data="data" width="width" height="height" responsive="true"></canvas>',"</div>"].join(""),link:function(e){var n=document.body.clientWidth-40;e.width=void 0!=e.width?e.width:n,e.height=void 0!=e.height?e.height:n/100*70;var a=t.get(e.$parent.$parent.page.name+"."+e.name);if(void 0!=a?e.data=a:"undefined"!=typeof e["default"]&&(e.data=e["default"]),void 0!==e.model){var a=t.get(e.model);void 0!==a&&(e.data=a),e.$watch(function(){return t.get(e.model)},function(t){e.data=t})}}}}]),angular.module("app.core").directive("mdCustom",["$http","$templateCache",function(e,t){return{scope:{name:"@",url:"@",data:"="},restrict:"E",template:'<div id="{{name}}" ng-if="show" class="form-group"><div ng-include="templateUrl"></div></div>',link:function(n,a,i){n.show=!0,"undefined"!=typeof i.url&&(void 0===t.get(i.url)&&e.get(i.url).then(function(e){t.put(i.url,e.data)},function(){$log.error('Could not load specified template URL "'+i.url+'": '),i.show=n.show=!1}),n.templateUrl=i.url)}}}]),angular.module("app.core").directive("mdSlider",["$timeout",function(e){return{restrict:"E",scope:{required:"=",name:"=",model:"=",min:"@",max:"@",step:"@",validators:"@",disabled:"=",actions:"="},template:['<slider ng-model="modelValue" ','        ng-disabled="disabled" ','        validation="{{validators}}" ','        md-actions="{{actions}}" ','        ng-swipe-left="cancelSwipe($event)" ','        ng-swipe-right="cancelSwipe($event)" ','        floor="{{min}}" ','        ceiling="{{max}}" ','        step="{{step}}">',"</slider>",'<input type="hidden" ng-model="model" md-actions="{{actions}}" name="{{name}}" ng-required="required" />'].join(""),require:"^form",link:function(t,n,a,i){angular.isObject(t.model)&&(t.modelValue=t.model.lower||0);var o=function(e,a){var o=!0;t.required!==!0&&"true"!==t.required.toLowerCase()||(o=t.model>0),i[t.name].$setValidity("validationValid",o),e!==a&&n.find("input").triggerHandler("change")};t.cancelSwipe=function(){return t.disabled},t.$watch("model",o),e(function(){t.modelValue=t.model,t.$watch("modelValue",function(){t.model=t.modelValue})},0)}}}]).directive("mdRangeSlider",["$timeout","TranslationService",function(e,t){return{restrict:"E",scope:{required:"=",name:"=",model:"=",min:"@",max:"@",step:"@",validators:"@",disabled:"=",actions:"="},template:['<slider ng-model="modelLower" ','        ng-model-range="modelUpper" ','        ng-disabled="disabled" ','        validation="{{validators}}" ','        md-actions="{{actions}}" ','        ng-swipe-left="cancelSwipe($event)" ','        ng-swipe-right="cancelSwipe($event)" ','        translate-range-fn="translateRange(low, high)" ','        floor="{{min}}" ','        ceiling="{{max}}" ','        step="{{step}}">',"</slider>",'<input type="hidden" ng-model="model" md-actions="{{actions}}" name="{{name}}" ng-required="required" />'].join(""),require:"^form",link:function(n,a,i,o){function r(e,t){var i=!0;n.required!==!0&&"true"!==n.required.toLowerCase()||(i=n.model&&(n.model.lower>0||n.model.upper>0)),o[n.name].$setValidity("validationValid",i),angular.equals(e,t)||a.find("input").triggerHandler("change")}"string"==typeof n.model&&(isNaN(n.model)?n.model=JSON.parse(n.model):n.model={lower:0,upper:parseInt(n.model,10)}),n.translateRange=function(e,n){return t.translate("Range")+": "+(n-e)},n.cancelSwipe=function(){return n.disabled},n.$watch("model",r,!0),e(function(){n.model&&(n.modelLower=n.model.lower||0,n.modelUpper=n.model.upper||0),n.$watchGroup(["modelLower","modelUpper"],function(){n.model={lower:n.modelLower,upper:n.modelUpper}})},0)}}}]),angular.module("app.core").directive("mdButton",["$rootScope","StoreFactory","$timeout","TranslationService","$compile",function(e,t,n,a,i){return{restrict:"E",replace:!0,transclude:!0,scope:{id:"@",theme:"@",actions:"=",classes:"@",leftIcon:"@",rightIcon:"@"},template:['<div class="md-button-container">','   <a id="{{id}}" class="btn {{class}} {{classes}}" md-actions="{{actions}}" ng-disabled="disabled"></a>',"</div>"].join(""),require:"^form",link:function(e,t,n,o,r){var s=r().html()||"";s=a.translate(s),e.leftIcon&&(s='<span class="fa '+e.leftIcon+'"></span> '+s),e.rightIcon&&(s=s+' <span class="fa '+e.rightIcon+'"></span>'),t.find("a").html(s),i(t.find("a").contents())(e),e.show=!0,e.disabled=!1,e["class"]=void 0===e.theme||"default"===e.theme?"btn-default":e.theme}}}]),angular.module("app.core").directive("mdActions",["$log","$timeout","ActionFactory",function(e,t,n){return{restrict:"A",link:function(e,a,i){var o={};if(void 0!=i.mdActions&&""!=i.mdActions){var r=angular.fromJson(i.mdActions),s=[];angular.forEach(r,function(e){if(void 0!==e.event&&s.indexOf(e.event)===-1){switch(e.event){case"enter":a.bind("keydown",function(a){var i=a.keyCode||a.which;13===i&&(t.cancel(o[a.type]),o[a.type]=t(function(){n.triggerEvent(e.event,r,null,a)},100))});break;default:a.bind(e.event,function(a){t.cancel(o[a.type]),o[a.type]=t(function(){n.triggerEvent(e.event,r,null,a)},100)})}s.push(e.event)}})}}}}]),angular.module("app.core").factory("InlineCSS",["$rootScope","$injector","AssetFactory",function(e,t,n){function a(e){if(e){var a=t.get("SchemaService");(a.isPreview()||a.isLivePreview())&&(e=n.rewriteAssetPaths(e)),o+=e}}function i(){return o}var o="";return{add:a,get:i}}]),angular.module("app.core").directive("themes",["InlineCSS","$rootScope",function(e,t){return{restrict:"A",link:function(){t.$on("ConfigComplete",function(){var t=e.get();if(t){var n=document.createElement("style");n.textContent=t,document.head.appendChild(n)}})}}}]),angular.module("app.core").directive("mdAttributes",["StoreFactory","$timeout",function(e,t){return{restrict:"A",scope:{mdAttributes:"="},link:function(n,a,i){var o={},r={};i.mdExpressions&&(r=angular.fromJson(i.mdExpressions)),void 0!=n.mdAttributes&&angular.forEach(n.mdAttributes,function(e,t){"string"==typeof e&&e.indexOf("{{")>-1&&(o[t]=e)}),n.setAttributes=function(){angular.forEach(o,function(t,n){i.$set(n,e.parse(t))})},n.evalExpressions=function(){Object.keys(r).length>0&&angular.forEach(r,function(t,n){switch(n){case"show":var i=e.evaluate(t);i===!0?a.removeClass("ng-hide"):a.addClass("ng-hide")}})},n.$on("StoreChanged",function(){n.setAttributes(),n.evalExpressions()}),t(function(){n.setAttributes(),n.evalExpressions()})}}}]),angular.module("app.core").directive("mdExpressions",["$timeout","$filter","StoreFactory","TranslationService",function(e,t,n,a){return{restrict:"A",require:"^form",link:function(t,i,o,r){function s(){angular.forEach(u,function(e,t){e.indexOf("$form.invalid")!==-1&&(e=e.replace(/\$form\.invalid/g,r.$invalid));var a=n.evaluate(e.toString()),o=c[t];angular.equals(a,o)||(c[t]=a,l(t,a,i,d))})}function l(e,t,n,i){switch(e){case"show":t===!0?n.removeClass("ng-hide"):n.addClass("ng-hide");break;case"disabled":i&&(i.disabled=t);break;case"label":i&&(i.originalLabel||(i.originalLabel=i.label),t?i.label=t:i.originalLabel&&(i.label=i.originalLabel));break;case"default":if(i&&void 0===i.inputModel)if("select"===i.itemType){for(var o=0;o<i.options.length;o++)if(i.options[o].value===t){i.inputModel=i.options[o];break}}else i.inputModel=a.translate(t)}}if(o.mdExpressions){var c={},u=angular.fromJson(o.mdExpressions);if(u&&Object.keys(u).length){for(var d=null,p=o.id,m=t.$$childHead;m;m=m.$$nextSibling)if(m.id===p){d=m;break}t.$on("StoreChanged",s),t.$watch(function(){return r.$invalid},s),e(s)}}}}}]),angular.module("app.core").directive("mdDomReady",["$interpolate",function(e){return{restrict:"A",priority:Number.MIN_SAFE_INTEGER,link:function(t,n,a){function i(e){e.forEach(function(e){t.$eval(e)})}var o=a.mdDomReady.split(";"),r=!1,s=!1;0!==a.mdDomReady.trim().length&&(a.waitForInterpolation&&t.$eval(a.waitForInterpolation)&&(r=!0),a.readyCheck&&(s=!0),r||s?requestAnimationFrame(function l(){var c=!1,u=!1;c=!(r&&n.text().indexOf(e.startSymbol())>=0),u=!(s&&!t.$eval(a.readyCheck)),c&&u?i(o):requestAnimationFrame(l)}):i(o))}}}]),angular.module("app.core").directive("openDocument",["electron","Plugin",function(e,t){return{restrict:"E",scope:{classes:"@"},template:['<button class="btn btn-primary {{classes}}" ng-click="open()">',"   <span class=\"icon\" ng-class=\"{'icon-file-pdf': (type == 'pdf'), 'icon-file-word': (type == 'worddocument')}\"></span> Open Document","</button>"].join(""),link:function(n,a,i){n.type=i.itemType,n.open=function(){var n=t.getSource("fileopener");n!==!1?n.openFile(function(){},function(){},i.path):e.shell?e.shell.openItem(i.path):window.open(i.path,"_blank")}}}}]),angular.module("app.core").directive("imageViewer",["StoreFactory","ActionFactory",function(e,t){return{restrict:"E",templateUrl:"components/mdDynamicForm/imageViewer/imageViewer.tpl.html",scope:{src:"@",model:"@",actions:"=",classes:"@",scaleImage:"=",maxWidth:"@",maxHeight:"@"},link:function(n){function a(e){angular.isArray(e)?n.image=e[e.length-1]:n.image=e}if(n.multiple=!1,n.image=void 0,void 0!==n.model){var i=e.get(n.model);a(i),n.$watch(function(){return e.get(n.model)},function(e){a(e)},!0)}else void 0!==n.src&&""!=n.src&&(n.image=n.src);n.open=function(){t.triggerEvent("click",n.actions)},document.addEventListener("media-deleted",function(e){e.detail.location===n.image&&(n.image=void 0)})}}}]),angular.module("app.core").directive("mediaPlayer",["StoreFactory",function(e){return{restrict:"E",templateUrl:"components/mdDynamicForm/mediaPlayer/mediaPlayer.tpl.html",scope:{src:"@",model:"@",multiple:"@",actions:"=",classes:"@",itemType:"@",name:"@"},link:function(t){function n(e){void 0!==e&&(angular.isArray(e)&&e.length>0?t.src=e[e.length-1]:t.src=e)}var a=t.$parent.$parent.page||t.$parent.$parent.$parent.page;if(t.pageName=a.name,t.key=t.pageName+"."+t.name,void 0===t.src&&void 0!==t.model){t.$watch(function(){return e.get(t.model)},function(e){n(e)},!0);var i=e.get(t.model);n(i),t.fileType="video"==t.itemType?"video/mp4":""}}}}]).filter("trusted",["$sce",function(e){return function(t){if(void 0!==t&&"string"==typeof t)return e.trustAsResourceUrl(t)}}]),angular.module("app.core").directive("audioPlayer",["$log","AudioPlayer","$rootScope",function(e,t,n){return{restrict:"E",templateUrl:"components/mdDynamicForm/mediaPlayer/audioPlayer.tpl.html",scope:{src:"@"},controllerAs:"ap",controller:["$scope","$element",function(e,a){var i=this,o={state:null,totalTime:"0:00",duration:0,currentTime:"0:00",position:0};i.info=angular.copy(o);var r=a[0].getElementsByClassName("filler")[0];i.getInfo=function(e){t.getDuration(e,function(e,t){i.info.duration=e,i.info.totalTime=t,i.info.state="stopped"})},i.getInfo(e.src),i.button=function(){if(null!==i.info.state)switch(i.info.state){case"running":t.pause();break;case"paused":t.unpause();break;case"stopped":var a=function(e){i.info.currentTime=e.currentTime,i.info.position=e.position,i.info.state=e.state;var t=Math.round(i.info.position/i.info.duration*100).toFixed(0);t<=100&&(r.style.width=t+"%")};t.play(e.src,function(e){n.$$phase?a(e):n.$apply(function(){a(e)})})}},e.$watch("src",function(e,t){e!==t&&i.getInfo(e)}),document.addEventListener("media-deleted",function(n){n.detail.location===e.src&&(t.stop(),i.info=angular.copy(o),r.style.width="0%")})}]}}]),angular.module("app.core").directive("recordAudio",["StoreFactory","$interval","$log","ActionFactory","$timeout","Plugin","$q","FileSystem","Platform",function(e,t,n,a,i,o,r,s,l){return{restrict:"E",templateUrl:"components/mdDynamicForm/fields/record-audio.tpl.html",scope:{name:"@",label:"@",actions:"=",classes:"@",smallrecorder:"=",multiple:"="},link:function(i){function l(){var e=r.defer(),t=new Date,a=t.getTime(),i=a+".m4a";return s.getStorageLocation().then(function(t){0===t.indexOf("file://")&&(t=t.replace("file://",""));var n=t+i;e.resolve(n)})["catch"](function(e){n.error(e);
}),e.promise}function c(e){var t=Math.floor(e/60),n=Math.floor(e%60);return""+t+":"+(n<10?"0":"")+n}function u(){n.debug("Start recording..."),f().then(function(){var e={SampleRate:44100,NumberOfChannels:1};i.media.startRecordWithCompression(null,e),a.triggerEvent("recording-started",i.actions),null!==v&&t.cancel(v);var n=null;v=t(function(){if(i.state===g.MEDIA_RUNNING){null===n&&(n=Date.now());var e=Date.now(),t=n-e,a=t/1e3,o=Math.abs(a);i.currentTime=c(o)}})})}function d(){i.media.stopRecord(),t.cancel(v)}function p(){n.debug("Finished recording.");var t=e.get(i.model);null!==t&&void 0!==t&&angular.isArray(t)||(t=[]),i.multiple?t.push(i.media.src):t[0]=i.media.src,n.debug("Saving filename:",i.media.src),e.set(i.model,t),i.isPopulated=!0,a.triggerEvent("recording-finished",i.actions)}function m(e){n.debug("Initialise new media object..."),i.media=new g(e,function(){},function(e){n.error(e)},function(e){n.debug("State changing",i.state,e),i.$apply(function(){switch(i.state=e,i.state){case g.MEDIA_STOPPED:p(),i.media.release()}})})}function f(){var e=r.defer();return n.debug("Get file name..."),l().then(function(t){n.debug("Created filename:",t),m(t),e.resolve()}),e.promise}i.media=null;var g=o.getSource("Media"),v=null,h=i.$parent.$parent.page||i.$parent.$parent.$parent.page;i.pageName=h.name,i.model="media."+i.name+".audio";var y=e.get(i.model);null!==y&&void 0!==y&&angular.isArray(y)&&y.length>0&&(i.isPopulated=!0),i.currentTime=c(0),i.uiState=!1,i.recordButton=function(){switch(i.state){case g.MEDIA_RUNNING:d();break;case g.MEDIA_PAUSED:case g.MEDIA_STOPPED:case g.MEDIA_NONE:default:u()}},document.addEventListener("media-deleted",function(t){if(i.multiple!==!0){var n=e.get(i.model)[0];t.detail.location===n&&(i.isPopulated=!1,i.currentTime=c(0))}})}}}]),angular.module("app.core").directive("mediaGallery",["StoreFactory","MediaViewerDisplay","ActionFactory","$rootScope",function(e,t,n,a){return{restrict:"E",templateUrl:"components/mdDynamicForm/imageViewer/imageViewer.tpl.html",scope:{sources:"=",actions:"=",classes:"@"},link:function(i){function o(){i.files=[];var t=[];i.staticFiles.forEach(function(e){i.files.push(e)}),i.models.forEach(function(n){var a=e.get(n);angular.isArray(a)?a.forEach(function(e){void 0!==e&&t.push(e)}):void 0!==a&&t.push(a)}),t.sort(function(e,t){var n=e.split("/"),a=t.split("/"),i=parseInt(n[n.length-1].split(".")[0],10),o=parseInt(a[a.length-1].split(".")[0],10);return i>o?1:i<o?-1:0}),t.forEach(function(e){i.files.push(e)})}i.multiple=!0,i.files=[],i.models=[],i.staticFiles=[];for(var r=0;r<i.sources.length;r++){var s=i.sources[r];if(s.indexOf("{")>-1){var l=s.replace(/\{|}/g,"");i.models.push(l)}else i.staticFiles.push(a.assetDir+s)}void 0!==i.models&&i.models.length>0&&i.models.forEach(function(t){i.$watch(function(){return e.get(t)},function(){o()},!0)}),o(),i.getFileType=function(e){if(void 0===e)return"none";var t=e.split("."),n=t[t.length-1].toLowerCase();return"aac"===n||"m4a"===n||"mp3"===n||"wav"===n?"audio":"image"},i.getViewableFilePath=function(e){if(void 0===e)return"";var t=e.split("/");return t[t.length-1]},i.close=function(){var e=document.querySelector("#mediaViewerDisplayUi");document.body.removeChild(e)},i.open=function(e){var a=i.files[e];void 0!==a&&t.open(a,i.actions).then(function(t){var a=i.actions[t];void 0!==a&&(a.data.index=e,a.data.model=i.model,n.call(a)().then(function(){i.close()})["catch"](function(){i.close()}))})["catch"](function(){i.close()})},document.addEventListener("media-deleted",function(e){var t=i.files.indexOf(e.detail.location);t!==-1&&(i.files=i.files.some(function(t){return t!==e.detail.location}))})}}}]),angular.module("app.core").factory("MediaViewerDisplay",["$q","$compile","$rootScope",function(e,t,n){function a(a,i){var o=e.defer(),r=['<div id="mediaViewerDisplayUi" class="image-viewer-display-container">','   <div class="image-frame">','       <img ng-if="fileType === \'image\'" ng-src="{{src}}" />','       <audio-player ng-if="fileType === \'audio\'" class="col-md-4 col-xs-12" item-type="{{fileType}}" src="{{src | trusted}}"></audio-player>',"   </div>",'   <div class="image-footer">','       <a ng-repeat="action in actions track by $index" href="javascript:void(0)" class="{{action.data.theme || \'\'}}" ng-click="callAction($index)">',"           <span ng-if=\"action.data['left-icon']\" class=\"fa {{action.data['left-icon']}}\"></span> {{action.data.label}} ","           <span ng-if=\"action.data['right-icon']\" class=\"fa {{action.data['right-icon']}}\"></span>","       </a>",'       <a href="javascript:void(0)" ng-click="close()" class="primary">','           <span class="fa fa-close"></span> Close',"       </a>","   </div>","</div>"].join(""),s=n.$new(!0);s.src=a,s.actions=i;var l=s.src.split("."),c=l[l.length-1];s.fileType="aac"===c||"m4a"===c||"mp3"===c?"audio":"image",s.close=function(){o.reject()},s.callAction=function(e){o.resolve(e)};var u=angular.element(t(r)(s))[0];return document.body.appendChild(u),o.promise}var i={open:a};return i}]),angular.module("app.core").directive("mdThumbnail",["$log","Plugin","Platform",function(e,t,n){return{restrict:"A",scope:{mdThumbnail:"@"},link:function(a,i,o){a.genThumb=function(){var r,s;try{r=parseInt(o.mdThumbnailMaxwidth),s=parseInt(o.mdThumbnailMaxheight)}catch(l){e.debug("Failed to parse width and height from thumbnail")}void 0===r&&(r=200),void 0===s&&(s=200);var c=a.mdThumbnail.toLowerCase().indexOf(".svg")>-1;if(void 0===a.mdThumbnail||""==a.mdThumbnail||c)c&&(i.attr("width",r),i.attr("height",s),i.attr("src",a.mdThumbnail));else{var u=t.getSource("thumbnail"),d="winphone"===n.getName();u!==!1?u.makeThumbnail(function(e){i.attr("src",e)},function(t){e.error(t)},a.mdThumbnail,r,s,100):(d&&"/"!==a.mdThumbnail[0]&&a.mdThumbnail.length>0&&(a.mdThumbnail="/"+a.mdThumbnail),i.attr("src",a.mdThumbnail))}},a.genThumb(),a.$watch("mdThumbnail",function(e,t){e!=t&&a.genThumb()})}}}]),angular.module("app.core").directive("scrollableItem",function(){return{restrict:"A",scope:!1,controller:["$scope","$element",function(e,t){return{scrollToBottom:function(){t[0].scrollTop=t[0].scrollHeight}}}]}}),angular.module("app.core").factory("Utilities",function(){return{uuid:function(){var e=Date.now();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}}}),angular.module("app.core").factory("MimeTypes",function(){function e(e){return e.indexOf(".")!=-1&&(e=e.split(".").pop().toLowerCase()),r.hasOwnProperty(e)?r[e].mimeType:null}function t(e){if(e.indexOf(".")!=-1&&(e=e.split(".").pop().toLowerCase()),r.hasOwnProperty(e))return r[e].mediaType}function n(e){var t=[];for(var n in r)r.hasOwnProperty(n)&&r[n].mimeType.toLowerCase()===(e||"").toLowerCase()&&t.push(n);return t}function a(e){var t=[];for(var n in r)r.hasOwnProperty(n)&&r[n].mimeType.toLowerCase()===(e||"").toLowerCase()&&t.push({extension:n,preferred:r[n].preferred||!1});if(1==t.length)return t[0].extension;if(t.length>1){for(var a=0;a<t.length;a++)if(t[a].preferred===!0)return t[a].extension;return t[0].extension}return null}function i(e){for(var t in r)if(r.hasOwnProperty(t)&&r[t].mimeType.toLowerCase()===(e||"").toLowerCase())return r[t].mediaType;return null}var o={IMAGE:"image",AUDIO:"audio",VIDEO:"video"},r={a:{mimeType:"application/octet-stream",mediaType:null},ai:{mimeType:"application/postscript",mediaType:null},aif:{mimeType:"audio/x-aiff",mediaType:o.AUDIO},aifc:{mimeType:"audio/x-aiff",mediaType:o.AUDIO},aiff:{mimeType:"audio/x-aiff",mediaType:o.AUDIO},au:{mimeType:"audio/basic",mediaType:o.AUDIO},avi:{mimeType:"video/x-msvideo",mediaType:null},bat:{mimeType:"text/plain",mediaType:null},bin:{mimeType:"application/octet-stream",mediaType:null},bmp:{mimeType:"image/x-ms-bmp",mediaType:o.IMAGE},c:{mimeType:"text/plain",mediaType:null},cdf:{mimeType:"application/x-cdf",mediaType:null},csh:{mimeType:"application/x-csh",mediaType:null},css:{mimeType:"text/css",mediaType:null},dll:{mimeType:"application/octet-stream",mediaType:null},doc:{mimeType:"application/msword",mediaType:null},docm:{mimeType:"application/vnd.ms-word.document.macroEnabled.12",mediaType:null},docx:{mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",mediaType:null},dot:{mimeType:"application/msword",mediaType:null},dotx:{mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",mediaType:null},dvi:{mimeType:"application/x-dvi",mediaType:null},eml:{mimeType:"message/rfc822",mediaType:null},eps:{mimeType:"application/postscript",mediaType:null},etx:{mimeType:"text/x-setext",mediaType:null},exe:{mimeType:"application/octet-stream",mediaType:null},gif:{mimeType:"image/gif",mediaType:o.IMAGE},gtar:{mimeType:"application/x-gtar",mediaType:null},h:{mimeType:"text/plain",mediaType:null},hdf:{mimeType:"application/x-hdf",mediaType:null},htm:{mimeType:"text/html",mediaType:null},html:{mimeType:"text/html",mediaType:null},jpe:{mimeType:"image/jpe",mediaType:o.IMAGE},jpeg:{mimeType:"image/jpeg",mediaType:o.IMAGE},jpg:{mimeType:"image/jpeg",mediaType:o.IMAGE,preferred:!0},js:{mimeType:"application/javascript",mediaType:null},json:{mimeType:"application/json",mediaType:null},ksh:{mimeType:"text/plain",mediaType:null},latex:{mimeType:"application/x-latex",mediaType:null},m1v:{mimeType:"video/mpeg",mediaType:o.VIDEO},m4a:{mimeType:"audio/mpeg",mediaType:o.AUDIO,preferred:!0},man:{mimeType:"application/x-troff-man",mediaType:null},me:{mimeType:"application/x-troff-me",mediaType:null},mht:{mimeType:"message/rfc822",mediaType:null},mhtml:{mimeType:"message/rfc822",mediaType:null},mif:{mimeType:"application/x-mif",mediaType:null},mov:{mimeType:"video/quicktime",mediaType:o.VIDEO},movie:{mimeType:"video/x-sgi-movie",mediaType:o.VIDEO},mp2:{mimeType:"audio/mpeg",mediaType:o.AUDIO},mp3:{mimeType:"audio/mp3",mediaType:o.AUDIO},mp4:{mimeType:"video/mp4",mediaType:o.VIDEO},mpa:{mimeType:"video/mpeg",mediaType:o.VIDEO},mpe:{mimeType:"video/mpeg",mediaType:o.VIDEO},mpeg:{mimeType:"video/mpeg",mediaType:o.VIDEO},mpg:{mimeType:"video/mpeg",mediaType:o.VIDEO,preferred:!0},ms:{mimeType:"application/x-troff-ms",mediaType:null},nc:{mimeType:"application/x-netcdf",mediaType:null},nws:{mimeType:"message/rfc822",mediaType:null},o:{mimeType:"application/octet-stream",mediaType:null},obj:{mimeType:"application/octet-stream",mediaType:null},oda:{mimeType:"application/oda",mediaType:null},otf:{mimeType:"application/x-font-opentype",mediaType:null},pbm:{mimeType:"image/x-portable-bitmap",mediaType:o.IMAGE},pdf:{mimeType:"application/pdf",mediaType:null},pfx:{mimeType:"application/x-pkcs12",mediaType:null},pgm:{mimeType:"image/x-portable-graymap",mediaType:o.IMAGE},png:{mimeType:"image/png",mediaType:o.IMAGE},pnm:{mimeType:"image/x-portable-anymap",mediaType:o.IMAGE},po:{mimeType:"text/x-gettext-translation",mediaType:null},pot:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},ppa:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},ppm:{mimeType:"image/x-portable-pixmap",mediaType:o.IMAGE},pps:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},ppt:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},pptm:{mimeType:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",mediaType:null},pptx:{mimeType:"application/vnd.openxmlformats-officedocument.presentationml.presentation",mediaType:null},ps:{mimeType:"application/postscript",mediaType:null},pwz:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},py:{mimeType:"text/x-python",mediaType:null},pyc:{mimeType:"application/x-python-code",mediaType:null},pyo:{mimeType:"application/x-python-code",mediaType:null},qt:{mimeType:"video/quicktime",mediaType:o.VIDEO},ra:{mimeType:"audio/x-pn-realaudio",mediaType:o.AUDIO},ram:{mimeType:"application/x-pn-realaudio",mediaType:o.AUDIO},ras:{mimeType:"image/x-cmu-raster",mediaType:o.IMAGE},rdf:{mimeType:"application/xml",mediaType:null},rgb:{mimeType:"image/x-rgb",mediaType:o.IMAGE},roff:{mimeType:"application/x-troff",mediaType:null},rtx:{mimeType:"text/richtext",mediaType:null},sgm:{mimeType:"text/x-sgml",mediaType:null},sgml:{mimeType:"text/x-sgml",mediaType:null},sh:{mimeType:"application/x-sh",mediaType:null},shar:{mimeType:"application/x-shar",mediaType:null},snd:{mimeType:"audio/basic",mediaType:o.AUDIO},so:{mimeType:"application/octet-stream",mediaType:null},src:{mimeType:"application/x-wais-source",mediaType:null},svg:{mimeType:"image/svg+xml",mediaType:o.IMAGE},swf:{mimeType:"application/x-shockwave-flash",mediaType:null},t:{mimeType:"application/x-troff",mediaType:null},tar:{mimeType:"application/x-tar",mediaType:null},tcl:{mimeType:"application/x-tcl",mediaType:null},tex:{mimeType:"application/x-tex",mediaType:null},texi:{mimeType:"application/x-texinfo",mediaType:null},texinfo:{mimeType:"application/x-texinfo",mediaType:null},tif:{mimeType:"image/tiff",mediaType:o.IMAGE},tiff:{mimeType:"image/tiff",mediaType:o.IMAGE},tr:{mimeType:"application/x-troff",mediaType:null},tsv:{mimeType:"text/tab-separated-values",mediaType:null},ttf:{mimeType:"application/x-font-truetype",mediaType:null},txt:{mimeType:"text/plain",mediaType:null,preferred:!0},ustar:{mimeType:"application/x-ustar",mediaType:null},vcf:{mimeType:"text/x-vcard",mediaType:null},wav:{mimeType:"audio/x-wav",mediaType:o.AUDIO},woff:{mimeType:"application/font-woff",mediaType:null,preferred:!0},woff2:{mimeType:"application/font-woff",mediaType:null},wsdl:{mimeType:"application/xml",mediaType:null},xbm:{mimeType:"image/x-xbitmap",mediaType:o.IMAGE},xlb:{mimeType:"application/vnd.ms-excel",mediaType:null},xls:{mimeType:"application/vnd.ms-excel",mediaType:null},xlsm:{mimeType:"application/vnd.ms-excel.sheet.macroEnabled.12",mediaType:null},xlsx:{mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",mediaType:null},xml:{mimeType:"text/xml",mediaType:null},xpdl:{mimeType:"application/xml",mediaType:null},xpm:{mimeType:"image/x-xpixmap",mediaType:o.IMAGE},xsl:{mimeType:"application/xml",mediaType:null},xwd:{mimeType:"image/x-xwindowdump",mediaType:o.IMAGE},zip:{mimeType:"application/zip",mediaType:null}};return{MEDIA_TYPES:o,mimeTypeFromExtension:e,mediaTypeFromExtension:t,extensionsFromMimeType:n,extensionFromMimeType:a,mediaTypeFromMimeType:i}}),angular.module("app.core").factory("StudioStorage",["$q",function(e){function t(){var t=e.defer();return a=new PouchDB("com.commontime.infinity.studio",{revs_limit:10}),a.allDocs({include_docs:!0}).then(function(e){angular.forEach(e.rows,function(e){e.doc&&e.doc._id&&(i[e.doc._id]=e.doc.data)}),t.resolve()}),t.promise}function n(e){if(!e)throw new Error("key cannot be empty");return i[e]||null}var a=null,i={};return{init:t,getData:n}}]),angular.module("app.core").factory("SchemaHelper",["$filter",function(e){function t(e){return a("name",e,o.schema.config)[0]}function n(t){return e("filter")(o.schema.config,{"item-type":t})}function a(e,t,n,i){n=void 0!==n?n:o.schema;var r=[];for(var s in n)n.hasOwnProperty(s)&&("object"!=typeof n[s]||i!==!0&&"actions"==s?s==e&&n[e]==t&&r.push(n):r=r.concat(a(e,t,n[s],i)));return r}function i(){return o.schema.language||{defaultLocale:"en_GB",initialLanguage:"",useDeviceLocale:!0}}var o={SCHEMA_CONTEXT_PREVIEW:1,SCHEMA_CONTEXT_LIVE_PREVIEW:2,schema:{},getSchemaConfigItemByName:t,getSchemaConfigItemsByItemType:n,search:a,getLanguageSettings:i};return o}]),angular.module("app.core").factory("SchemaService",["$http","$q","$rootScope","$log","$templateCache","$location","StoreFactory","PluginFactory","$timeout","localStorageService","OptionFactory","ApiFactory","UrlFactory","Timer","InlineCSS","VariableFactory","$base64","ActionFactory","RouterConfig","Router","Auth","SchemaHelper","IBeaconFactory","GeofenceFactory","XmppFactory","MessageQueueFactory","Notification","Platform","DataflowFactory","AzureAppServicesFactory","RestFactory","ActionflowFactory","AssetFactory","LoadingStatus",function(e,t,n,a,i,o,r,s,l,c,u,d,p,m,f,g,v,h,y,b,$,w,T,S,x,A,E,C,k,I,F,D,_,P){function N(e){var t=!1;return angular.forEach(Z.content,function(n){"page"==n.type&&n.name==e&&(t=n)}),t}function M(){return Z.components}function O(){return ee}function R(){var e=2;return"undefined"!=typeof Z.animation&&(e="off"!==Z.animation?"full"==Z.animation?2:1:0),e}function U(){var n=t.defer();return e.get(te).then(function(e){Z=w.schema=e.data,n.resolve(Z)})["catch"](n.reject),n.promise}function j(a){var i=t.defer();return e.get(n.basedir+"validation_schema.json").then(function(e){var t=tv4.validate(a,e);t?i.resolve(!0):i.reject(t)})["catch"](function(e){i.reject(e)}),i.promise}function L(e){var n=t.defer();return e.settings&&e.settings.auth===!0?$.authenticate().then(n.resolve,n.reject):n.resolve(),n.promise}function q(){b.addRoute("/error",{template:['<div class="error-container">','   <div class="alert alert-danger">','       <span class="fa fa-exclamation-triangle"></span> {{ $root.errorMessage || "An unknown error has occurred" }}',"   </div>",'   <div class="controls">','       <a href="#" class="btn md-btn btn-primary" onclick="location.reload();">','           <span class="fa fa-refresh"></span> Reload',"       </a>","   </div>","</div>"].join("")})}function V(e){var i=t.defer();return Z=w.schema=e,n.appName=Z.name,n.cancelable=Z.cancelable===!0,n.basedir=void 0==Z.basedir?"":Z.basedir,n.assetDir=void 0!==Z.assetDir?Z.assetDir:"user-assets/",y.set("id",n.appName),a.debug("Initializing store..."),r.init(n.appName,Z).then(function(){if(C.init(),a.debug("Store initialized."),void 0!==Z.settings){if(void 0!==Z.settings.theme&&""!=Z.settings.theme){var t=angular.element(document.querySelector("head")),l=angular.element("<link rel='stylesheet' href='"+n.basedir+"assets/css/themes/"+Z.settings.theme+".css' />");t.append(l)}void 0!==Z.settings.router&&(void 0!==Z.settings.router.mode&&y.set("mode",Z.settings.router.mode),void 0!==Z.settings.router.animation&&y.set("animation",Z.settings.router.animation)),void 0!==Z.settings["push-notifications"]&&E.init(Z),void 0!==Z.settings["message-queue"]&&A.init(Z),P.disabled=Z.settings["loading-message"]===!1}void 0!==Z.dataflows&&Z.dataflows.length>0&&Z.dataflows.forEach(function(e){k.init(e.name,e.content)}),void 0!==Z.actionflows&&Z.actionflows.length>0&&Z.actionflows.forEach(function(e){D.init(e.name,e.content)}),u.init(n.appName),L(Z).then(function(){j(e).then(function(){if(void 0!=Z.config){var e=[];angular.forEach(Z.config,function(t){if(void 0!=t.name)switch(t["item-type"]){case"onload":e.push(t);break;case"api":void 0!==t.url&&d.init(t);break;case"offline-api":void 0!==t.url&&(F.init(),F.registerOfflineApi(t));break;case"xmpp":void 0!==t.endpoint&&x.init(t);break;case"plugin":s.init(t);break;case"theme":f.add(t.content);break;case"variable":g.init(t);break;case"function":r.setFunction(t);break;case"js-asset":_.injectJsAsset(t.fileName);break;case"css-asset":_.injectCssAsset(t.fileName);break;case"url":p.init(t);break;case"ibeacon":T.init(),T.addBeacon(t);break;case"geofence":if(S.isValidGeofenceObject(t)){var n="com.commontime.infinity."+Z.name;S.init(Z.name,n),S.register(t)}break;case"timer":void 0==cti.__timers&&(cti.__timers={}),cti.__timers[t.name]=new m(t.name,t["timer-type"],t.time,t.actions);break;case"azure-app-services":I.init(t)}}),e.length>0&&e.forEach(function(e){h.triggerEvent("onload",e.actions)})}void 0!=Z.components&&Z.components.length>0&&Z.components.forEach(function(e){switch(e.type){case"web-component":case"polymer":var t=document.createElement("link");t.setAttribute("rel","import"),t.setAttribute("href","data:text/html;base64,"+e.content),document.getElementsByTagName("head")[0].appendChild(t);break;case"web-component-es2015":var n=document.createElement("script");n.setAttribute("src","data:application/javascript;base64,"+e.content),document.getElementsByTagName("body")[0].appendChild(n);break;case"directive":var n=document.createElement("script");n.text=v.decode(e.content),document.getElementsByTagName("body")[0].appendChild(n)}}),n.$emit("ConfigComplete");var t={};n.$on("onPageContentLoaded",function(e,n){void 0!==t[n.id]&&h.triggerEvent("onloaded",t[n.id])}),angular.forEach(Z.pages,function(e){var n=angular.element("<div></div>"),a=[];void 0!==e.config&&e.config.length>0&&e.config.forEach(function(n){"onload"==n["item-type"]&&void 0!==n.actions&&n.actions.length>0&&n.actions.forEach(function(e){a.push(e)}),"onloaded"==n["item-type"]&&void 0!==n.actions&&n.actions.length>0&&(void 0===t[e.name]&&(t[e.name]=[]),t[e.name]=t[e.name].concat(n.actions))});var i=z(n,e.content),o=w.search("type","go-to-page",e.content,!0),r=[];o.length>0&&angular.forEach(o,function(e){void 0!=e.data&&e.data.length>0&&r.push(e.data)});var s=void 0!==e.settings&&e.settings.auth===!0;b.addRoute("/"+e.name,{template:i[0].innerHTML,possibilities:r,actions:a,start:e.start,auth:s})}),q(),i.resolve(!0)},function(){a.error(tv4.error),n.errorMessage="An invalid schema has been provided: "+tv4.error.message,q(),o.path("/error"),i.resolve(error)})})["catch"](function(e){a.error(e),n.errorMessage=e,q(),o.path("/error"),i.resolve(e)})})["catch"](function(e){a.error(e)}),i.promise}function G(e){return te=e,U(e).then(function(e){return V(e)})}function B(e){var a=!1,i=e.content;switch("string"==typeof i&&(i=_.rewriteAssetPaths(i)),e.type){case"question":void 0!==e["extends"]&&"question"!=e["extends"].type||(a=angular.element('<md-question id="'+e.name+'"></md-question>'));break;case"content":switch(e["item-type"]){case"markdown":case"html":a=angular.element('<md-content id="'+e.name+'"><div>'+i+"</div></md-content>");break;case"list":a=angular.element("<md-list id='"+e.name+"'></md-list>");break;case"title":a=angular.element("<md-title id='"+e.name+"'><div>"+i+"</div></md-title>");break;case"group":a=e.repeat?angular.element('<md-group ng-form name="'+e.name+'" isolate-form id="'+e.name+'"></md-group>'):angular.element('<md-group id="'+e.name+'"></md-group>')}break;case"control":switch(e["item-type"]){case"button":a=angular.element('<md-button id="'+e.name+'" left-icon="'+e["left-icon"]+'" right-icon="'+e["right-icon"]+'">'+i+"</md-button>");break;case"record-audio":a=angular.element('<record-audio id="'+e.name+'"></record-audio>')}break;case"area":switch(e["item-type"]){case"static":a=angular.element('<section class="static-item panel panel-default" id="'+e.name+'"></section>');break;case"scrollable":a=angular.element('<section class="scrollable-item" id="'+e.name+'" scrollable-item></section>');break;case"row":a=angular.element('<section class="row-item navbar navbar-default" id="'+e.name+'"></section>')}a!==!1&&e.classes&&(a[0].className=a[0].className+" "+e.classes);break;case"chart":a=angular.element('<md-chart id="'+e.name+'"></md-chart>');break;case"component":if(a=angular.element(e.template),void 0!==i&&angular.isString(i)&&a.append(i),console.log("ITEM:",e),void 0!=e.attributes)switch(e["item-type"]){case"directive":break;case"polymer":case"web-component":case"web-component-es2015":default:if(angular.forEach(e.attributes,function(e,t){angular.isObject(e)&&(e=angular.toJson(e)),a[0].setAttribute(t,e)}),a[0].setAttribute("md-attributes",angular.toJson(e.attributes)),void 0!=e.expressions&&Object.keys(e.expressions).length>0&&a[0].setAttribute("md-expressions",angular.toJson(e.expressions)),void 0!=e.actions&&e.actions.length>0){var o=[];angular.forEach(e.actions,function(e){["click","blur","change","focus"].indexOf(e.event)===-1?document.addEventListener(e.event,function(){t.when().then(h.call(e))}):o.push(e)}),o.length>0&&a[0].setAttribute("md-actions",angular.toJson(o))}}break;case"media":var r="";switch(e.fileName&&(r=_.rewriteAssetPaths(n.assetDir+e.fileName)),e["item-type"]){case"gallery":void 0!==e.sources&&e.sources.length>0&&(a=angular.element("<media-gallery></media-gallery>"));break;case"image":void 0===e.fileName&&void 0===e.model||(a=angular.element("<image-viewer></image-viewer>"),r&&a.attr("src",r),void 0===e.scaleImage&&(e.scaleImage=!0,e.maxWidth=200,e.maxHeight=200),a.attr("scale-image",e.scaleImage),a.attr("max-width",e.maxWidth),a.attr("max-height",e.maxHeight));break;case"video":case"audio":void 0===e.model&&void 0===e.fileName||(a=angular.element("<media-player></media-player>"),r&&a.attr("src",r));break;case"pdf":case"worddocument":void 0!==e.fileName&&(a=angular.element("<open-document></open-document>"),r&&a.attr("path",r))}break;default:a=H(e)}return a||(a=H(e)),a}function H(e){var t=!1;return void 0!=e["extends"]&&(e.type=e["extends"].type,e["item-type"]=e["extends"]["item-type"],t=B(e)),t}function z(e,t){for(var n=0;n<t.length;n++){var a=t[n],i=B(a);i!==!1&&("component"!==a.type&&angular.forEach(a,function(e,t){var n=angular.copy(e);if(0!==t.indexOf("$")){if("expressions"===t&&angular.isObject(n))return void i[0].setAttribute("md-expressions",JSON.stringify(n));var o=["_auto_id_","content","filename"];o.indexOf(t)!==-1&&"list"!=a["item-type"]||(angular.isObject(n)&&(n=JSON.stringify(n)),i[0].setAttribute(t,n))}}),angular.isArray(a.content)&&(i=z(i,a.content)),e.append(i))}return e}function X(){return!K()&&!J()}function K(){return Z.hostContext===w.SCHEMA_CONTEXT_PREVIEW}function J(){return Z.hostContext===w.SCHEMA_CONTEXT_LIVE_PREVIEW}function W(){var e={};return angular.forEach(Z,function(t,n){["pages","translation"].indexOf(n)===-1&&(e[n]=t)}),e}function Y(e){var t="//*["+Q+'="'+e+'"]',n=JSON.search(Z,t);return 0===n.length?null:n[0]}var Q="_auto_id_",Z=w.schema,ee={},te=null,ne={getPages:function(){return Z.pages},buildItems:z,initApp:G,getDom:O,buildDom:V,getPageSchema:N,isBuiltApp:X,isPreview:K,isLivePreview:J,getAppData:W,getAnimationLevel:R,getComponents:M,findItemById:Y,ITEM_AUTO_ID_PROPERTY:Q};return ne}]),angular.module("app.core").factory("ValidationFactory",["$log","StoreFactory",function(e,t){return{isValid:function(n,a,i,o){var r=!0;switch(a.type){case"regex":if(n){var s=new RegExp(a.content);r=s.test(n)}break;case"expression":var l=angular.copy(a.content);"string"==typeof n&&(n=JSON.stringify(n));var c="$store.pages."+i+"."+o;if(l.indexOf(c)!==-1){var u=c.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");l=l.replace(new RegExp(u,"g"),n)}var d=l.match(/(\$store\.pages\.\w*\.\w*)/g);angular.forEach(d,function(e){var n=t.evaluate(e);"string"==typeof n&&(n=JSON.stringify(n)),l=l.replace(e,n)}),r=t.evaluate(l);break;default:e.error("Invalid validation type specified.")}return r}}}]),angular.module("app.core").factory("TranslationService",["$rootScope","$q","$timeout","$window","$filter","$locale","$log","Plugin","Platform","SchemaHelper","StoreFactory","tmhDynamicLocale","gettextCatalog","nyaBsConfig",function(e,t,n,a,i,o,r,s,l,c,u,d,p,m){function f(){var n=sessionStorage.getItem("debug");if(n){var a=n.split("|");x=a.indexOf("*")!==-1||a.indexOf("translations")!==-1}var i=t.defer(),o=c.getLanguageSettings(),r=o.initialLanguage,s=o.defaultLocale,l=o.useDeviceLocale;p.debug=x,p.baseLanguage=s,d.setLocaleLocationPattern(e.basedir+"assets/i18n/angular-locale_{{ locale }}.js");var m=!1,f=sessionStorage.getItem(S);if(null===f){var g=u.get(T);void 0!==g&&null!==g||(m=!0),f=g||r}else sessionStorage.removeItem(S);return h(l,m,f,r,s).then(function(t){u.set(T,t),y(t,s).then(function(e){return b(e,s)}).then(function(e){return $(e)}).then(function(t){e.currentLanguage=t,i.resolve()})}),i.promise}function g(e){var t=u.get(T);t!==e&&(sessionStorage.setItem(S,e),a.location.reload())}function v(e){return e instanceof Array?e.map(function(e){return i("translate")(e)}):"string"==typeof e?i("translate")(e):e}function h(e,n,a,i,o){function r(e){return e.replace(/-/g,"_").toLowerCase()}function u(e,t){var n=(e||"").toLowerCase();if(!n||n===o.toLowerCase())return t;var a=c.getSchemaConfigItemsByItemType("language"),i=[];if(angular.forEach(a,function(e){e.localeId&&i.push(e.localeId.toLowerCase())}),i.sort(),w("Available localeIds:",i),i.indexOf(n)!==-1)return e;n.indexOf("_")!==-1&&(n=n.substring(0,n.indexOf("_")));for(var r="",s=0;s<i.length&&!r;s++)0===i[s].indexOf(n)&&(r=i[s]);return r||t}var d=t.defer();if(e)if(n)if("desktop"===l.getType()){w('Obtained desktop language: "'+navigator.language+'"');var p=r(navigator.language),m=u(p,i);w('Resolved desktop language to: "'+m+'"'),d.resolve(m)}else{var f=s.getSource("globalization");f&&"function"==typeof f.getPreferredLanguage?f.getPreferredLanguage(function(e){w('Obtained device language: "'+e.value+'"');var t=r(e.value),n=u(t,i);w('Resolved device language to: "'+n+'"'),d.resolve(n)},function(){d.resolve(a)}):d.resolve(a)}else w('Language code already established: "'+a+'"'),d.resolve(a);else w('Bypassing device locale; returning stored language: "'+a+'"'),d.resolve(a);return d.promise}function y(n,a){var i=t.defer();if(n)if(n.toLowerCase()===a.toLowerCase())w("Language code matches default locale; skipping translation"),p.setCurrentLanguage(a),i.resolve("");else{for(var o=c.getSchemaConfigItemsByItemType("language"),s=null,l=0;l<o.length&&null===s;l++)o[l].localeId&&o[l].localeId.toLowerCase()===n.toLowerCase()&&(s=o[l]);if(null===s)r.error('Could not find language matching locale id "'+n+'"; skipping translation'),p.setCurrentLanguage(a),i.resolve("");else{var u=e.assetDir+s.fileName;w('loading translation file "'+u+"'"),p.loadRemote(u).then(function(){w('setting language to "'+n+'"'),p.setCurrentLanguage(n),i.resolve(n)})["catch"](function(){r.error('Could not load translation file "'+u+'"; skipping translation'),p.setCurrentLanguage(a),i.resolve("")})}}else w("Default language; skipping translation"),p.setCurrentLanguage(a),i.resolve("");return i.promise}function b(e,n){var a=t.defer();e||(e=n);var i=e.replace(/_/g,"-").toLowerCase();return w('loading locale "'+i+'"'),d.set(i).then(function(){a.resolve(e)})["catch"](function(){var e=p.baseLanguage.replace(/_/g,"-").toLowerCase();r.error('Could not load locale file for locale "'+i+'"; Reverting to "'+e+'"'),d.set(e).then(function(){a.resolve(p.baseLanguage)})}),a.promise}function $(e){var n=t.defer();m.defaultNoneSelection=v(m.defaultNoneSelection),m.noSearchResult=v(m.noSearchResult);var a=angular.element.prototype.pickadate;a.defaults.monthsFull=o.DATETIME_FORMATS.STANDALONEMONTH,a.defaults.monthsShort=o.DATETIME_FORMATS.SHORTMONTH,a.defaults.weekdaysFull=o.DATETIME_FORMATS.DAY,a.defaults.weekdaysShort=o.DATETIME_FORMATS.SHORTDAY,a.defaults.today=v(a.defaults.today),a.defaults.clear=v(a.defaults.clear),a.defaults.close=v(a.defaults.close);var i=angular.element.prototype.pickatime;return i.defaults.amSmall=o.DATETIME_FORMATS.AMPMS[0],i.defaults.amLarge=o.DATETIME_FORMATS.AMPMS[0],i.defaults.pmSmall=o.DATETIME_FORMATS.AMPMS[1],i.defaults.pmLarge=o.DATETIME_FORMATS.AMPMS[1],i.defaults.clear=v(i.defaults.clear),n.resolve(e),n.promise}function w(){if(x===!0&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[translation.fct.js] "+e[0]),r.log.apply(r,e)}}var T="currentLanguageCode",S="newLanguageCode",x=!1;return{init:f,setLanguage:g,translate:v}}]),angular.module("app.core").factory("StoreFactory",["$rootScope","$parse","$interval","$interpolate","$log","$q","localStorageService","StoreProvider","$timeout","$injector","AssetFactory",function(e,t,n,a,i,o,r,s,l,c,u){function d(e){return 0===e.indexOf("$store.")&&(e=e.replace("$store.","")),t(e)(cti.store)}function p(e,n,a){0===e.indexOf("$store.")&&(e=e.replace("$store.",""));var i=t(e),o=i.assign;return o(a||cti.store,n),S()}function m(e,n){var a=t(e)(cti.store);return void 0==a&&(a=[]),a.push(n),p(e,a),S(),t(e)(cti.store)}function f(e,n){var a=t(e)(cti.store);void 0!=a&&void 0!=a[n]&&a.splice(n,1),p(e,a),S()}function g(){var e=o.defer();return F.get(k+"_data").then(function(t){D=t._rev,cti.store=A(angular.copy(I),t.data),void 0!==s.options.initialData&&(cti.store=A(cti.store,s.options.initialData)),e.resolve()})["catch"](function(){F.put({_id:k+"_data",data:angular.copy(I)}).then(function(t){void 0!==s.options.initialData&&(cti.store=A(cti.store,s.options.initialData)),
D=t.rev,e.resolve()})["catch"](function(t){i.error(t),e.reject(t)})}),e.promise}function v(){null!==k&&r.remove(k+"_stack"),null!==F&&F.destroy().then(function(){window.location.reload()})["catch"](function(){i.error("Couldn't remove database.")})}function h(e){void 0!==e?p("pages."+e,{}):p("pages",{})}function y(e,t){var n=o.defer();return k=e,F=new PouchDB(k,{revs_limit:10}),void 0!==t.settings&&t.settings.encryption===!0?C(e).then(function(e){return F.crypto(e)}).then(function(){return g()}).then(function(){p("schema",angular.copy(t)),n.resolve()})["catch"](function(e){n.reject(e)}):g().then(function(){p("schema",angular.copy(t)),n.resolve()})["catch"](function(e){n.reject(e)}),n.promise}function b(t){var n={$store:cti.store};return"object"==typeof t?angular.forEach(t,function(a,i){void 0!=a&&"string"==typeof a&&"*"!=a&&(t[i]=e.$eval(t[i],n))}):void 0!=t&&"*"!=t&&(t=e.$eval(t,n)),t}function $(e,t,n){if(void 0===t&&(t={}),void 0===t.$store&&(t.$store=cti.store),"object"==typeof e?angular.forEach(e,function(a,i){"string"==typeof a&&a.indexOf("{{")>-1?e[i]=$(e[i],t,n):"object"==typeof a&&angular.toJson(a).indexOf("{{")>-1&&(e[i]=$(e[i],t,n))}):void 0!=e&&"*"!=e&&(e=a(e)(t)),n===!1)return e;try{return angular.fromJson(e)}catch(i){return e}}function w(e,t){if(e.indexOf("{{")>-1&&(e=$(e)),void 0!=t&&0!==Object.getOwnPropertyNames(t).length){var n="?";angular.forEach(t,function(e,t){"?"!=n&&(n+="&"),e.indexOf("{{")>-1&&(e=$(e)),n+=t+"="+encodeURI(e)}),e+=n}return e}function T(){var e=angular.copy(cti.store);return e.schema=void 0,e}function S(){if(null!==k&&null!==F&&null!==D){null===N&&(N=o.defer()),null!==P&&l.cancel(P);var e=function(){i.debug("SAVING AT REVISION:",D),F.put({_id:k+"_data",_rev:D,data:T()}).then(function(e){D=e.rev,null!==N&&(N.resolve(),N=null)})["catch"](function(t){void 0!==t.status&&409==t.status?(i.debug("Caught document update conflict",t),l(e,250)):(i.error(t),null!==N&&(N.reject(t),N=null))})};return P=l(function(){e()},250),N.promise}}function x(e){if(void 0!=e.name&&void 0!=e.content)try{var t=[];void 0!=e.params&&e.params.length>0&&angular.forEach(e.params,function(e){t.push(e.name)});var n=u.rewriteAssetPaths(e.content);cti[e.name]=new Function(t,n),cti[e.name].prototype.sync=e.sync===!0}catch(a){i.info("Couldn't successfully eval function code (store.fct.js:148): "),i.error(a)}}function A(e,t){return angular.forEach(t,function(n,a){"$event"===a?e.$event=n:"object"!=typeof n||null===n?e[a]=n:(void 0==e[a]&&("[object Array]"===Object.prototype.toString.call(t[a])?e[a]=[]:e[a]={}),e[a]=A(e[a],n))}),e}function E(e){cti.store=A(cti.store,e),S()}function C(e){var t=o.defer(),n=c.get("Plugin"),a=n.getSource("securesettings");return a?a.getOrCreateCryptographicKey(t.resolve,t.reject,e,512):t.resolve("1x28ucKW25UFbvZb10f/dN1ZjnOyPCWufYVDQnC8Ji7WabM9pRo6PkwjgRhaqDmFb20+TBCc/W0H8PsV0cfo1+8WIHz81joB"),t.promise}var k=null;cti.store={env:{},language:"en_GB",state:{},api:{},offlineApi:{},azureAppServices:{},xmpp:{},messageQueues:{listeningTo:[]},geofences:{},plugin:{},repeater:{},schema:{},media:{},notification:{},xcallback:{success:"",error:"",cancel:"",source:""},variables:{today:new Date},pages:{}};var I=angular.copy(cti.store),F=null,D=null,_={init:y,evaluate:b,parse:$,get:d,set:p,push:m,remove:f,setFunction:x,parseUrl:w,save:S,destroyAllData:v,destroyPageData:h,merge:A,mergeInitialData:E,getId:function(){return k}},P=null,N=null;e.$watch(function(){return cti.store},function(t,n){t!=n&&(S(),e.$broadcast("StoreChanged"),document.dispatchEvent(new CustomEvent("StoreChanged")))},!0);var M=function(){e.$$phase||e.$apply()};return document.addEventListener("StoreHasChanged",M),e.$on("StoreHasChanged",M),document.addEventListener("SaveToStore",function(e){var t=e.detail.key,n=e.detail.data;void 0!==t&&p(t,n)}),_}]).filter("store",["StoreFactory","$filter",function(e,t){var n=function(n,a){if(void 0!=n){var i=e.evaluate(n);return angular.isArray(i)&&void 0!=a&&(i=t("filter")(i,a)),i}};return n.$stateful=!0,n}]).filter("trust",["$sce",function(e){var t=function(t){return e.trustAsHtml(t)};return t.$stateful=!0,t}]),angular.module("app.core").provider("StoreProvider",function(){this.options={},this.set=function(e,t){switch(console.log("StoreProvider set called"),e){case"initialData":this.options.initialData=t;break;default:console.log("Invalid Option: An invalid option was specified.")}};var e=this;this.$get=function(){return{options:e.options,set:e.set}}}),angular.module("app.core").factory("Plugin",["$http","$log","$q","StoreFactory","$interval","electron",function(e,t,n,a,i,o){function r(e,t,n,o){if(this.name=e,this.events=[],this.polls=[],this.operations=o,void 0!=t&&(this.events=t,this.events.length>0)){var r=this;angular.forEach(this.events,function(e){window.addEventListener(e.name,function(t){a.set("plugin."+r.name+"."+e.name,t)})})}if(void 0!=n&&(this.polls=n,this.polls.length>0)){var r=this;angular.forEach(this.polls,function(e){i(function(){r.callAction(e.action,e.params,e.options)},e.interval)})}}return r.prototype={callAction:function(e,i){var o=this,s=n.defer(),l=[];angular.forEach(this.operations,function(t){t.name==e&&void 0!=t.params&&(l=angular.copy(t.params))});var c=function(t){a.set("plugin."+o.name+"."+e,t),s.resolve(t)},u=function(e){t.error(e),s.reject(e)},d=[];angular.forEach(l,function(e){var t=null;switch(e.name){case"$successCallback":t=c;break;case"$errorCallback":t=u;break;default:t=void 0!=i[e.name]?i[e.name]:e["default"]}null!==t&&d.push(t)});var p=r.getSource(this.name);if(p!==!1&&void 0!=p[e])try{p[e].apply(null,d)}catch(m){s.reject(m),t.error(m)}else s.reject("Could not call action");return s.promise}},r.getSource=function(e){if(void 0!==window[e])return window[e];if(void 0!==window.cordova&&void 0!==cordova[e])return cordova[e];if(void 0!==window.cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins[e])return cordova.plugins[e];if(void 0!==window.plugins&&void 0!==window.plugins[e])return window.plugins[e];if(void 0!==navigator&&void 0!==navigator[e])return navigator[e];if(void 0===o.app)return t.info("Plugin '"+e+"' is not available."),!1;var n=!1;try{return n=require(e)}catch(a){if(n===!1||void 0===n){var i=e.replace(/\-/g,"").toLowerCase();try{return n=require("@commontimeltd/com.commontime."+i)}catch(a){return!1}}return!1}},r}]),angular.module("app.core").factory("OptionFactory",["$rootScope","$parse","localStorageService",function(e,t,n){function a(e){return t(e)(r)}function i(e){o=e;var t=n.get(e+"_options");null!==t&&(r=t)}var o=null,r={},s={init:i,get:a};return s}]),angular.module("app.core").factory("Api",["$http","$log","$q","StoreFactory","$injector","$httpParamSerializer","Utilities","FileSystem","MimeTypes",function(e,t,n,a,i,o,r,s,l){function c(e,t,n,a,i){this.name=e,this.url=t,this.params=n,this.headers=a,this.operations=i}return c.prototype={buildRequestObject:function(e,t,a){var i=n.defer(),r=this,s={url:r.url+e.path,method:e.method||"GET",params:{},headers:{}},l=["POST","PUT","CONNECT","PATCH"];l.indexOf(s.method)!==-1&&e["content-type"]&&(s.headers["Content-Type"]=e["content-type"]);var c=["POST","PUT","CONNECT","PATCH"];c.indexOf(s.method)!==-1&&(s.data={}),"JSONP"==s.method&&(s.params.callback="JSON_CALLBACK");var u=n.when(),d=[u];return angular.forEach(r.params,function(e){d.push(r.constructParameter(e,t,s,a))}),n.all(d).then(function(){return d=[u],angular.forEach(e.params,function(e){d.push(r.constructParameter(e,t,s,a))}),n.all(d)}).then(function(){"application/x-www-form-urlencoded"==s.headers["Content-Type"]&&(s.data=o(s.data)),e.downloadAsFile===!0&&(s.responseType="arraybuffer"),i.resolve(s)}),i.promise},constructParameter:function(e,i,o,r){var l=n.defer(),c=void 0;if(void 0!==i&&void 0!==i[e.name]?c=i[e.name]:void 0!==e["default"]?c=e["default"]:e.required===!0&&l.reject('Parameter "'+e.name+'" must be provided.'),e.typeConfig=e.typeConfig||{},void 0!==c){"string"==typeof c&&c.indexOf("{{")>-1&&(c=a.parse(c));var u="function"==typeof r?r(o,e,c):n.when(!1);u.then(function(n){if(n)l.resolve();else switch(e["in"]){case"path":o.url=o.url.replace("{{"+e.name+"}}",c),l.resolve();break;case"query":o.params[e.name]=c,l.resolve();break;case"header":o.headers[e.name]=c,l.resolve();break;case"body":if(!o.data){l.reject('Unable to add parameter "'+e.name+'" to body of '+o.method.toUpperCase()+" request");break}o.data[e.name]=c,l.resolve();break;case"formData":if(!o.data){l.reject('Unable to add parameter "'+e.name+'" to form data of '+o.method.toUpperCase()+" request");break}if(o.data instanceof FormData||(o.data=new FormData),o.headers["Content-Type"]=void 0,"file"===e.type)try{var a=s.getFileNameFromPath(c);s.getFileBlob(a).then(function(t){if(e.typeConfig.fileNameParameterName&&o.data.append(e.typeConfig.fileNameParameterName,a),e.typeConfig.base64encode===!0){var n=new FileReader;n.onloadend=function(t){var n=t.target.result;o.data.append(e.name,n),l.resolve()},n.readAsDataURL(t)}else o.data.append(e.name,t,a),l.resolve()})["catch"](function(e){t.error(e),l.reject(e)})}catch(i){t.error(i),l.reject(i)}else o.data.append(e.name,c),l.resolve();break;default:l.reject("Unknown parameter location")}})}else l.resolve();return l.promise},makeRequest:function(t,a,o){function r(e){if(void 0!=o){var t=i.get("ActionFactory");t.triggerEvent("success",o,{$response:e})}}function s(e){var t=i.get("ActionFactory");void 0!==o&&t.triggerEvent("fail",o,{$response:e})}var l=n.defer(),c=this,u=c.operations.filter(function(e){return e.name===t});if(u.length>0){var d=u[0];c.buildRequestObject(d,a).then(function(t){return e(t)}).then(function(e){d.downloadAsFile===!0?c.handleFileDownload(e,d).then(function(e){r(e),l.resolve(e)})["catch"](function(e){s(),l.reject(e)}):(r(e.data),l.resolve(e.data))})["catch"](function(e){s(e),l.reject(e)})}else l.reject("Requested operation could not be found.");return l.promise},handleFileDownload:function(e,t){var a=n.defer(),i=e.headers("Content-Type").split(";")[0].trim(),o="";if((t.downloadFileName||"").trim().length>0)o=t.downloadFileName;else{o=r.uuid();var c=l.extensionFromMimeType(i);null!==c&&(o+="."+c)}return s.saveFile(o,e.data).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)}),a.promise}},c.merge=function(e,t){var n={};return void 0!=e&&(n=e),void 0!=t&&angular.forEach(t,function(e,t){"object"!=typeof e?n[t]=e:(void 0==n[t]&&(n[t]={}),n[t]=merge(n[t],e))}),n},c}]),angular.module("app.core").factory("ApiFactory",["$http","$log","StoreFactory","$timeout","$q","Api","LoadingStatus",function(e,t,n,a,i,o,r){function s(e){c[e.name]=new o(e.name,e.url,e.params,e.headers,e.operations,e.actions)}function l(e,o){var s=i.defer(),l=e.name;return void 0!=c[l]&&(r.disabled!==!0&&(r.loading=!0,r.message=u.message),n.set("state.loading",!0),c[l].makeRequest(e.operation,e.params,o).then(function(t){n.set("api."+l+"."+e.operation,t).then(function(){a(function(){r.disabled!==!0&&(r.loading=!1),n.set("state.loading",!1)},1e3),s.resolve(t)})["catch"](function(e){s.reject(e)})})["catch"](function(e){t.error(e),n.set("state.loading",!1),s.reject(e),r.disabled!==!0&&(r.loading=!1,r.error="There was an error retrieving data")})),s.promise}var c={},u={loading:!1,error:!1,message:"Loading data..."};return{init:s,makeRequest:l}}]),angular.module("app.core").service("AssetFactory",["$rootScope","$injector","$http","angularLoad",function(e,t,n,a){function i(i){var o=e.assetDir+i,s=t.get("SchemaService");s.isPreview()||s.isLivePreview()?n.get(o).then(function(e){var t=document.createElement("script");t.textContent=r(e.data),document.body.appendChild(t)}):a.loadScript(o)}function o(t){var a=e.assetDir+t;n.get(a).then(function(e){var t=document.createElement("style");t.textContent=r(e.data),document.head.appendChild(t)})}function r(t){return e.assetDir?t.replace(/user-assets\//g,e.assetDir):t}return{injectJsAsset:i,injectCssAsset:o,rewriteAssetPaths:r}}]),angular.module("app.core").factory("AudioRecordingFactory",["$q","Plugin","FileSystem",function(e,t,n){function a(){var t=e.defer();return null!==s&&l==r.MEDIA_RUNNING?o().then(function(){s=null,t.resolve()})["catch"](function(){s=null,t.resolve()}):t.resolve(),t.promise}function i(){var t=e.defer();return a().then(function(){n.generateFileName().then(function(e){s=new r(e,function(){},function(e){t.reject(e)},function(e){l=e,"function"==typeof c&&c()});var n={SampleRate:44100,NumberOfChannels:1};s.startRecordWithCompression(null,n),t.resolve()})}),t.promise}function o(){var t=e.defer();if(null===s||l!=r.MEDIA_RUNNING)t.reject("Audio not currently recording.");else{s.stopRecord();var n=s.src;s.release(),c=function(){l==r.MEDIA_STOPPED&&(c=null,t.resolve(n))}}return t.promise}var r=t.getSource("Media"),s=null,l=r.MEDIA_STOPPED,c=null;return{startRecordingWithCompression:i,stopRecording:o}}]),angular.module("app.core").factory("PluginFactory",["Plugin","$timeout","StoreFactory","LoadingStatus","$q",function(e,t,n,a,i){function o(t){s[t.name]=new e(t.name,t.events,t.polls,t.operations)}function r(e,o,r){var c=i.defer();a.loading=!0,a.message=l.message;var u=n.parse(angular.copy(r));return s[e].callAction(o,u).then(function(){t(function(){a.loading=!1},1e3),c.resolve()})["catch"](function(){a.loading=!1,a.error="There was an error calling the plugin",c.reject()}),c.promise}var s={},l={loading:!1,error:!1,message:"Calling plugin..."},c={init:o,callAction:r};return c}]),angular.module("app.core").value("LoadingStatus",{loading:!1,error:!1,message:"Loading data...",disabled:!1}),angular.module("app.core").factory("ActionFactory",["$q","StoreFactory","ApiFactory","PluginFactory","$rootScope","$location","$log","UrlFactory","toastr","VariableFactory","Router","Camera","AudioRecordingFactory","Notification","$parse","IBeaconFactory","GeofenceFactory","XmppFactory","MessageQueueFactory","SchemaHelper","FileSystem","MimeTypes","TranslationService","ActionflowFactory","DataflowFactory","AzureAppServicesFactory","RestFactory","AudioPlayer",function($q,StoreFactory,ApiFactory,PluginFactory,$rootScope,$location,$log,UrlFactory,toastr,VariableFactory,Router,Camera,AudioRecordingFactory,Notification,$parse,IBeaconFactory,GeofenceFactory,XmppFactory,MessageQueueFactory,SchemaHelper,FileSystem,MimeTypes,TranslationService,ActionflowFactory,DataflowFactory,AzureAppServicesFactory,RestFactory,AudioPlayer){function evalOperation(e){var t=null;switch(e.type){case"value":if(angular.isNumber(e.content)||parseInt(e.content)||parseFloat(e.content))t=" "+e.content;else{var n=angular.isString(e.content)?e.content.replace(/'/g,"\\'"):e.content;t=" '"+n+"'"}break;case"operator":case"connector":t=" "+e.content}return t}function evalOperations(e,t){var n=!1;if(void 0!==e&&e.length>0){e=void 0===t?StoreFactory.parse(e):StoreFactory.parse(e,{$data:t});var a="";angular.forEach(e,function(e){a+=evalOperation(e)});try{n=$parse(a)({})}catch(i){$log.error("Could not evaluate the logic expression")}}return n}function triggerEvent(e,t,n,a){var i=$q.when(),o=0,r={},s={},l=0;void 0!==n&&null!==n||void 0===a||null===a||(n={keyCode:a.keyCode,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,value:a.target.value});var c=function(e){return!(e>0)||r[e-1]!==!1&&c(e-1)};return angular.forEach(t,function(t){if(null===e||void 0===t.event||t.event==e)switch(t.type){case"if":i=i.then(function(){return o++,void 0!==t.operations&&t.operations.length>0&&(r[o]=evalOperations(angular.copy(t.operations),n),r[o-1]!==!1&&s[o]!==!0&&r[o]===!0&&(s[o]=!0)),$q.when()});break;case"end-if":i=i.then(function(){return delete s[o],delete r[o],o--,$q.when()});break;case"otherwise":i=i.then(function(){return r[o]=s[o]!==!0,$q.when()});break;case"otherwise-if":i=i.then(function(){return s[o]===!0?r[o]=!1:(void 0!==t.operations&&t.operations.length>0&&(r[o]=evalOperations(angular.copy(t.operations),n)),r[o]===!0&&(s[o]=!0)),$q.when()});break;default:i=i.then(function(e){if(r[o]!==!1&&c(o)){l++;var a=void 0===e&&1===l?n:e;return call(t,a)()}return $q.when()})}}),o=0,r={},s={},i}function evalExpressions(e,t){return angular.forEach(e,function(e,n){"expressions"!=n&&("object"==typeof e?t[n]=evalExpressions(e,t[n]):t[n]=StoreFactory.evaluate(e))}),t}function call(originalAction,$data){var parsedAction=angular.copy(originalAction);"loop"!==parsedAction.type&&(parsedAction=StoreFactory.parse(parsedAction,{$data:$data}));var $store=cti.store;return function(){function playFile(e){AudioPlayer.play(e,function(){_success(e)})}var deferred=$q.defer(),_success=function(e){deferred.resolve(e)},_error=function(e,t){$log.error("Action Error [action.fct.js]:",e),void 0!==t&&$log.error(t),deferred.resolve(e)};switch(void 0!==parsedAction.expressions&&(parsedAction=evalExpressions(parsedAction.expressions,parsedAction)),parsedAction.type){case"set-model":try{var key=parsedAction.data.location,value=parsedAction.data.value;void 0!==key?StoreFactory.set(key,value,!1).then(function(){_success(value)})["catch"](function(e){_error(e)}):_error("Model location has not been specified.")}catch(e){_error(e)}break;case"change-language":TranslationService.setLanguage(parsedAction.data.language);break;case"upload-file":!function(){var e=parsedAction.data.filePath,t=FileSystem.getFileNameFromPath(e),n=parsedAction.data.uploadUrl,a=parsedAction.data.saveResponseInModel,i=parsedAction.data.modelLocation,o={httpMethod:parsedAction.data.uploadMethod||"POST",fileName:t,fileKey:parsedAction.data.fileParameterName||"source"};FileSystem.upload(e,n,o).then(function(e){return a&&StoreFactory.set(i,e.response),_success(e)})["catch"](_error)}();break;case"download-file":!function(){var e=parsedAction.data.downloadUrl,t=parsedAction.data.saveAsFileName,n=parsedAction.data.modelLocation;FileSystem.download(e,t).then(function(e){return StoreFactory.set(n,e.filePath),_success(e)})["catch"](_error)}();break;case"call-actionflow":ActionflowFactory.execute(parsedAction.data.name,$data).then(_success)["catch"](_error);break;case"call-dataflow":DataflowFactory.execute(parsedAction.data.name,$data).then(_success)["catch"](_error);break;case"call-api":parsedAction.data.sync===!0?ApiFactory.makeRequest(parsedAction.data,originalAction.actions).then(_success)["catch"](_error):(ApiFactory.makeRequest(parsedAction.data,originalAction.actions),_success($data));break;case"call-offline-api":RestFactory.makeRequest(parsedAction).then(_success)["catch"](_error);break;case"call-azure-app-service":AzureAppServicesFactory.makeRequest(parsedAction).then(_success)["catch"](_error);break;case"logout-azure-app-service":AzureAppServicesFactory.logout().then(_success)["catch"](_error);break;case"send-xmpp-message":case"resend-xmpp-message":XmppFactory.send(parsedAction.data).then(_success)["catch"](_error);break;case"send-xmpp-group-message":XmppFactory.sendToGroup(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-login":XmppFactory.login(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-logout":XmppFactory.logout(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-mark-read":XmppFactory.markRead(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-mark-acknowledged":XmppFactory.markAcknowledged(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-set-status":XmppFactory.setStatus(parsedAction.data).then(_success)["catch"](_error);break;case"start-message-queue-listening":MessageQueueFactory.startListening(parsedAction.data.name).then(_success)["catch"](_error);break;case"stop-message-queue-listening":MessageQueueFactory.stopListening(parsedAction.data.name).then(_success)["catch"](_error);break;case"send-message-queue-message":MessageQueueFactory.sendMessage(parsedAction.data.name,parsedAction.data.message).then(_success)["catch"](_error);break;case"call-plugin":PluginFactory.callAction(parsedAction.data.name,parsedAction.data.operation,parsedAction.data.params).then(_success)["catch"](_error);break;case"call-url":UrlFactory.makeRequest(parsedAction.data).then(_success)["catch"](_error);break;case"call-x-callback-url":var url=null;switch(parsedAction.data.type){case"x-success":url=StoreFactory.get("xcallback.success");break;case"x-error":url=StoreFactory.get("xcallback.error");break;case"x-cancel":url=StoreFactory.get("xcallback.cancel")}url=StoreFactory.parseUrl(url,parsedAction.data.params),window.open(url),_success(url);break;case"go-back":$rootScope.navBack=!0;var previous=Router.lastRoute(),go=function(){$rootScope.navBack=!0,Router.go(previous),deferred.resolve()};$rootScope.$$phase?go():$rootScope.$apply(function(){go()}),_success($data);break;case"go-to-page":$rootScope.navBack=!1;var previous=Router.lastRoute(),location=null;if("object"==typeof parsedAction.data?angular.forEach(parsedAction.data,function(e,t){null===location&&StoreFactory.evaluate(e)&&(location="/"+t)}):location="/"+parsedAction.data,null!==location){var go=function(){previous==location&&($rootScope.navBack=!0),Router.go(location),deferred.resolve()};$rootScope.$$phase?go():$rootScope.$apply(function(){go()}),_success(location)}else _error($data);break;case"set-variable":VariableFactory.setVariable(parsedAction.data.name,parsedAction.data.value).then(_success)["catch"](_error);break;case"call-function":var functionItem=SchemaHelper.getSchemaConfigItemByName(parsedAction.data.name);if(parsedAction.data.name&&"function"==typeof cti[parsedAction.data.name]&&functionItem){void 0==parsedAction.data.params&&(parsedAction.data.params={});try{var paramsArr=[];angular.forEach(functionItem.params,function(e){var t=e.name,n=parsedAction.data.params[t];paramsArr.push(n)});var $success=function(e){void 0!==functionItem.actions&&functionItem.actions.length>0&&triggerEvent("success",functionItem.actions,e),_success(e)},$fail=function(e){void 0!==functionItem.actions&&functionItem.actions.length>0&&triggerEvent("fail",functionItem.actions,e),_error(e)};cti[parsedAction.data.name].apply({$success:$success,$fail:$fail},Array.prototype.slice.call(paramsArr,0)),cti[parsedAction.data.name].prototype.sync!==!0&&_success($data)}catch(e){_error("Couldn't successfully call function:",e)}}else _error("Specified function doesn't exist");break;case"inline-function":if(void 0!==parsedAction.data.code)try{var func=null;if(eval("func = function(){"+parsedAction.data.code+"}"),null!==func){var $success=function(e){void 0!==parsedAction.actions&&parsedAction.actions.length>0&&triggerEvent("success",originalAction.actions,e),_success(e)},$fail=function(e){void 0!==parsedAction.actions&&parsedAction.actions.length>0&&triggerEvent("fail",originalAction.actions,e),_error(e)};func.apply({$success:$success,$fail:$fail})}parsedAction.data.sync!==!0&&_success($data)}catch(error){_error(error)}else _error("Function code not specified.");break;case"start-timer":void 0!=parsedAction.data.name&&void 0!=cti.__timers&&void 0!=cti.__timers[parsedAction.data.name]?(cti.__timers[parsedAction.data.name].start(),_success(!0)):_error(!0);break;case"stop-timer":void 0!=parsedAction.data.name&&void 0!=cti.__timers&&void 0!=cti.__timers[parsedAction.data.name]?(cti.__timers[parsedAction.data.name].stop(),_success($data)):_error($data);break;case"show-notification":Notification.call(parsedAction.data).then(_success)["catch"](_error);break;case"take-photo":Camera.takePhoto(parsedAction.data.quality).then(function(e){if(void 0!==parsedAction.data.model){var t=StoreFactory.get(parsedAction.data.model);void 0===t&&(t=[]),void 0!==parsedAction.data.index&&void 0!==t[parsedAction.data.index]?t[parsedAction.data.index]=e:parsedAction.data.multiple===!0?t.push(e):t[0]=e,StoreFactory.set(parsedAction.data.model,t),_success(t)}else _error("Couldn't save photo response.")})["catch"](function(e){_error("Couldn't take photo:",e)});break;case"select-photo":Camera.selectPhoto().then(function(e){if(void 0!==parsedAction.data.model){var t=StoreFactory.get(parsedAction.data.model);void 0===t&&(t=[]),void 0!==parsedAction.data.index&&void 0!==t[parsedAction.data.index]?t[parsedAction.data.index]=e:parsedAction.data.multiple===!0?t.push(e):t[0]=e,StoreFactory.set(parsedAction.data.model,t),_success(t)}else _error("Couldn't save gallery response.")})["catch"](function(e){_error("Couldn't select photo:",e)});break;case"record-audio":AudioRecordingFactory.startRecordingWithCompression().then(_success)["catch"](_error);break;case"stop-record-audio":AudioRecordingFactory.stopRecording().then(function(e){if(void 0!==parsedAction.data.model){var t=StoreFactory.get(parsedAction.data.model);void 0===t&&(t=[]),void 0!==parsedAction.data.index&&void 0!==t[parsedAction.data.index]?t[parsedAction.data.index]=e:parsedAction.data.multiple===!0?t.push(e):t[0]=e,StoreFactory.set(parsedAction.data.model,t),_success(t)}else _error("Could not save audio response.")})["catch"](function(e){_error("Couldn't stop recording:",e)});break;case"play-audio":if(void 0!==parsedAction.data.model){var store=StoreFactory.get(parsedAction.data.model),fileLocation="";angular.isArray(store)&store.length>0?fileLocation=store[store.length-1]:angular.isString(store)&&(fileLocation=store),angular.isString(fileLocation)&&fileLocation.search(/\.m4a$/gim)>-1?playFile(fileLocation):_error("Play Audio action failed, model location was not a playable file.")}else void 0!==parsedAction.data.fileName?angular.isString(parsedAction.data.fileName)&&parsedAction.data.fileName.search(/\.m4a$/gim)>-1?playFile(parsedAction.data.fileName):_error("Play Audio action failed, file location was not a playable file."):_error("Play Audio action failed, no valid location specified.");break;case"stop-audio":AudioPlayer.stop(),_success($data);break;case"delete-media":var deleteMediaFromLocation=function(e,t){FileSystem.deleteMediaItem(e).then(function(){var n=new CustomEvent("media-deleted",{detail:{location:e}});document.dispatchEvent(n),t()})["catch"](_error)};if(void 0===parsedAction.data.model)_error("Model location missing.");else{var stre=StoreFactory.get(parsedAction.data.model);if(void 0===stre||null===stre)_error("Model location doesn't exist.");else if(angular.isArray(stre))if(void 0===parsedAction.data.index)_error("Image index to delete has not been specified.");else{var index=parsedAction.data.index;if(angular.isNumber(index))if(0==stre.length||void 0==stre[index])_error("Index was out of bounds of the collection.");else{var uri=stre[index];deleteMediaFromLocation(uri,function(){stre.splice(index,1),StoreFactory.set(parsedAction.data.model,stre,!1).then(function(){_success($data)})["catch"](function(e){_error(e)})})}else _error("Index was not able to be parsed as a number.")}else deleteMediaFromLocation(stre,function(){StoreFactory.set(parsedAction.data.model,void 0,!1).then(function(){_success($data)})["catch"](function(e){_error(e)})})}break;case"start-beacon-listening":try{IBeaconFactory.startListening(),_success($data)}catch(err){_error(err)}break;case"stop-beacon-listening":try{IBeaconFactory.stopListening(),_success($data)}catch(err){_error(err)}break;case"loop":if(void 0!==parsedAction.data&&void 0!==parsedAction.data.model){var modelLocation=parsedAction.data.model.replace("{{","").replace("}}",""),items=null;if(items="$data"!==modelLocation?StoreFactory.get(modelLocation):$data,null!==items&&items.length>0){var subChain=$q.when();items.every(function(e){return subChain=subChain.then(function(){return triggerEvent("loop",originalAction.actions,{$item:e})}),!0}),deferred.resolve(subChain)}}break;case"set-value":void 0!==parsedAction.data&&void 0!==parsedAction.data.key?StoreFactory.set(parsedAction.data.key,parsedAction.data.value,$data).then(function(){_success(parsedAction.data.value)})["catch"](function(e){_error(e)}):_error("Missing data.");break;case"start-geofence":try{GeofenceFactory.start(parsedAction.data.name).then(function(){_success(!0)},function(e){_error(e)})}catch(err){_error(err)}break;case"stop-geofence":try{GeofenceFactory.stop(parsedAction.data.name).then(function(){_success(!0)},function(e){_error(e)})}catch(err){_error("Couldn't stop the geofence:",err)}break;case"debounce":null!==debounce&&clearTimeout(debounce),debounce=setTimeout(function(){debounce=null,_success($data)},parsedAction.data.duration);break;case"debug":$log.log("DEBUG - [$data]:",$data),_success($data);break;default:_error("Invalid action type specified.")}return deferred.promise}}var service={triggerEvent:triggerEvent,evalOperations:evalOperations,evalOperation:evalOperation},debounce=null;return void 0===window.cti.utils&&(window.cti.utils={}),window.cti.utils.callAction=function(e,t,n,a){call({type:e,data:t,expressions:n})().then(function(e){void 0!==a&&a(e)})},window.cti.utils.updatePage=function(){$rootScope.$$phase||$rootScope.$apply()},window.cti.utils.getMetadataItem=function(e){if(void 0!==SchemaHelper.schema.metadata){var t=SchemaHelper.schema.metadata;if(void 0!==t[e])return t[e]}},window.cti.utils.destroyAllData=function(){StoreFactory.destroyAllData()},window.cti.utils.destroyPageData=function(e){StoreFactory.destroyPageData(e)},service}]),angular.module("app.core").factory("Url",["$http","$log","$q","StoreFactory",function(e,t,n,a){function i(e,t,n,a){this.name=e,this.url=t,this.target=n,this.params=a}return i.prototype={makeRequest:function(e,t){var o=n.defer(),r=this.url,s={url:r};return s.target=void 0!=e?e:this.target,t=i.merge(this.params,t),void 0!=t&&(s.params=a.parse(t)),s.url=a.parseUrl(s.url,s.params),window.open(s.url,s.target),o.promise}},i.merge=function(e,t){var n={};return void 0!=e&&(n=e),void 0!=t&&angular.forEach(t,function(e,t){"object"!=typeof e?n[t]=e:(void 0==n[t]&&(n[t]={}),n[t]=merge(n[t],e))}),n},i}]),angular.module("app.core").factory("UrlFactory",["$http","$log","StoreFactory","$timeout","$q","Url",function(e,t,n,a,i,o){function r(e){l[e.name]=new o(e.name,e.url,e.target,e.params)}function s(e){var t=i.defer(),n=e.name;return void 0!=l[n]&&l[n].makeRequest(e.target,e.params).then(function(){t.resolve()})["catch"](function(){t.reject()}),t.promise}var l={},c={init:r,makeRequest:s};return c}]),angular.module("app.core").factory("Timer",["$timeout","$interval","ActionFactory","$q",function(e,t,n,a){function i(e,t,n,a){this.timerFunction=null,this.name=e,this.type=t,this.time=parseInt(n),this.actions=a}return i.prototype={start:function(){var a=this.actions;"delay"==this.type?e(function(){n.triggerEvent(null,a)},this.time):"interval"==this.type&&(this.timerFunction=t(function(){n.triggerEvent(null,a)},this.time))},stop:function(){"interval"==this.type&&null!=this.timerFunction&&t.cancel(this.timerFunction)}},i}]),angular.module("app.core").factory("Variable",["$q","StoreFactory",function(e,t){function n(e,t,n){this.name=e,this.type=t,this.set(n)}return n.prototype={set:function(n){var a=e.defer();if(void 0!=n)if("string"==typeof n&&n.indexOf("{{")>-1&&(n=t.parse(n)),void 0!=this.name){var i=null;switch(this.type){case"date":i=Date.parse(n);break;case"string":i=n;break;case"int":i=parseInt(n);break;case"boolean":i="true"==n||"1"==n}this.value=cti.store.variables[this.name]=i,a.resolve(i)}else a.reject("Variable must have a name");else a.resolve();return a.promise}},n}]),angular.module("app.core").factory("VariableFactory",["Variable","$q",function(e,t){function n(t){i[t.name]=new e(t.name,t["variable-type"],t.value)}function a(e,n){var a=t.defer();return void 0!=i[e]?i[e].set(n).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)}):a.reject("Cannot find variable '"+e+"'"),a.promise}var i={},o={init:n,setVariable:a};return o}]),angular.module("app.core").factory("Camera",["StoreFactory","$log","$q","Plugin","FileSystem","Platform",function(e,t,n,a,i,o){function r(e){return l(1,e).then(function(e){var t=n.defer(),a=function(e){t.reject(e)};return 0==e.length&&a("image path returned empty"),window.resolveLocalFileSystemURL(e,function(e){var n=new Date,o=n.getTime(),r=o+".jpg";i.getStorage().then(function(n){e.moveTo(n,r,function(e){e.file(function(e){t.resolve(e.localURL)},a)},a)})["catch"](a)},a),t.promise})}function s(){return l(0)}function l(e,r){var s=n.defer(),l=function(e){void 0!==e&&t.error(e),s.reject(e)},c="desktop"===o.getType();if(c)i.selectFile(["image/jpeg","image/png","image/gif"]).then(function(e){
s.resolve(e)})["catch"](function(){l()});else{var u=a.getSource("camera");u!==!1?u.getPicture(function(e){s.resolve(e)},l,{quality:r||50,destinationType:1,sourceType:e,allowEdit:!1,encodingType:0,saveToPhotoAlbum:!1}):l()}return s.promise}var c={takePhoto:r,selectPhoto:s};return c}]),angular.module("app.core").factory("Auth",["$q","Plugin",function(e,t){function n(){var n=e.defer();return o=t.getSource("authentication"),o!==!1?n.resolve():n.reject("No authentication method available."),n.promise}function a(t){var a=e.defer();if(r)return void(r=!1);var i=void 0!==t?t:"Authentication Required";return n().then(function(){o.authenticate(i,"mDesign10","7OHHxYvRuG1PBlGJi2LXULqMrOKcS64S",function(e){a.resolve()},function(e){a.reject("Authentication failed")}),r=!0})["catch"](function(){a.resolve()}),a.promise}var i={authenticate:a},o=!1,r=!1;return i}]),angular.module("app.core").factory("Notification",serviceFunc),angular.module("app.core").factory("IBeaconFactory",["$injector","Plugin","$log",function(e,t,n){function a(){if(!S){if(h=t.getSource("locationManager"),h!==!1){try{y=e.get("ActionFactory"),h.requestAlwaysAuthorization(),h.isBluetoothEnabled().then(function(e){e||h.enableBluetooth()}).fail(console.error).done()}catch(a){console.error("Error loading iBeacon plugin",a)}var i=new h.Delegate;i.didExitRegion=function(e){s(e)},i.didRangeBeaconsInRegion=function(e){r(e)},h.setDelegate(i)}else n.error("Beacon plugin has not successfully initialised.");S=!0}}function i(e){return Math.round((255-Math.abs(e))/255*100)}function o(e,t){return e.signalStrength<t.signalStrength?1:e.signalStrength>t.signalStrength?-1:0}function r(e){var t=e.beacons[0];if(void 0!==t){var n=!1;for(var a in T){var r=T[a];if(r.uuid.toLowerCase()==t.uuid.toLowerCase()){var s=t.proximity.toLowerCase().replace("proximity","");r.proximity!=t.proximity&&b.forEach(function(e){void 0!==e.uuid&&void 0!==r.uuid&&e.uuid.toLowerCase()===r.uuid.toLowerCase()&&y.triggerEvent(s,e.actions)}),r.proximity=t.proximity,r.accuracy=t.accuracy,r.signalStrength=i(t.rssi),n=!0}}if(!n)for(var a in b){var l=b[a];l.uuid.toLowerCase()==t.uuid.toLowerCase()&&(T.push({title:l.name,major:l.major,minor:l.minor,uuid:l.uuid,accuracy:t.accuracy,proximity:t.proximity,signalStrength:i(t.rssi)}),y.triggerEvent("in-range",l.actions))}var c=T[0].uuid;T.sort(o);var u=T[0].uuid;if(c.toLowerCase()!=u.toLowerCase()){var d=T[0];for(var a in b){var l=b[a];l.uuid.toLowerCase()==d.uuid.toLowerCase()&&y.triggerEvent("closest",l.actions)}}}}function s(e){var t=e.region.uuid;for(var n in T){var a=T[n];if(a.uuid.toLowerCase()==t.toLowerCase()){T.splice(n,1);for(var i in b){var o=b[i];o.uuid.toLowerCase()==t.toLowerCase()&&y.triggerEvent("out-of-range",o.actions)}}}}function l(e){if(b.push(e),void 0!==window.cordova){var t=g(e);e.rangingEnabled&&($.push(e),h.startRangingBeaconsInRegion(t).fail(console.error).done(),e.ranging=!0),h.startMonitoringForRegion(t).fail(console.error).done(),e.monitoring=!0}}function c(){angular.forEach(b,function(e){if(e.monitoring){var t=g(e);h.stopMonitoringForRegion(t).fail(console.error).done(),e.monitoring=!1}})}function u(){angular.forEach($,function(e){if(e.ranging){var t=g(e);h.stopRangingBeaconsInRegion(t).fail(console.error).done()}e.ranging=!1})}function d(){c(),u()}function p(){m(),f()}function m(){angular.forEach(b,function(e){if(!e.monitoring){var t=g(e);h.startMonitoringForRegion(t).fail(console.error).done(),e.monitoring=!0}})}function f(){angular.forEach($,function(e){if(!e.ranging){var t=g(e);h.startRangingBeaconsInRegion(t).fail(console.error).done()}e.ranging=!0})}function g(e){var t=null;return angular.forEach(w,function(n){if(n.uuid.toLowerCase()==e.uuid.toLowerCase())return void(t=n)}),null===t&&(t=new h.BeaconRegion(e.name,e.uuid,e.major,e.minor),w.push(t)),t}var v={init:a,addBeacon:l,stopMonitoring:c,stopRanging:u,startMonitoring:m,startRanging:f,startListening:p,stopListening:d},h=!1,y=null,b=[],$=[],w=[],T=[],S=!1;return v}]),angular.module("app.core").factory("GeofenceFactory",["$q","$injector","Plugin","StoreFactory","$log",function(e,t,n,a,i){function o(e){return"string"==typeof e.name&&"number"==typeof e.lat&&"number"==typeof e.lng&&"number"==typeof e.radius}function r(i,o){if(M)return e.when();P=i,N=o,_=k===!0?E():n.getSource("geofence");var r=e.defer();return _===!1?r.reject('Unable to initialise "geofence" plugin'):(O=t.get("ActionFactory"),x("Retrieving saved geofence state:",a.get(I)),x('Initializing "geofence" plugin...'),_.initialize().then(function(){u(r)},function(e){d(e)})),M=!0,r.promise}function s(t){if(!R){U.push(t);var n="Plugin not ready, adding geofence to queue:";return x(n,t),e.reject(n)}var a=y(t,"enter")?F:0,i=y(t,"exit")?D:0,o=a|i,r=[F,D,F|D];if(r.indexOf(o)==-1){var s='Geofence "'+t.name+'" being ignored - has no transition actions defined';return x(s),e.reject(s)}var l=e.defer();if(t.fullyQualifiedName=h(t.name),void 0===t.listening){var c=S(t);t.listening=void 0===c||c.listening}if(t.listening===!1)x('Skipping geofence "'+t.name+'", was previously stopped'),w(t);else if(t.listening===!0){var u={id:t.fullyQualifiedName,latitude:t.lat,longitude:t.lng,radius:t.radius,transitionType:o,notification:{id:1,title:P,text:t.notificationText||"You have passed a geofence boundary",openAppOnClick:!0}};_.addOrUpdate(u).then(function(){x('Registered geofence "'+t.name+'"'),w(t),l.resolve()},function(e){var n='Unable to register geofence "'+t.name+'"';A(n,e),l.reject(n)})}return l.promise}function l(t){if(!R)return e.reject("Geofence plugin not initialised");if("|all|"===t)return g();var n=e.defer(),a=h(t),i=$(a);return null!==i?i.listening===!1?(i.listening=!0,s(i).then(function(){T(),n.resolve()})):(x('Geofence "'+t+'" already registered'),n.resolve()):n.reject('Unable to find and start geofence "'+t+'"'),n.promise}function c(t){if(!R)return e.reject("Geofence plugin not initialised");if("|all|"===t)return v();var n=e.defer(),a=h(t),i=$(a);return null!==i?_.remove(i.fullyQualifiedName).then(function(){x('Geofence "'+t+'" stopped'),i.listening=!1,w(i),T(),n.resolve()},function(e){var a='Unable to stop geofence "'+t+'"';e(a,e),n.reject(a)}):n.reject('Unable to find and stop geofence "'+t+'"'),n.promise}function u(e){R=!0,_.onTransitionReceived=p,x('Initialized "geofence" plugin'),_.removeAll().then(function(){x("Existing geofence registrations purged"),U.length>0&&(x("Registering "+U.length+" queued geofences..."),angular.forEach(U,function(e){s(e)}),U=[]),e.resolve()})}function d(e){e("Geofence plugin not initialised",e)}function p(e){angular.forEach(e,function(e){var t=$(e.id);if(null!==t&&t.listening===!0)switch(e.transitionType){case F:m(t);break;case D:f(t)}})}function m(e){null!==e&&e.listening===!0&&e.actions.length&&(x('Triggering "enter" event for "'+e.name+'"'),O.triggerEvent("enter",e.actions))}function f(e){null!==e&&e.listening===!0&&e.actions.length&&(x('Triggering "exit" event for "'+e.name+'"'),O.triggerEvent("exit",e.actions))}function g(){var t=e.defer(),n=[];return angular.forEach(j,function(e){e.listening=!0,n.push(s(e))}),e.all(n).then(function(){x("All geofences registered"),T(),t.resolve()}),t.promise}function v(){var t=e.defer();return _.removeAll().then(function(){x("All geofences stopped"),angular.forEach(j,function(e){e.listening=!1,w(e)}),T(),t.resolve()},function(e){var n="Unable to stop all geofences";e(n,e),t.reject(n)}),t.promise}function h(e){return N+"__"+e}function y(e,t){return!(!e.actions||!e.actions.length)&&e.actions.some(function(e){return e.event.toLowerCase()===t.toLowerCase()})}function b(e){for(var t=0;t<j.length;t++){var n=j[t];if(n.fullyQualifiedName===e)return t}return-1}function $(e){var t=b(e);return t!==-1?j[t]:null}function w(e){var t=b(e.fullyQualifiedName);t===-1?j.push(e):j[t]=e}function T(){var e={};angular.forEach(j,function(t){e[t.name]={listening:t.listening}}),a.set(I,e),x("Geofence state saved:",e)}function S(e){return angular.copy(a.get(I+"."+e.name))}function x(){if(C===!0){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[geofence.fct.js] "+e[0]),i.log.apply(i,e)}}function A(){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[geofence.fct.js] "+e[0]),i.error.apply(i,e)}function E(){function t(){var t=e.defer();return setTimeout(function(){t.resolve()},n),t.promise}i.info("*** USING MOCK GEOFENCE PLUGIN: Turn this off in geofence.fct.js if you expect to use the real plugin ***");var n=500;return{initialize:function(){return t()},addOrUpdate:function(){return t()},remove:function(){return t()},removeAll:function(){return t()},onTransitionReceived:function(){}}}var C=!1,k=!1,I="geofences",F=1,D=2,_=null,P="",N="",M=!1,O=null,R=!1,U=[],j=[];return{isValidGeofenceObject:o,init:r,register:s,start:l,stop:c}}]),angular.module("app.core").factory("Xmpp",["LoadingStatus","$log","StoreFactory","$injector","$rootScope","$q","Camera","Plugin","FileSystem","$sce","MimeTypes","$filter",function(e,t,n,a,i,o,r,s,l,c,u,d){function p(e,r,s,c,u,d,p,m){var f=a.get("ActionFactory"),g=this;g.id=e,g.endpoint=r,g.uploadJid=c,g.readReceipts=u,g.stayConnected=d,g.multicastJid=p,g.pingTime=m,g.stayConnected===!0&&g.reconnect(),g.actions=s,void 0!==g.id&&void 0!==g.endpoint?(void 0===cti.store.xmpp[this.id]&&(cti.store.xmpp[this.id]={connection_status:null,user_status:null,history:{},contacts:[],groups:[]}),g.cleanQueue(),g.connection=new Strophe.Connection(g.endpoint),g.connection.reset(),g.setConnectionStatus(null),g.onMessage=function(e){t.debug("[xmpp.fct.js] ("+g.id+") MESSAGE RECEIVED:",e);try{g.enablePing();var a=e.getAttribute("type"),o=e.getAttribute("id"),r=g.getBareJid(e.getAttribute("to")),s=g.getBareJid(e.getAttribute("from"));switch(a){case"chat":var c=e.getElementsByTagName("body")[0],u=e.getElementsByTagName("url")[0];if(void 0!==c)var d=Strophe.getText(c);var p=e.getElementsByTagName("metadata")[0];if(void 0!==p){var m={},v=p.childNodes;if(void 0!==v&&v.length>0)for(var h=0;h<v.length;h++){var y=v[h];m[y.tagName]=Strophe.getText(y)}}if(void 0!==c||void 0!==u){var b=g.createMessageObject(r,s,d,null,o,null,m),$=e.getElementsByTagName("markable")[0];if(void 0!==$&&g.readReceipts!==!1&&g.sendMarker(b.id,g.MESSAGE_STATUS.RECEIVED),void 0!==u){b.media.remote=encodeURI(Strophe.getText(u)),b.media.status=g.MEDIA_STATUS.DOWNLOADING,g.saveAndUpdate();var w=l.getFileNameFromPath(b.media.remote);l.download(b.media.remote,w).then(function(e){b.media.local=e.filePath,b.media.type=e.mimeType,b.media.status=g.MEDIA_STATUS.DOWNLOADED,g.saveAndUpdate()})["catch"](function(e){t.error(e)})}void 0!==g.actions&&g.actions.length>0&&f.triggerEvent("message-received",g.actions,{$message:b}),g.saveAndUpdate()}break;case"error":t.error("XMPP ERROR!",e);var T=e.getAttribute("id");if(void 0!==T){var b=g.getMessageFromHistory(s,T);null!==b&&(b.sent=!1,f.triggerEvent("error",g.actions,{$message:b}),n.save().then(function(){i.$emit("StoreHasChanged")}))}break;default:var S=e.getElementsByTagName("received")[0];if(void 0!==S&&g.readReceipts!==!1){var x=S.getAttribute("id");if(null!==x){var A=g.getMessageFromHistory(s,x);null!==A&&(A.status=g.MESSAGE_STATUS.RECEIVED,g.saveAndUpdate())}}var E=e.getElementsByTagName("displayed")[0];if(void 0!==E&&g.readReceipts!==!1){var x=E.getAttribute("id");if(null!==x){var A=g.getMessageFromHistory(s,x);null!==A&&(A.status=g.MESSAGE_STATUS.DISPLAYED,g.saveAndUpdate())}}var C=e.getElementsByTagName("acknowledged")[0];if(void 0!==C&&g.readReceipts!==!1){var x=C.getAttribute("id");if(null!==x){var A=g.getMessageFromHistory(s,x);null!==A&&(A.status=g.MESSAGE_STATUS.ACKNOWLEDGED,g.saveAndUpdate())}}}}catch(k){t.error("XMPP Error:",k)}return!0},g.updateMessageStatus=function(e){var t=!1;g.queue.forEach(function(n){if(n===e){var a=g.getMessageFromAllHistory(e);null!==a&&(a.status=g.MESSAGE_STATUS.FAILED,f.triggerEvent("send-failed",g.actions,{$message:a}),t=!0)}}),t===!0&&g.saveAndUpdate()},g.send=function(e,n){var a=o.defer();if(g.connection.connected===!0){g.enablePing();var i=null;if(i=void 0!==e.id?g.getMessageFromAllHistory(e.id):g.createMessageObject(e.to,g.connection.authzid,e.message,null,null,e.ttl,e.metadata,n),null!==i){var r=function(){var e=g.createMessageXml(i.id);g.queue.push(i.id),g.connection.send(e),g.saveAndUpdate(),a.resolve()},s=e["file-path"];if(void 0!==s&&angular.isString(s)&&s.length>0)if(void 0!==g.uploadJid){var c=l.getFileNameFromPath(s);l.getFile(c).then(function(e){i.media.local=e.filePath,i.media.type=e.mimeType,i.media.status=g.MEDIA_STATUS.UPLOADING,g.saveAndUpdate(),g.connection.httpFileUpload.slot(g.uploadJid,e.name,e.size,i.media.type,function(n){if(null!==n.put){var o=s,c=encodeURI(n.put),u={httpMethod:"PUT",fileName:e.name,headers:{"Content-Type":i.media.type}};t.debug('[xmpp.fct.js] uploading file "'+o+'" to "'+c+'" with options',u),l.upload(o,c,u).then(function(){i.media.remote=n.get,i.media.status=g.MEDIA_STATUS.UPLOADED,r()})["catch"](function(e){a.reject(e)})}else a.reject("No upload slot was provided.")},function(e){a.reject(e)})})["catch"](function(e){a.reject(e)})}else a.reject("Upload jid has not been configured.");else r()}else a.reject("Unable to send message.")}else a.reject("No connection available.");return a.promise},g.sendToGroup=function(e){var t=o.defer();if(e.groups)if(void 0===g.multicastJid)t.reject("Multicast JID is required for group messages, please configure this on the '"+g.id+"' XMPP instance.");else{e.to=g.multicastJid;var a=void 0!==e.statuses?e.statuses:[],i=void 0!==e.groups?e.groups:[],r=n.get("xmpp."+g.id+".contacts"),s=r.filter(function(e){return void 0!==e.groups&&e.groups.filter(function(e){return i.indexOf(e)>-1}).length>0&&a.indexOf(e.status)===-1}),l=s.map(function(e){return e.username});g.send(e,l).then(function(){t.resolve()})["catch"](function(e){t.reject(e)})}else t.reject("No group(s) specified for group message.");return t.promise},g.markRead=function(e){var n=o.defer();if(g.connection.connected===!0)if(void 0!==e.id)t.debug("Marking message with ID '"+e.id+"' as displayed."),g.sendMarker(e.id,"displayed"),n.resolve(!0);else if(void 0!==e.recipient)if(void 0!==cti.store.xmpp[g.id].history&&void 0!==cti.store.xmpp[g.id].history[e.recipient]){var a=angular.copy(cti.store.xmpp[g.id].history[e.recipient].messages);void 0!==a&&a.length>0?(a=a.reverse(),a.every(function(e){return e.status!==g.MESSAGE_STATUS.DISPLAYED&&e.status!==g.MESSAGE_STATUS.ACKNOWLEDGED&&(e.from!==g.connection.authzid&&void 0!==e.id&&g.sendMarker(e.id,g.MESSAGE_STATUS.DISPLAYED),!0)}),n.resolve(!0)):n.resolve(!0)}else n.resolve(!0);else n.reject("No message ID provided.");else n.resolve();return n.promise},g.onAcknowledgement=function(e){t.debug("[xmpp.fct.js] ("+g.id+") ACKNOWLEDGEMENT RECEIVED:",e);try{var n=!1;g.queue.forEach(function(e){var t=g.getMessageFromAllHistory(e);null!==t&&[g.MESSAGE_STATUS.RECEIVED,g.MESSAGE_STATUS.ACKNOWLEDGED,g.MESSAGE_STATUS.DISPLAYED].indexOf(t.status)===-1&&(t.status=g.MESSAGE_STATUS.SENT,n=!0)}),g.queue=[],n===!0&&g.saveAndUpdate()}catch(a){t.error(a)}return!0},g.onIq=function(e){t.debug("[xmpp.fct.js] ("+g.id+") IQ RECEIVED:",e);var n=e.getAttribute("type");switch(n){case"set":var a=e.getElementsByTagName("query")[0];if(void 0!==a){var i=a.getAttribute("xmlns");switch(i){case"jabber:iq:roster":g.processContacts(a.childNodes),f.triggerEvent("contacts-update",g.actions)}}}return!0},g.onPresence=function(e){t.debug("[xmpp.fct.js] ("+g.id+") PRESENCE RECEIVED:",e),g.enablePing();var a=e.getAttribute("type"),i="unavailable"===a?"offline":"chat",o="unavailable"===a?"Offline":"Available",r=e.getElementsByTagName("show")[0];void 0!==r&&(i=Strophe.getText(r));var s=e.getElementsByTagName("status")[0];void 0!==s&&(o=Strophe.getText(s));const l=g.getBareJid(e.getAttribute("from"));var c=n.get("xmpp."+g.id+".contacts"),u=!1;if(c.length>0){var d=c.filter(function(e){return e.username===l})[0];void 0!==d&&d.status!==i&&(d.status=i,d.friendly_status=o,f.triggerEvent("status-update",g.actions,{$contact:d}),u=!0)}return u&&g.saveAndUpdate(),!0},g.login=function(e,a){if(g.connection.connected===!0)return o.when();var i=o.defer();return g.connection.reset(),g.setLastAuthStatus("pending"),void 0!==e&&void 0!==a?g.connection.connect(e,a,function(o){var r=g.statusCodeToTxt(o);switch(g.setConnectionStatus(r),f.triggerEvent(r,g.actions),t.debug("[xmpp.fct.js] ("+g.id+") STATUS CHANGE:",r),r){case g.CONNECTION_STATUS.CONNFAIL:case g.CONNECTION_STATUS.ERROR:g.purgeQue(),g.connection.disconnect(),g.disablePing();break;case g.CONNECTION_STATUS.AUTHFAIL:g.setLastAuthStatus("failed"),g.connection.disconnect(),g.disablePing();break;case g.CONNECTION_STATUS.DISCONNECTED:g.disablePing(),i.resolve();break;case g.CONNECTION_STATUS.CONNECTED:g.setLastAuthStatus("success"),g.connection.addHandler(g.onMessage,null,"message",null,null,null),g.connection.addHandler(g.onIq,null,"iq",null,null,null),g.connection.addHandler(g.onAcknowledgement,null,"a",null,null,null),g.connection.addHandler(g.onPresence,null,"presence",null,null,null),g.connection.streamManagement.requestResponseInterval=1,g.connection.streamManagement.enable(function(){var o=$iq({from:g.connection.jid,id:g.connection.getUniqueId(),type:"get"});o.c("query",{xmlns:"jabber:iq:roster"}),n.set("xmpp."+g.id+".contacts",[]),g.connection.sendIQ(o,function(o){t.debug("[xmpp.fct.js] ("+g.id+") GOT CONTACTS:",o),g.processContacts(o.querySelector("query").childNodes);var r=n.get("xmpp."+g.id+".user_status")||g.USER_STATUS.CHAT,s=function(){f.triggerEvent("connected",g.actions),g.enablePing(),i.resolve()};g.setStatus(r).then(function(){g.stayConnected===!0?g.getSecureDb().then(function(n){n.put({_id:g.DB.ID+"_data",_rev:g.DB.REVISION,data:e+":"+a}).then(function(e){g.DB.REVISION=e.rev,s()})["catch"](function(e){t.error(e),i.reject(e)})})["catch"](function(e){t.error(e),i.reject(e)}):s()})["catch"](function(e){i.reject(e)})})},function(e){i.reject(e)})}}):(g.setLastAuthStatus("failed"),g.connection.disconnect()),i.promise},g.logout=function(){var e=o.defer();return g.stayConnected===!0?g.getSecureDb().then(function(t){t.destroy().then(function(){g.DB.REVISION=null,g.connection.disconnect(),e.resolve()})["catch"](function(t){e.reject(t)})})["catch"](function(t){e.reject(t)}):(g.connection.disconnect(),e.resolve()),e.promise},g.pingTimeout=null,g.pingInterval=null,g.disablePing=function(){t.debug("[xmpp.fct.js] ("+g.id+") Disable ping."),null!==this.pingTimeout&&(clearTimeout(g.pingTimeout),this.pingTimeout=null),null!==this.pingInterval&&(clearInterval(g.pingInterval),this.pingInterval=null)},g.enablePing=function(){g.disablePing(),null!==g.connection&&g.connection.connected===!0&&(g.pingInterval=setTimeout(function(){t.debug("[xmpp.fct.js] ("+g.id+") Pinging & setting ping interval."),g.ping(),g.pingInterval=setInterval(function(){g.ping()},g.pingTime||5e3)},5e3))},g.ping=function(){var e=$iq({from:g.connection.jid,id:g.connection.getUniqueId(),type:"get"});e.c("ping",{xmlns:"urn:xmpp:ping"}),t.debug("[xmpp.fct.js] ("+g.id+") Pinging."),g.connection.sendIQ(e,function(e){})}):t.error("Missing data for XMPP instance."),i.$on("device-resume",function(){g.stayConnected!==!0||null!==g.connection&&g.connection.connected!==!1||g.reconnect()})}return p.prototype.calcGroups=function(){var e=n.get("xmpp."+this.id+".contacts"),t=[];e.forEach(function(e){void 0!==e.groups&&e.groups.forEach(function(e){var n=d("filter")(t,{name:e},!0);0===n.length?t.push({name:e,count:1}):t=t.map(function(e){return e.count++,e})})}),n.set("xmpp."+this.id+".groups",t)},p.prototype.processContacts=function(e){if(void 0!==e&&e.length>0){for(var t=n.get("xmpp."+this.id+".contacts")||[],a=0;a<e.length;a++){var i=e[a],o=i.getAttribute("jid");if("remove"===i.getAttribute("subscription"))t=t.filter(function(e){return e.username!==o});else{var r=[],s=i.querySelectorAll("group");if(s.length>0)for(var l=0;l<s.length;l++){var c=s[l];r.push(Strophe.getText(c))}var u={name:i.getAttribute("name"),username:o,groups:r,status:null,friendly_status:null},d=t.filter(function(e){return e.username===o})[0];void 0===d?t.push(u):d=u}}n.set("xmpp."+this.id+".contacts",t),this.calcGroups()}},p.prototype.getSecureDb=function(){this.DB.ID=n.getId()+"_"+this.id+"_xmpp_db";var e=new PouchDB(this.DB.ID,{revs_limit:10});return e.crypto(this.DB.KEY).then(function(){return e})},p.prototype.reconnect=function(){var e=o.defer(),n=this;return this.getSecureDb().then(function(i){i.get(n.DB.ID+"_data").then(function(i){n.DB.REVISION=i._rev;var o=i.data.split(":");if(void 0!==o[0]&&void 0!==o[1]){var r=o[0],s=o[1];t.debug("[xmpp.fct.js] ("+n.id+") Auto-Logging in with: '"+r+"' and '"+s+"'."),n.login(r,s).then(function(){var t=a.get("ActionFactory");t.triggerEvent("reconnected",n.actions),e.resolve()})["catch"](function(t){e.reject(t)})}else e.reject("Couldn't extract the saved credentials from the encrypted database.")})["catch"](function(){e.resolve()})})["catch"](function(t){e.reject(t)}),e.promise},p.prototype.DB={ID:null,KEY:"2%^%123$^#_##}{P21$@#Dd}23fs#!@|#213@4",REVISION:null},p.prototype.queue=[],p.prototype.USER_STATUS={AWAY:"away",CHAT:"chat",DO_NOT_DISTURB:"dnd",EXTENDED_AWAY:"xa"},p.prototype.MESSAGE_STATUS={SENDING:"sending",SENT:"sent",FAILED:"failed",RECEIVED:"received",DISPLAYED:"displayed",ACKNOWLEDGED:"acknowledged"},p.prototype.MEDIA_STATUS={DOWNLOADING:"downloading",DOWNLOADED:"downloaded",FAILED:"failed",UPLOADING:"uploading",UPLOADED:"uploaded"},p.prototype.CONNECTION_STATUS={ERROR:"error",CONNECTING:"connecting",CONNFAIL:"connection-failed",AUTHENTICATING:"authenticating",AUTHFAIL:"authentication-failed",CONNECTED:"connected",DISCONNECTED:"disconnected",DISCONNECTING:"disconnecting",ATTACHED:"attached"},p.prototype.setStatus=function(e){var t=o.defer(),a=null;switch(e){case this.USER_STATUS.AWAY:a="Away";break;case this.USER_STATUS.CHAT:a="Available";break;case this.USER_STATUS.DO_NOT_DISTURB:a="Do Not Disturb";break;case this.USER_STATUS.EXTENDED_AWAY:a="Extended Away"}if(null!==a){var i=$pres({from:this.connection.jid}).c("show",null,e).c("status",null,a);n.set("xmpp."+this.id+".user_status",e),this.connection.send(i.tree()),t.resolve()}else t.reject("Invalid status provided.");return t.promise},p.prototype.setConnectionStatus=function(e){n.set("xmpp."+this.id+".connection_status",e)},p.prototype.setLastAuthStatus=function(e){n.set("xmpp."+this.id+".last_auth_status",e)},p.prototype.statusCodeToTxt=function(e){var t=null;switch(e){case Strophe.Status.ERROR:t=this.CONNECTION_STATUS.ERROR;break;case Strophe.Status.CONNECTING:t=this.CONNECTION_STATUS.CONNECTING;break;case Strophe.Status.CONNFAIL:t=this.CONNECTION_STATUS.CONNFAIL;break;case Strophe.Status.AUTHENTICATING:t=this.CONNECTION_STATUS.AUTHENTICATING;break;case Strophe.Status.AUTHFAIL:t=this.CONNECTION_STATUS.AUTHFAIL;break;case Strophe.Status.CONNECTED:t=this.CONNECTION_STATUS.CONNECTED;break;case Strophe.Status.DISCONNECTED:t=this.CONNECTION_STATUS.DISCONNECTED;break;case Strophe.Status.DISCONNECTING:t=this.CONNECTION_STATUS.DISCONNECTING;break;case Strophe.Status.ATTACHED:t=this.CONNECTION_STATUS.ATTACHED}return t},p.prototype.createMessageXml=function(e){var t=this.getMessageFromAllHistory(e),n=$msg({to:t.to,from:t.from,id:e,type:"chat"}).tree();if(null!==t.addresses){var a=new Strophe.Builder("addresses",{xmlns:"http://jabber.org/protocol/address"}).tree();t.addresses.forEach(function(e){var t=new Strophe.Builder("address",{type:"to",jid:e}).tree();a.appendChild(t)}),n.appendChild(a)}if(void 0!==t.body){var i=new Strophe.Builder("body").t(t.body).tree();n.appendChild(i)}if(null!==t.media.remote){var o=new Strophe.Builder("x",{xmlns:"jabber:x:oob"}).tree(),r=new Strophe.Builder("url").t(t.media.remote).tree();o.appendChild(r),n.appendChild(o)}if(this.readReceipts!==!1){var s=new Strophe.Builder("markable",{xmlns:"urn:xmpp:chat-markers:0"}).tree();n.appendChild(s)}if(null!==t.ttl){var l=new Strophe.Builder("x",{xmlns:"jabber:x:expire",seconds:t.ttl}).tree();n.appendChild(l)}if(null!==t.metadata&&Object.keys(t.metadata).length>0){var c=new Strophe.Builder("metadata",{xmlns:"urn:commontime:mdesign:metadata"}).tree();for(var u in t.metadata)if(void 0!==t.metadata[u]){var d=new Strophe.Builder(u).t(t.metadata[u]).tree();c.appendChild(d)}n.appendChild(c)}return n},p.prototype.sendMarker=function(e,t){var n=this.getMessageFromAllHistory(e),a=$msg({to:n.from,from:n.to,id:this.connection.getUniqueId(),type:"marker"});a.c(t,{xmlns:"urn:xmpp:chat-markers:0",id:e}),n.status=t,this.calcReadCount(n.from),this.connection.send(a.tree())},p.prototype.calcReadCount=function(e){if(void 0!==cti.store.xmpp[this.id]&&void 0!==cti.store.xmpp[this.id].history&&void 0!==cti.store.xmpp[this.id].history[e]){var t=cti.store.xmpp[this.id].history[e].messages,n=0,a=0,i=this;t.forEach(function(t){t.from==e&&(t.status===i.MESSAGE_STATUS.DISPLAYED||t.status===i.MESSAGE_STATUS.ACKNOWLEDGED?n+=1:a+=1)}),cti.store.xmpp[this.id].history[e].read=n,cti.store.xmpp[this.id].history[e].unread=a,this.saveAndUpdate()}},p.prototype.createMessageObject=function(e,n,a,i,o,r,s,l){var c=n===this.connection.authzid?e:n;if(void 0!==c){var u={id:void 0!==o&&null!==o?o:this.connection.getUniqueId(),from:n,ttl:void 0!==r?r:null,to:e,body:a,status:n===this.connection.authzid?this.MESSAGE_STATUS.SENDING:null,ts:(new Date).getTime(),media:{local:null,remote:null,status:null},metadata:void 0!==s&&null!==s?s:null,addresses:void 0!==l?l:null};return void 0!==i&&null!==i&&(void 0!==i.local&&(u.media.local=i.local),void 0!==i.remote&&(u.media.remote=i.remote),void 0!==i.status&&(u.media.status=i.status)),this.addHistory(c,u),this.getMessageFromHistory(c,u.id)}return t.error("Recipient required for a message."),null},p.prototype.getMessageFromHistory=function(e,t){var n=null;if(void 0!==cti.store.xmpp[this.id].history[e]){var a=cti.store.xmpp[this.id].history[e].messages;void 0!==a&&a.length>0&&a.forEach(function(e){e.id==t&&(n=e)})}return n},p.prototype.getMessageFromAllHistory=function(e){var t=cti.store.xmpp[this.id].history,n=null;if(void 0!==t)for(var a in t)null===n&&(n=this.getMessageFromHistory(a,e));return n},p.prototype.addHistory=function(e,t){void 0===cti.store.xmpp[this.id].history[e]&&(cti.store.xmpp[this.id].history[e]={messages:[],read:0,unread:0}),t.ts=(new Date).getTime(),cti.store.xmpp[this.id].history[e].messages.push(t)},p.prototype.saveAndUpdate=function(){n.save().then(function(){i.$emit("StoreHasChanged")})},p.prototype.purgeQue=function(){var e=!1,t=this;this.queue.forEach(function(n){var a=t.getMessageFromAllHistory(n);null!==a&&(a.status=t.MESSAGE_STATUS.FAILED,e=!0)}),e===!0&&this.saveAndUpdate()},p.prototype.cleanQueue=function(){if(void 0!==cti.store.xmpp[this.id]){var e=cti.store.xmpp[this.id].history,t=!1;if(void 0!==e){var n=this;for(var a in e){var i=e[a].messages;void 0!==i&&i.forEach(function(e){e.status===n.MESSAGE_STATUS.SENDING&&(e.status=n.MESSAGE_STATUS.FAILED,t=!0)})}}t===!0&&this.saveAndUpdate()}},p.prototype.getBareJid=function(e){var t=null;if(e.indexOf("/")>-1){var n=e.split("/");t=n[0]}return t},p}]),angular.module("app.core").factory("XmppFactory",["Xmpp","$q",function(e,t){function n(t){u[t.name]=new e(t.name,t.endpoint,t.actions,t["upload-jid"],t["read-receipts"],t["stay-connected"],t["multicast-jid"],t["ping-time"])}function a(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].send(e).then(function(){n.resolve(!0)})["catch"](function(e){n.reject(e)}):n.reject("XMPP instance with name '"+a+"' does not exist."):n.reject("XMPP instance name not specified."),n.promise}function i(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].sendToGroup(e).then(function(){n.resolve(!0)})["catch"](function(e){n.reject(e)}):n.reject("XMPP instance with name '"+a+"' does not exist."):n.reject("XMPP instance name not specified."),n.promise}function o(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].markRead(e).then(function(){n.resolve(!0)})["catch"](function(e){n.reject(e)}):n.reject("XMPP instance with name '"+a+"' does not exist."):n.reject("XMPP instance name not specified."),n.promise}function r(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?void 0!==e.id?(u[a].sendMarker(e.id,"acknowledged"),n.resolve()):n.reject("Message ID must be provided."):n.reject("XMPP instance with name '"+a+"' does not exist."):n.reject("XMPP instance name not specified."),n.promise}function s(e){var n=t.defer(),a=e.name,i=e.custom||e.status;return void 0!==a&&void 0!==i?void 0!==u[a]?u[a].setStatus(i).then(function(){n.resolve(!0)})["catch"](function(e){n.reject(e)}):n.reject("XMPP instance with name '"+a+"' does not exist."):n.reject("XMPP instance name not specified."),n.promise}function l(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].login(e.username,e.password).then(function(){n.resolve()})["catch"](function(e){n.reject(e)}):n.reject("XMPP instance with name '"+a+"' does not exist."):n.reject("XMPP instance name not specified."),n.promise}function c(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].logout().then(function(){n.resolve()})["catch"](function(e){n.reject(e)}):n.reject("XMPP instance with name '"+a+"' does not exist."):n.reject("XMPP instance name not specified."),n.promise}var u={},d={init:n,send:a,login:l,logout:c,markRead:o,setStatus:s,sendToGroup:i,markAcknowledged:r};return d}]),angular.module("app.core").factory("FileSystem",["Plugin","$q","Platform","electron","MimeTypes","$log",function(e,t,n,a,i,o){function r(){if($){var i=a.path.sep,o=a.app.getPath("userData"),r=o+i;return t.when(r)}if("winphone"==n.getName())return t.resolve("");var s=e.getSource("file");if(!s)return t.reject("File System unavailable on this platform: "+navigator.userAgent);var l=t.defer();switch(n.getName()){case"ios":l.resolve(s.documentsDirectory);break;case"android":l.resolve(s.externalDataDirectory);break;default:l.resolve(s.dataDirectory)}return l.promise}function s(){var e=t.defer();return r().then(function(t){w?("winphone"==n.getName()&&""===t&&(t+=".\\"),window.resolveLocalFileSystemURL(t,function(t){e.resolve(t)},function(t){e.reject(t)})):e.reject("Local file system unavailable on this platform.")})["catch"](function(t){e.reject(t)}),e.promise}function l(e){var n=t.defer();return r().then(function(t){$?a.fsplus.stat(t+e,function(a,o){a?n.reject({message:'Error obtaining file "'+e+'"',innerError:a}):n.resolve({name:e,filePath:t+e,mimeType:i.mimeTypeFromExtension(e),size:o.size})}):w?window.resolveLocalFileSystemURL(t+e,function(e){e.file(function(e){n.resolve({name:e.name||e.localURL,filePath:e.localURL,mimeType:i.mimeTypeFromExtension(e.name||e.localURL),size:e.size})})},function(t){n.reject({message:'Error obtaining file "'+e+'"',innerError:t})}):n.reject("Local file system unavailable on this platform: "+navigator.userAgent)})["catch"](function(t){n.reject({message:'Error obtaining file "'+e+'"',innerError:t})}),n.promise}function c(e){var n=t.defer();return r().then(function(t){$?a.fsplus.readFile(t+e,function(t,a){if(t)n.reject({message:'Error obtaining file blob for file "'+e+'"',innerError:t});else{var o=new Blob([a],{type:i.mimeTypeFromExtension(e)});n.resolve(o)}}):w?window.resolveLocalFileSystemURL(t+e,function(t){t.file(function(t){var a=new FileReader;a.onloadend=function(t){var a=new Blob([t.target.result],{type:i.mimeTypeFromExtension(e)});n.resolve(a)},a.readAsArrayBuffer(t)})},function(t){n.reject({message:'Error obtaining file blob for file "'+e+'"',innerError:t})}):n.reject("Unable to read file on this platform: "+navigator.userAgent)})["catch"](function(t){n.reject({message:'Error obtaining file blob for file "'+e+'"',innerError:t})}),n.promise}function u(e){return e.replace(/\\/g,"/").split("/").pop()}function d(e){return e.indexOf("/")==-1?e.substring(0,e.lastIndexOf("\\")+1):e.substring(0,e.lastIndexOf("/")+1)}function p(e,n){var o=t.defer();return r().then(function(t){var r=t+e,l=i.mimeTypeFromExtension(e);if($){var c=new Uint8Array(n),u=new Buffer(c);a.fsplus.writeFile(r,u,function(t){t?o.reject({message:'Error saving file "'+e+'"',
innerError:t}):o.resolve(r)})}else w?s().then(function(t){t.getFile(e,{create:!0,exclusive:!1},function(t){t.createWriter(function(a){a.onwriteend=function(){t.file(function(e){o.resolve(e.localURL)})},a.onerror=function(t){o.reject({message:'Error saving file "'+e+'"',innerError:t})};var i=new Blob([n],{type:l});a.write(i)})})}):o.reject("Unable to save file on this platform: "+navigator.userAgent)})["catch"](function(t){o.reject({message:'Error saving file "'+e+'"',innerError:t})}),o.promise}function m(e,n){var i=t.defer();return r().then(function(t){if($){var o=t+e,r=t+n;a.fsplus.rename(o,r,function(t){t?i.reject({message:'Error renaming file "'+e+'"',innerError:t}):i.resolve(r)})}else w?s().then(function(t){t.getFile(e,{create:!1,exclusive:!0},function(a){a.moveTo(t,n,function(e){e.file(function(e){i.resolve(e.localURL)})},function(t){i.reject({message:'Error renaming file "'+e+'"',innerError:t})})},function(t){i.reject({message:'Error renaming file "'+e+'"',innerError:t})})}):i.reject("Unable to rename file on this platform: "+navigator.userAgent)})["catch"](function(t){i.reject({message:'Error renaming file "'+e+'"',innerError:t})}),i.promise}function f(e,i){var o=t.defer();return r().then(function(t){if($){var r=t+i;a.fsplus.rename(e,r,function(t){t?o.reject({message:'Error moving file at "'+e+'"',innerError:t}):o.resolve(r)})}else if(w){"ios"!==n.getName()&&"android"!==n.getName()||e.indexOf("file://")==-1&&(e="file://"+e);var s=d(e),l=u(e);window.resolveLocalFileSystemURL(s,function(t){t.getFile(l,{create:!1,exclusive:!0},function(n){n.moveTo(t,i,function(e){e.file(function(e){o.resolve(e.localURL)})},function(t){o.reject({message:'Error moving file "'+e+'"',innerError:t})})},function(t){o.reject({message:'Error moving file "'+e+'"',innerError:t})})})}else o.reject("Unable to move file on this platform: "+navigator.userAgent)})["catch"](function(t){o.reject({message:'Error moving file "'+e+'"',innerError:t})}),o.promise}function g(n,a,i){var o=$?e.getSource("@commontimeltd/com.commontime.filetransfer"):e.getSource("FileTransfer");if(!o)return t.reject("File transfer plugin not available");var r=t.defer(),s={httpMethod:i.httpMethod,fileName:i.fileName||u(n),fileKey:i.fileKey,headers:i.headers},l=new o;return l.upload(n,a,function(e){r.resolve({source:n,target:a,response:e.response})},function(e){r.reject({message:'Error uploading file "'+n+'" to "'+a+'"',innerError:e})},s),r.promise}function v(n,a){function o(e){var t=e+a,o=new l;o.download(n,t,function(e){$?c.resolve({filePath:e.filePath,mimeType:i.mimeTypeFromExtension(e.filePath)}):e.file(function(e){c.resolve({filePath:e.localURL,mimeType:i.mimeTypeFromExtension(e.localURL)})},function(e){c.reject({message:'Error download file from "'+n+'" to "'+t+'"',innerError:e})})},function(e){c.reject({message:'Error download file from "'+n+'" to "'+t+'"',innerError:e})})}var l=$?e.getSource("@commontimeltd/com.commontime.filetransfer"):e.getSource("FileTransfer");if(!l)return t.reject("File transfer plugin not available");$?r().then(function(e){o(e)}):s().then(function(e){o(e.nativeURL)});var c=t.defer();return c.promise}function h(){var e=t.defer(),n=new Date,a=n.getTime(),i=a+".m4a";return r().then(function(t){0===t.indexOf("file://")&&(t=t.replace("file://",""));var n=t+i;e.resolve(n)})["catch"](function(e){o.error(e)}),e.promise}function y(e){var i=t.defer(),r=function(){o.error(arguments),i.reject(arguments)};if(void 0===e||null===e)r("Could not delete media item - no uri specified");else if($||w)if($)try{a.fsplus.existsSync(e)===!1?r("Error deleting file - file doesn't exist"):a.fsplus.isFileSync(e)===!1?r("Error deleting file - path wasn't a file"):(a.fsplus.removeSync(e),i.resolve())}catch(s){r("Error deleting file",s)}else try{var l=e.indexOf("file://")==-1;"winphone"!=n.getName()&&l&&(e="file://"+e),window.resolveLocalFileSystemURL(e,function(t){t.isDirectory?r("Error getting file to delete - file uri resolved to a directory: ",e):t.remove(function(){i.resolve()},function(e){r("Error deleting the file: ",e)})},function(e){r("Error getting file entry",e)})}catch(s){r("Error deleting file: ",s)}else r("resolveLocalFileSystemURL is not available - platform could not be detected");return i.promise}function b(e){var n=t.defer(),o=[];if(void 0!==e&&e.length>0){var s=[];e.forEach(function(e){var t=i.extensionFromMimeType(e);null!==t&&s.push(t)}),s.length>0&&o.push({name:"Mimes",extensions:s})}return a.dialog.showOpenDialog({properties:["openFile","singleSelection"],filters:o},function(e){void 0==e||void 0!=e&&0==e.length||r().then(function(t){var i=e[0],o=u(i),r=t+o;a.fsplus.copy(e[0],r,function(e){return e?console.error(e):void n.resolve(r)})})}),n.promise}var $=void 0!==a.app,w=void 0!==window.resolveLocalFileSystemURL;return{getStorageLocation:r,getStorage:s,getFile:l,getFileBlob:c,getFileNameFromPath:u,saveFile:p,renameFile:m,moveFileToStorage:f,upload:g,download:v,generateFileName:h,deleteMediaItem:y,selectFile:b}}]),angular.module("app.core").factory("Platform",["StoreFactory",function(e){function t(){e.set("env.platform.type",n()),e.set("env.platform.name",a())}function n(){return/iPhone|iPad|iPod|IEMobile|Android/i.test(navigator.userAgent)?"device":/Electron/i.test(navigator.userAgent)?"desktop":/Chrome/i.test(navigator.userAgent)||/Firefox/i.test(navigator.userAgent)||o.test(navigator.userAgent)?"browser":null}function a(){return/IEMobile/i.test(navigator.userAgent)||/Windows Phone 8\.1/i.test(navigator.userAgent)?"winphone":/Android/i.test(navigator.userAgent)?"android":/iPhone|iPad|iPod/i.test(navigator.userAgent)?"ios":/Electron/i.test(navigator.userAgent)?"electron":/Chrome/i.test(navigator.userAgent)?"chrome":/Firefox/i.test(navigator.userAgent)?"firefox":o.test(navigator.userAgent)?"internet_explorer":null}var i={init:t,getType:n,getName:a},o=navigator.userAgent.indexOf("MSIE")!=-1?/MSIE (\d+\.\d+);/:/Trident.*rv[ :]*(\d+\.\d+)/;return i}]),angular.module("app.core").factory("InboxOutboxFactory",["$q","$log","$injector","Plugin","Utilities","electron",function(e,t,n,a,i,o){function r(){var t=sessionStorage.getItem("debug");if(t){var a=t.split("|");R=a.indexOf("*")!==-1||a.indexOf("inboxoutbox")!==-1}if(k('Ensuring "InboxOutbox" factory is initialised...'),j)return e.when();var i=e.defer();return G=n.get("SchemaService"),B=n.get("ActionFactory"),x().then(function(){V===!1?i.reject('Unable to initialise "notify" plugin'):setTimeout(function(){k("Registering global outbox and inbox change handlers"),V.receiveInboxChanges(_,S),V.receiveOutboxChanges(_,T),L=!0,i.resolve()},0)})["catch"](function(e){I(e)}),j=!0,i.promise}function s(t){if(!L)return e.reject("Notfiy plugin not initialised");var n=e.defer();return k('Setting "notify" options:',t),V.setOptions(function(){n.resolve()},function(){n.reject("Error setting message queue options")},t),n.promise}function l(e){return U?a.getSource("@commontimeltd/com.commontime."+e):a.getSource(e)}function c(t){return k("Registering provider with InboxOutboxFactory:",t),q[t.name]={outboxChangeCallback:t.outboxChangeCallback,inboxChangeCallback:t.inboxChangeCallback},e.when(q[t.name])}function u(){return G.isPreview()||G.isLivePreview()}function d(e){return"REQUEST_"+e.toUpperCase()+"_"+i.uuid()}function p(t){return L?A("addChannel",[t]):e.reject("Notfiy plugin not initialised")}function m(t){return L?A("removeChannel",[t]):e.reject("Notfiy plugin not initialised")}function f(t){return L?(k("Sending message...",t),A("sendMessage",[t])):e.reject("Notfiy plugin not initialised")}function g(t,n){return L?(k('Acknowledging message id "'+n+'" for receiver "'+t+'"'),A("messageReceivedAck",[t,n])):e.reject("Notfiy plugin not initialised")}function v(t){return L?(k('Deleting message "'+t+'"'),A("deleteMessage",[t])):e.reject("Notfiy plugin not initialised")}function h(e){return e.hasOwnProperty(G.ITEM_AUTO_ID_PROPERTY)?e[G.ITEM_AUTO_ID_PROPERTY]:null}function y(e){return G.findItemById(e)}function b(e,t,n){return k('Calling "'+t+'" actions from',e,"with model",n),B.triggerEvent(t,e,n)}function $(t,n,a){return k("Looking for child actions of:",t),null===t||!t.actions instanceof Array?e.when():b(t.actions,n,a)}function w(){return R===!0}function T(e,t){setTimeout(function(){k("Outbox change received:",t);var n=E(t),a=C(n);null!==a&&"function"==typeof a.outboxChangeCallback&&(k('Routing outbox change to provider "'+n+'"'),a.outboxChangeCallback(e,t))},0)}function S(e,t){setTimeout(function(){k("Inbox change received:",t);var n=E(t),a=C(n);null!==a&&"function"==typeof a.inboxChangeCallback&&(k('Routing inbox change to provider "'+n+'"'),a.inboxChangeCallback(e,t))},100)}function x(){var t=e.defer();return k('Obtaining "nofity" plugin...'),V=D===!0?F():U?a.getSource("@commontimeltd/com.commontime.notify"):a.getSource("notify"),t.resolve(V),t.promise}function A(t,n){var a=e.defer();return n.push(function(e,t){e?a.reject(e):a.resolve(t)}),V[t].apply(V,n),a.promise}function E(e){var t=e.message.provider;return t||(t=P),t}function C(e){return q.hasOwnProperty(e)?q[e]:null}function k(){if(R===!0&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[inboxOutbox.fct.js] "+e[0]),t.log.apply(t,e)}}function I(){if(void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[inboxOutbox.fct.js] "+e[0]),t.error.apply(t,e)}}function F(){function e(e,t){setTimeout(function(){e(void 0,t)},n)}t.info("*** USING MOCK NOTIFY PLUGIN: Turn this off in inboxOutbox.fct.js if you expect to use the real plugin ***");var n=500;return{___queues:{},___localChannels:[],___onInboxChange:null,___onOutboxChange:null,addChannel:function(t,n){k("addChannel called with arguments:",arguments),this.___localChannels.indexOf(t)===-1&&this.___localChannels.push(t),e(n,t)},removeChannel:function(t,n){k("removeChannel called with arguments:",arguments);var a=this.___localChannels.indexOf(t);a!==-1&&this.___localChannels.splice(a,1),e(n,t)},sendMessage:function(t,n){k("sendMessage called with arguments:",arguments),this.___queues[t.channel]||(this.___queues[t.channel]=[]);var a="Message_"+i.uuid();if(t.id=a,t.date=(new Date).getTime(),this.___queues[t.channel].push(t),this.___localChannels.indexOf(t.channel)!==-1){if("function"==typeof this.___onOutboxChange){var o={action:"SENDING",message:t},r={action:"SENT",message:t};this.___onOutboxChange(void 0,o),this.___onOutboxChange(void 0,r)}if("function"==typeof this.___onInboxChange){var s={action:"create",message:t};this.___onInboxChange(void 0,s)}}e(n,a)},deleteMessage:function(t,n){k("deleteMessage called with arguments:",arguments);for(var a in this.___queues)if(this.___queues.hasOwnProperty(a))for(var i=this.___queues[a].length-1;i>=0;i--)this.___queues[a][i].id===t&&this.___queues[a].splice(i,1);e(n,t)},messageReceivedAck:function(t,n,a){k("messageReceivedAck called with arguments:",arguments),e(a,null)},receiveInboxChanges:function(e,t){k("receiveInboxChanges called with arguments:",arguments),this.___onInboxChange=t},receiveOutboxChanges:function(e,t){k("receiveOutboxChanges called with arguments:",arguments),this.___onOutboxChange=t}}}var D=!1,_="com.commontime.inboxOutbox",P="azure.servicebus",N="azure.appservices",M="rest",O=null,R=!1,U=void 0!==o.app,j=!1,L=!1,q={},V=null,G=null,B=null;return{init:r,setOptions:s,getProviderPlugin:l,registerProvider:c,isFromStudio:u,generateRequestId:d,addChannel:p,removeChannel:m,sendMessage:f,acknowledgeMessage:g,deleteMessage:v,getActionId:h,getActionById:y,callActions:b,callChildActions:$,isDebugMode:w,USE_MOCK_PLUGIN:D,PROVIDER_AZURESERVICEBUS:P,PROVIDER_AZUREAPPSERVICES:N,PROVIDER_REST:M,PROVIDER_UNKNOWN:O}}]),angular.module("app.core").factory("MessageQueueFactory",["$q","$log","InboxOutboxFactory","StoreFactory",function(e,t,n,a){function i(t){if(E)return e.when();var a=e.defer();return n.init().then(function(){h("Initialising message queue providers with schema...",t);var e=t.settings["message-queue"],n=u(e);0===n.length&&(h("No message queue providers enabled"),a.resolve()),I=p(n),m().then(function(){return f(n)}).then(function(){return g(t)}).then(function(){return v()}).then(function(){C=!0,a.resolve()})["catch"](function(e){y(e),a.reject(e)})})["catch"](function(e){y(e),a.reject(e)}),E=!0,a.promise}function o(t){if(!C)return e.reject("Message Queue plugin not initialised");if(!t)return e.reject('Invalid message queue name "'+t+'"');h('Listening to queue "'+t+'"...');var a=n.addChannel(t);return a.then(function(){h('Adding "'+t+'" to store'),$(t)}),a}function r(t){if(!C)return e.reject("Message Queue plugin not initialised");if(!t)return e.reject('Invalid message queue name "'+t+'"');h('Stopped listening to queue "'+t+'"...');var a=n.removeChannel(t);return a.then(function(){h('Removing "'+t+'" from store'),w(t)}),a}function s(t,a){if(!C)return e.reject("Message Queue plugin not initialised");if(!t)return e.reject('Invalid message queue name "'+t+'"');if(!a)return e.reject('Invalid message content "'+a+'"');var i=new Date,o=i.getUTCFullYear()+1,r=Date.UTC(o,i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds()),s={channel:t,subchannel:A,expiry:r,provider:I.name,notification:"",content:{data:a}};return n.sendMessage(s)}function l(e,t){return e?void y(e):void("sent"===t.action.toLowerCase()&&k.onSent.length&&(h('Triggering "message sent" event'),n.callActions(k.onSent,"click",{$messageId:t.message.id})))}function c(e,t){if(e)y(e);else if("create"===t.action.toLowerCase()&&k.onReceived.length){var a={$message:{id:t.message.id,queue:t.message.channel,body:t.message.content.data,sent:parseInt((t.message.date||0).toString()),received:parseInt((new Date).getTime().toString())}};h('Triggering "message received" event'),n.callActions(k.onReceived,"click",a).then(function(){n.acknowledgeMessage(x,t.message.id),n.deleteMessage(t.message.id)})}}function u(e){var t=[],a=e.asb||{};if(a.enabled===!0){h('Obtaining provider "'+n.PROVIDER_AZURESERVICEBUS+'"...');var i={sbHostName:a.hostName,serviceNamespace:a.serviceNamespace,sasKeyName:a.keyName,sasKey:a.key,brokerType:a.brokerType,brokerAutoCreate:!0};t.push({name:n.PROVIDER_AZURESERVICEBUS,loadProviderPromise:d("asb",i)})}return t}function d(t,a){var i=e.defer();h('Initialising "'+t+'" message queue provider...');var o=n.USE_MOCK_PLUGIN===!0?T(t):n.getProviderPlugin(t);return o===!1?i.reject('Unable to initialise "'+t+'" plugin'):n.isFromStudio()?(h('...running from Studio - injecting "'+t+'" message queue preferences:',a),o.start(i.resolve,i.reject,a)):(h('...using "'+t+'" message queue preferences from configuration file'),o.start(i.resolve,i.reject)),i.promise}function p(e){return e.length>0?e[0]:null}function m(){var t=e.defer();if(n.isFromStudio())if(null!==I){var a={defaultPushSystem:I.name};n.setOptions(a).then(function(){t.resolve()})["catch"](function(e){t.reject(e)})}else t.reject("No default push system was specified");else h("Options being obtained from config.xml / package.json"),t.resolve();return t.promise}function f(t){var a=[];return angular.forEach(t,function(t){var i=e.defer();t.loadProviderPromise.then(function(){h('Registering message queue provider "'+t.name+'"');var e={name:t.name,outboxChangeCallback:l,inboxChangeCallback:c};n.registerProvider(e).then(function(){i.resolve()})}),a.push(i)}),e.all(a)}function g(t){var n=e.defer();return t&&t.config&&t.config.length&&angular.forEach(t.config,function(e){if("message-queue-event"===e["item-type"])switch((e.eventType||"").toLowerCase()){case"ready":k.onReady=k.onReady.concat(e.actions);break;case"received":k.onReceived=k.onReceived.concat(e.actions);break;case"sent":k.onSent=k.onSent.concat(e.actions);break;default:y('Unknown message queue event type "'+e.eventType+'"')}}),h("Registered actions:",k),n.resolve(),n.promise}function v(){var t=e.defer();return setTimeout(function(){var e=b();e.length&&(h("Re-adding queues:",e),angular.forEach(e,function(e){n.addChannel(e)})),h('Triggering "ready" event'),n.callActions(k.onReady,"click"),t.resolve()},0),t.promise}function h(){if(n.isDebugMode()&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[messageQueue.fct.js] "+e[0]),t.log.apply(t,e)}}function y(){if(void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[messageQueue.fct.js] "+e[0]),t.error.apply(t,e)}}function b(){var e=a.get(S)||{};return e.listeningTo||[]}function $(e){var t=b();t.push(e),a.set(S,{listeningTo:t})}function w(e){var t=b(),n=t.indexOf(e);n!==-1&&(t.splice(n,1),a.set(S,{listeningTo:t}))}function T(e){function n(n,a){t.info("*** USING MOCK "+e.toUpperCase()+" PLUGIN: Set USE_MOCK_PLUGIN to false in inboxOutbox.fct.js if you expect to use the real plugin ***");var i=500;setTimeout(function(){n(void 0,a)},i)}return{start:function(e,t,a){h("start called with arguments:",arguments),n(e,"ok")}}}var S="messageQueues",x="com.commontime.infinity.messageQueue",A="default",E=!1,C=!1,k={onReady:[],onReceived:[],onSent:[]},I=null;return{init:i,startListening:o,stopListening:r,sendMessage:s}}]),angular.module("app.core").factory("RestFactory",["$q","$log","InboxOutboxFactory","Api","StoreFactory","Utilities","FileSystem","MimeTypes",function(e,t,n,a,i,o,r,s){function l(){if(x)return e.when();var t=e.defer();return n.init().then(function(){return m()}).then(function(){var e={name:n.PROVIDER_REST,outboxChangeCallback:d,inboxChangeCallback:p};return n.registerProvider(e)}).then(function(){A=!0,t.resolve()})["catch"](function(e){$(e),t.reject(e)}),x=!0,t.promise}function c(e){b("Registering Offline API item:",e),E.push(e)}function u(t){if(!A)return e.reject(S+" plugin not initialised");b("Making request for action:",t);var i=n.getActionId(t),o=t.data.name,r=t.data.operation,s=f(o),l=g(s,r);if(null===l)return e.reject('Unknown operation "'+r+'"');b('Invoking operation "'+r+'" with config:',l);var c=new a(s.name,s.url,s.params,s.headers,s.operations);return c.buildRequestObject(l,t.data.params,v).then(function(e){l.downloadAsFile===!0&&(e.downloadAsFile=l.downloadAsFile,e.downloadFileName=l.downloadFileName),e.invokingActionId=i;var a=l.ttlMinutes;void 0===a&&(a=60);var o=0;if(0===a)o=0;else{var r=new Date;o=Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds()),o+=60*a*1e3}var s=n.generateRequestId(n.PROVIDER_REST),c={channel:T,subchannel:s,provider:n.PROVIDER_REST,expiry:o,content:e};n.sendMessage(c)["catch"](function(e){$(e),n.callChildActions(t,"fail",{$response:e})})}),e.when(!0)}function d(e){void 0!==e&&$(e)}function p(e,t){if(void 0!==e)$(e);else if("create"===t.action.toLowerCase()){var a=h(t);if(null===a)b("Unable to handle inbox change - no message request data found in result:",t);else{var o=a.invokingActionId,r=n.getActionById(o);null!==r&&y(t).then(function(e){b("Parsed response:",e),e.isSuccess&&i.set("offlineApi."+r.data.name+"."+r.data.operation,e.responseData);var a=e.isSuccess?"success":"fail";b('Calling child "'+a+'" actions of action id "'+o+'" with model:',e.responseData),n.callChildActions(r,a,{$response:e.responseData}),n.deleteMessage(t.message.id)})}}}function m(){var t=e.defer();b('Initialising "'+S+'" plugin...');var a=n.USE_MOCK_PLUGIN===!0?w():n.getProviderPlugin(S);return a===!1?t.reject('Unable to initialise "'+S+'" plugin'):a.start(t.resolve,t.reject),t.resolve(),t.promise}function f(e){var t=E.filter(function(t){return t.name===e});return t.length?t[0]:null}function g(e,t){if(!e||!e.operations||!e.operations.length)return null;var n=e.operations.filter(function(e){return e.name===t});return n.length?n[0]:null}function v(n,a,i){var o=e.defer();if("formData"===a["in"]&&"file"===a.type){var l=i,c=r.getFileNameFromPath(l),u=a.typeConfig.base64encode;u?r.getFileBlob(c).then(function(e){var t=new FileReader;t.onloadend=function(e){n.headers["Content-Type"]="application/json",n.data[a.name]=e.target.result,a.typeConfig.fileNameParameterName&&(n.data[a.typeConfig.fileNameParameterName]=c),o.resolve(!0)},t.readAsDataURL(e)})["catch"](function(e){t.error(e),o.resolve(!1)}):(n.headers["Content-Type"]=s.mimeTypeFromExtension(l),n.data=i,n.uploadAsFile=!0,n.uploadAsMultipartForm=!0,n.formPartName=a.name,n.formPartFilename=c,o.resolve(!0))}else o.resolve(!1);return o.promise}function h(e){return e.message&&e.message.content?e.message.content.config:null}function y(t){if(!t.message||!t.message.content)return e.when({isSuccess:!1,responseData:"Invalid response message"});var n=parseInt(t.message.content.status||-1),a=n<=0||n>=400;if(a)return e.when({isSuccess:!1,responseData:{status:t.message.content.status,statusText:t.message.content.statusText,message:t.message.content.data}});var i=e.defer(),l=h(t),c=t.message.content.data,u=t.message.content.headers;if(l&&l.downloadAsFile===!0&&u){b("Response is downloaded file; file path:",c);var d=c,p="";if((l.downloadFileName||"").trim().length>0)p=l.downloadFileName;else{p=o.uuid();var m=(u["Content-Type"]||"").split(";")[0].trim(),f=s.extensionFromMimeType(m);null!==f&&(p+="."+f)}r.moveFileToStorage(d,p).then(function(e){i.resolve({isSuccess:!0,responseData:e})})["catch"](function(e){i.resolve({isSuccess:!1,responseData:e})})}else i.resolve({isSuccess:!0,responseData:c});return i.promise}function b(){if(n.isDebugMode()&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[rest.fct.js] "+e[0]),t.log.apply(t,e)}}function $(){if(void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[rest.fct.js] "+e[0]),t.error.apply(t,e)}}function w(){function e(e,n){t.info("*** USING MOCK "+S.toUpperCase()+" PLUGIN: Set USE_MOCK_PLUGIN to false in inboxOutbox.fct.js if you expect to use the real plugin ***");var a=500;setTimeout(function(){e(void 0,n)},a)}return{start:function(t,n){b("start called with arguments:",arguments),e(t,"ok")}}}var T="inboxoutbox."+n.PROVIDER_REST,S="rest",x=!1,A=!1,E=[];return{init:l,registerOfflineApi:c,makeRequest:u}}]),angular.module("app.core").factory("AzureAppServicesFactory",["$q","$log","InboxOutboxFactory","StoreFactory",function(e,t,n,a){function i(t){if(b)return e.when();var a=e.defer();return w=t,n.init().then(function(){return c(t)}).then(function(){var e={name:n.PROVIDER_AZUREAPPSERVICES,outboxChangeCallback:s,inboxChangeCallback:l};return n.registerProvider(e)}).then(function(){$=!0,a.resolve()})["catch"](function(e){g(e),a.reject(e)}),b=!0,a.promise}function o(t){if(!$)return e.reject(y+" plugin not initialised");f("Making request for action:",t);var a=n.getActionId(t),i=t.data.operation,o=u(i);if(null===o)return e.reject('Unknown operation "'+i+'"');var r=o.path;f('Invoking operation "'+r+'" with config:',o);var s={transport:{type:"zumoDirect",httpMethod:o.method,api:r},invokingActionId:a};if(t.data.params){s.data={};for(var l in t.data.params)if(t.data.params.hasOwnProperty(l)){var c=d(o,l);if(null!==c)switch(c.type){case"fileref":s.data[l]="#fileref:"+t.data.params[l];break;default:s.data[l]=t.data.params[l]}}}var p=o.ttlMinutes;void 0===p&&(p=60);var m=0;if(0===p)m=0;else{var v=new Date;m=Date.UTC(v.getUTCFullYear(),v.getUTCMonth(),v.getUTCDate(),v.getUTCHours(),v.getUTCMinutes(),v.getUTCSeconds()),m+=60*p*1e3}var b=n.generateRequestId(n.PROVIDER_AZUREAPPSERVICES),w={channel:h,subchannel:b,provider:n.PROVIDER_AZUREAPPSERVICES,expiry:m,content:s};return n.sendMessage(w)["catch"](function(e){g(e),n.callChildActions(t,"fail",{$response:e})}),e.when(!0)}function r(){if(!$)return e.reject(y+" plugin not initialised");var t=e.defer();f("Attempting logout");var a=n.USE_MOCK_PLUGIN===!0?v():n.getProviderPlugin(y);return a===!1?t.reject('Unable to initialise "'+y+'" plugin'):a.logout(t.resolve,t.reject),t.promise}function s(e){void 0!==e&&g(e)}function l(e,t){if(void 0!==e)g(e);else if("create"===t.action.toLowerCase()){var i=p(t);if(null===i)f("Unable to handle inbox change - no message request data found in result:",t);else{var o=i.invokingActionId,r=n.getActionById(o);null!==r&&m(t).then(function(e){f("Parsed response:",e),e.isSuccess&&a.set("azureAppServices."+r.data.name+"."+r.data.operation,e.responseData);var i=e.isSuccess?"success":"fail";f('Calling child "'+i+'" actions of action id "'+o+'" with model:',e.responseData),n.callChildActions(r,i,{$response:e.responseData}),n.deleteMessage(t.message.id)})}}}function c(t){var a=e.defer();f('Initialising "'+y+'" plugin...');var i=n.USE_MOCK_PLUGIN===!0?v():n.getProviderPlugin(y);if(i===!1)a.reject('Unable to initialise "'+y+'" plugin');else if(n.isFromStudio()){var o={url:t.aasUrl,authenticationMethod:t.aasAuthenticationMethod,useBlobStorage:t.aasUseBlobStorage};f('...running from Studio - injecting "'+y+'" preferences:',o),i.start(a.resolve,a.reject,o)}else f('...using "'+y+'" preferences from configuration file'),i.start(a.resolve,a.reject);return a.resolve(),a.promise}function u(e){if(!w.operations||!w.operations.length)return null;var t=w.operations.filter(function(t){return t.name===e});return t.length?t[0]:null}function d(e,t){if(!e||!e.params.length)return null;var n=e.params.filter(function(e){return e.name===t});return n.length?n[0]:null}function p(e){return e.message&&e.message.content?e.message.content.config:null}function m(t){if(!t.message||!t.message.content)return e.when({isSuccess:!1,responseData:"Invalid response message"});var n=e.defer(),a=t.message.content.errorType&&t.message.content.errorMessage;return a?n.resolve({isSuccess:!1,responseData:t.message.content.errorMessage}):n.resolve({isSuccess:!0,responseData:t.message.content.response}),n.promise}function f(){if(n.isDebugMode()&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[azureAppServices.fct.js] "+e[0]),t.log.apply(t,e)}}function g(){if(void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[azureAppServices.fct.js] "+e[0]),t.error.apply(t,e)}}function v(){function e(e,n){t.info("*** USING MOCK "+y.toUpperCase()+" PLUGIN: Set USE_MOCK_PLUGIN to false in inboxOutbox.fct.js if you expect to use the real plugin ***");var a=500;setTimeout(function(){e(void 0,n)},a)}return{start:function(t,n,a){f("start called with arguments:",arguments),e(t,"ok")},logout:function(t,n){f("logout called with arguments:",arguments),e(t,"ok")}}}var h="inboxoutbox."+n.PROVIDER_AZUREAPPSERVICES,y="zumo",b=!1,$=!1,w=null;return{init:i,makeRequest:o,logout:r}}]),angular.module("app.core").factory("DataflowFactory",["Dataflow","$q",function(e,t){function n(t,n){i[t]=new e(n)}function a(e,n){var a=t.defer();return void 0!=i[e]&&i[e].execute(n).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)}),a.promise}var i={},o={init:n,execute:a};return o}]),angular.module("app.core").factory("Dataflow",["$log","$q","$injector","StoreFactory","localStorageService",function($log,$q,$injector,StoreFactory,localStorageService){function Dataflow(e){this.steps=e,this.debug="true"==localStorageService.get("debug")}function __copy(e){return JSON.parse(JSON.stringify(e))}return Dataflow.prototype={execute:function(data){var deferred=$q.defer(),$scope=this;if(void 0!==$scope.steps){var result=[],_data=data;angular.isObject(data)&&!angular.isArray(data)&&(_data=[data]);var source=Rx.Observable.from(_data),$store=cti.store,ActionFactory=$injector.get("ActionFactory");$scope.debug&&$log.log("========== WORKFLOW =========="),this.steps.forEach(function(step){switch(step["item-type"]){case"map":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content&&step.content.length>0?(eval("var stepFunction = function($data){ "+step.content+" }"),source=source.map(stepFunction)):void 0!==step.xpath&&step.xpath.length>0?source=source.map(function(e){var t=JSON.search(e,step.xpath);return $scope.debug&&($log.log("[MAP] - XPATH RESULT:",t[0]),$log.log("============  ============")),1===t.length?t[0]:t}):$log.error("No xpath or code has been added for a 'map' step.");break;case"selectMany":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content&&step.content.length>0?(eval("var stepFunction = function($data, $index){ "+step.content+" }"),source=source.flatMap(stepFunction)):void 0!==step.xpath&&step.xpath.length>0?source=source.flatMap(function(e){var t=JSON.search(e,step.xpath);return $scope.debug&&($log.log("[SELECT MANY] - XPATH RESULT:",t[0]),$log.log("============  ============")),1===t.length?t[0]:t}):$log.error("No xpath or code has been added for a 'selectMany' step.");break;case"reduce":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content&&step.content.length>0?(eval("var stepFunction = function($acc, $current, $index, $source){ "+step.content+"; }"),source=source.reduce(stepFunction)):void 0!==step.xpath&&step.xpath.length>0?source=source.reduce(function(e){var t=JSON.search($data,step.xpath);return $scope.debug&&($log.log("[REDUCE] - XPATH RESULT:",t[0]),$log.log("============  ============")),1===t.length?t[0]:t}):$log.error("No xpath or code has been added for a 'reduce' step.");break;case"some":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content&&step.content.length>0?(eval("var stepFunction = function($data){ "+step.content+"; }"),source=source.some(stepFunction)):void 0!==step.xpath&&step.xpath.length>0?source=source.some(function(e){var t=JSON.search(e,step.xpath);return $scope.debug&&($log.log("[SOME] - XPATH RESULT:",t[0]),$log.log("============  ============")),1===t.length?t[0]:t}):$log.error("No xpath or code has been added for a 'some' step.");break;case"convert":step=StoreFactory.parse(angular.copy(step),{$data:_data},!1),void 0!==step.content?source=source.map(function(stepData){var template=null;try{eval("template = "+step.content)}catch(e){$log.error(e)}if(null!==template){var res=jsonapter.instance().run(template,stepData);return $scope.debug&&($log.log("[CONVERT] - TEMPLATE:",template),$log.log("[CONVERT] - JSONAPTER RESULT:",res),$log.log("============  ============")),res}}):$log.error("No template has been added for a 'convert' step.");break;case"take":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content?source=source.take(step.content):$log.error("No value has been added for a 'take' step.");break;case"every":void 0!==step.content&&step.content.length>0?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($data){ "+step.content+"; }"),source=source.every(stepFunction)):void 0!==step.operations&&step.operations.length>0?source=source.every(function(e){return ActionFactory.evalOperations(__copy(step.operations),{$data:e,$store:$store})}):$log.error("No expression or code has been added for an 'every' step.");break;case"filter":void 0!==step.content&&step.content.length>0?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $index, $source){ "+step.content+" }"),source=source.filter(stepFunction)):void 0!==step.operations&&step.operations.length>0?source=source.filter(function(e,t,n){return ActionFactory.evalOperations(__copy(step.operations),{$current:e,$index:t,$source:n,$store:$store})}):$log.error("No expression or code has been added for a 'filter' step.");break;case"find":void 0!==step.content&&step.content.length>0?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $index, $source){ "+step.content+"; }"),source=source.find(stepFunction)):void 0!==step.operations&&step.operations.length>0?source=source.find(function(e,t,n){return ActionFactory.evalOperations(__copy(step.operations),{$current:e,$index:t,$source:n,$store:$store})}):$log.error("No expression or code has been added for a 'find' step.");break;case"toArray":source=source.toArray();break;case"max":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $next){ "+step.content+"; }"),
source=source.average(stepFunction)):source=source.max();break;case"min":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $next){ "+step.content+"; }"),source=source.average(stepFunction)):source=source.min();break;case"sum":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $index, $source){ "+step.content+"; }"),source=source.average(stepFunction)):source=source.sum();break;case"count":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current){ "+step.content+"; }"),source=source.average(stepFunction)):source=source.count();break;case"average":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($data){ "+step.content+"; }"),source=source.average(stepFunction)):source=source.average()}}),source.subscribe(function(e){$scope.debug&&($log.log("ON NEXT:",e),$log.log("============  ============")),result.push(e)},function(e){$log.error(e),deferred.reject(e)},function(){var e=1===result.length?result[0]:result;$scope.debug&&($log.log("COMPLETED:",e),$log.log("===========================")),deferred.resolve(e)})}return deferred.promise}},Dataflow}]),angular.module("app.core").factory("ActionflowFactory",["Actionflow","$q",function(e,t){function n(t,n){i[t]=new e(n)}function a(e,n){var a=t.defer();return void 0!=i[e]&&i[e].execute(n).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)}),a.promise}var i={},o={init:n,execute:a};return o}]),angular.module("app.core").factory("Actionflow",["$log","$q","$injector","localStorageService",function(e,t,n,a){function i(e){this.actions=e,this.debug="true"==a.get("debug")}return i.prototype={execute:function(e){var t=n.get("ActionFactory");return t.triggerEvent(null,this.actions,e)}},i}]),angular.module("app.core").factory("AudioPlayer",["$q","Plugin","electron","$interval","$log","$timeout",function(e,t,n,a,i,o){function r(e){var t=0,n=0;return e>0&&(t=Math.floor(e%60),n=Math.floor(e/60)),""+n+":"+(t<10?"0":"")+t}function s(e,t){return null===d?void i.error("Audio has not been initialised yet, cannot continue."):void d.getCurrentPosition(function(n){e({state:t,position:n>-1?n:0,currentTime:r(n)})})}function l(e,t){function r(e){switch(e){case c.MEDIA_RUNNING:m=a(function(){s(t,"running")},50);break;case c.MEDIA_NONE:case c.MEDIA_STOPPED:a.cancel(m),o(function(){s(t,"stopped")},60);break;case c.MEDIA_PAUSED:a.cancel(m),o(function(){s(t,"paused")},60)}}if(null!==d){d.release();for(var l in u)void 0!==u[l]&&(a.cancel(m),s(u[l],"stopped"),u[l]=void 0)}u[e]=t,void 0!==n.app?(d={change:function(e){r(e)},play:function(){p.play(),d.change(c.MEDIA_RUNNING)},pause:function(){p.pause(),d.change(c.MEDIA_PAUSED)},stop:function(){p.pause(),p.currentTime=0,d.change(c.MEDIA_STOPPED)},getCurrentPosition:function(e){p.ended===!0&&d.stop(),e(p.currentTime)},getDuration:function(){return p.duration},release:function(){p.currentTime=0,d.change(c.MEDIA_NONE)}},p.onloadeddata=function(){d.play()},p.setAttribute("src",e)):(d=new c(e,function(){},function(e){i.error("Audio Error:",e)},r),d.play())}var c=t.getSource("Media"),u={},d=null,p=document.createElement("audio");p.setAttribute("preload","auto");var m=null;return{getDuration:function(e,a){if(void 0!==e&&0!==e.length)if(void 0!==n.app){var o=document.createElement("audio");o.setAttribute("preload","auto"),o.onloadeddata=function(e){a(e.currentTarget.duration,r(e.currentTarget.duration))},o.setAttribute("src",e)}else{var s=t.getSource("mediaproperties");if(s===!1)return;s.getProperties(function(e){a(e.duration,r(e.duration))},function(e){i.error("Audio Error, couldn't get media properties:",e)},e)}},play:function(e,t){l(e,t)},stop:function(){null!==d&&d.stop()},pause:function(){null!==d&&d.pause()},unpause:function(){null!==d&&d.play()}}}]),angular.module("mobile-router",["LocalStorageModule"]),angular.module("mobile-router").provider("RouterConfig",function(){this.options={},this.set=function(e,t){switch(e){case"id":this.options.id=t;break;case"startPage":this.options.startPage=t;break;case"mode":switch(t){case"allin":case"intelligent":case"single":this.options[e]=t;break;default:console.log("Invalid Value: An invalid value for option 'mode' was specified.")}break;case"animation":switch(t){case"off":case"slide-in":case"slide-out":case"flip-in":case"fade-in":case"rotate-in-left":this.options[e]=t;break;default:console.log("Invalid Value: An invalid value for option 'animation' was specified.")}break;default:console.log("Invalid Option: An invalid option was specified.")}};var e=this;this.$get=function(){return{options:e.options,set:e.set}}}),angular.module("mobile-router").factory("RouteStack",["localStorageService",function(e){function t(t){l=t;var n=e.get(l+"_stack");null!=n&&(c=angular.fromJson(n))}function n(){return c[c.length-1]}function a(e){c=[n(),e];var t=n();void 0!==t&&(cti.store.state.currentPage=t.replace("/","")),r()}function i(){return c[0]}function o(e){var t=!1;angular.forEach(c,function(n,a){e==n&&(t=a)}),t!==!1&&(c.splice(t,1),r())}function r(){null!=l&&e.set(l+"_stack",c)}function s(){null!=l&&(c=[],e.remove(l+"_stack"))}var l=null,c=[],u={init:t,add:a,getPrevious:i,clear:s,remove:o,getCurrent:n};return u}]),angular.module("mobile-router").factory("Router",["RouterConfig","$templateCache","$log","$filter","RouteStack","$rootScope","$timeout","$q","$injector","$location","Auth",function(e,t,n,a,i,o,r,s,l,c,u){function d(e){return e.toString().replace(/\/$/,"").replace(/^\//,"")}function p(){return i.getPrevious(E.currentPath)}function m(e){for(var t=0;t<E.routes.length;t++)if(E.routes[t].path==e)return!0;return!1}function f(){return a("filter")(E.routes,{path:E.currentPath})[0]}function g(){var t=null;if(void 0!==e.options.id){i.init(e.options.id);var a=i.getCurrent();if(void 0!==e.options.startPage)t=e.options.startPage,y(T(t).actions);else if(void 0!==T(a)){t=a;var o=T(a);y(o.actions)}else{var r=E.routes[0];angular.forEach(E.routes,function(e){e.start===!0&&(r=e)}),void 0!=r?(t=r.path,y(r.actions)):n.error("No first page available")}null!==t&&(window.location.hash="#"+t,window.dispatchEvent(new CustomEvent("hashchange")))}}function v(e,a){if(void 0!=e)if(m(e)===!1){var i=d(e),o=a.templateUrl?a.templateUrl:i+".tpl.html";void 0!=a.template&&t.put(o,a.template),E.routes.push({path:e,id:i,templateUrl:o,possibilities:a.possibilities,actions:a.actions,start:a.start,auth:a.auth})}else n.error("Duplicate route names are not allowed.")}function h(){var e=window.location.href.match(/#(.*)$/);if(null!==e)return e[1]}function y(e){if(void 0!==e&&e.length>0){var t=l.get("ActionFactory");return t.triggerEvent("onload",e)}var n=s.defer();return n.resolve(),n.promise}function b(e){var t=s.defer();return e.auth===!0?u.authenticate().then(function(){t.resolve()})["catch"](function(e){t.reject(e)}):t.resolve(),t.promise}function $(e){e=e?e:"",o.back=i.getPrevious()==e;var t=T(e);void 0!==t&&b(t).then(function(){y(t.actions).then(function(){c.path(e)})})["catch"](function(e){o.errorMessage=e,c.path("/error")})}function w(e){var t=void 0;return angular.forEach(E.routes,function(n){void 0===t&&n.id==e&&(t=n)}),t}function T(e){var t=void 0;return angular.forEach(E.routes,function(n){void 0===t&&n.path==e&&(t=n)}),t}function S(e){var t=!1;return angular.forEach(E.views,function(n){n.path==e&&(t=!0)}),t}function x(){var t=f();if(void 0!=t)switch(e.options.mode){case"allin":angular.forEach(E.routes,function(e){S(e.path)===!1&&E.views.push(e)}),r(function(){E.animate=!0},1500);break;case"single":E.views=[t],r(function(){E.animate=!0},1500);break;case"intelligent":default:S(t.path)===!1&&E.views.push(t),r(function(){angular.forEach(t.possibilities,function(e){var t=w(e);void 0!=t&&S(t.path)===!1&&E.views.push(t)})},500),r(function(){E.animate=!0},1500)}}function A(e){E.currentPath!=e&&(E.currentPath=e,"/error"!=e&&i.add(e),x())}var E={routes:[],views:[],animate:!1,currentPath:null,getCurrent:f,init:g,addRoute:v,go:$,lastRoute:p};return window.onhashchange=function(e){if(e.newURL!=e.oldURL||void 0===e.newURL&&void 0===e.oldURL){var t=h();void 0!=t&&""!=t&&(o.$$phase?A(t):o.$apply(function(){A(t)}))}},E}]),angular.module("mobile-router").directive("mobileView",["Router","RouterConfig","StoreFactory","localStorageService","$rootScope","LoadingStatus","$timeout","Platform",function(e,t,n,a,i,o,r,s){return{restrict:"A",template:['<div class="preview-bar" ng-if="$root.cancelable">','   <a href="javascript:void(0)" ng-click="view.exit()">','       <span class="fa fa-arrow-circle-left"></span> BACK',"   </a>",'   <a href="javascript:void(0)" ng-click="view.toggle()" class="drop-menu">','       <span class="fa fa-ellipsis-h"></span>',"   </a>","</div>",'<nav class="drop-menu-nav" ng-class="{\'open\': (view.open && $root.cancelable)}">','   <a href="javascript:void(0)" ng-click="view.reset()">','       <span class="fa fa-trash"></span> Reset',"   </a>","</nav>","<div class=\"app-container\" ng-class=\"{'loading': (view.load.loading), 'cancelable': ($root.cancelable)}\">",'   <div class="loader-container alert alert-primary">','       <span ng-if="view.load.loading" class="fa fa-spinner fa-spin"></span> {{view.load.message | translate}}',"   </div>",'   <div ng-repeat="route in view.router.views" id="{{route.id}}" page-info ng-controller="PageController as page" class="page-container {{view.config.options.animation}}" ng-class="{\'current\': (view.router.currentPath == route.path), \'animate\': (view.router.animate == true)}">','       <div class="flexbox-container" ng-form name="pageForm" md-form ng-include="route.templateUrl"></div>','       <div md-dom-ready="view.onDomReady(route)" ng-if="view.router.currentPath == route.path"></div>',"   </div>","</div>"].join(""),controller:function(){var l=this;l.router=e,l.config=t,l.load=o,l.exit=function(){if(i.cancelable){var e=null!==a.get("cancelUrl")?a.get("cancelUrl"):a.get("backUrl");null!==e&&(a.remove("backUrl"),a.remove("appName"),n.set("env.exit","cancel"),window.location.href=e)}},l.open=!1,l.toggle=function(){l.open=!l.open},l.reset=function(){i.cancelable&&(n.destroyAllData(),window.location.reload())},l.onDomReady=function(e){r(function(){if(i.$emit("onPageContentLoaded",e),"ios"===s.getName()){var t=document.querySelector("#"+e.id),n=Array.prototype.slice.call(t.querySelectorAll(".scrollable-item"),0);n.forEach(function(e){e.classList.remove("scrollable-item-ios"),setTimeout(function(){e.classList.add("scrollable-item-ios")},100)})}},0)}},controllerAs:"view"}}]),angular.module("mobile-router").directive("endOfRender",["Router",function(e){return{restrict:"E",link:function(t){console.log("END OF RENDER: ",t.route.id),e.rendered=!0}}}]),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/area/mdList/mdList.tpl.html",'\n<div class="md-list" id=\'{{name}}\' ng-init="listFilter = {}" ng-if="show">\n    <div class="top" ng-if="search">\n        <div class="input-group">\n            <span class="input-group-addon"><span class="fa fa-search"></span></span>\n            <input type="text" class="form-control" ng-model="listFilter.text">\n        </div>\n    </div>\n    <div class="scrollable">\n        <ul class="{{listClasses}}" ng-switch="model != undefined">\n            <li ng-switch-when="false" class="{{listItemClasses}}" ng-repeat="$item in content | filter:listFilter.text track by $index" ng-click="clickListItem($index)"><span compile-list-row item="$item" row-template="{{row | translate}}"></span><div ng-if="edit" class="remove-icon" ng-click="remove($index)"><span class="icon icon-cross"></span></div></li>\n            <li ng-switch-when="true" class="{{listItemClasses}}" ng-repeat="$item in model | store:listFilter.text track by $index" ng-click="clickListItem($index)"><span compile-list-row item="$item" row-template="{{row | translate}}"></span><div ng-if="edit" class="remove-icon" ng-click="remove($index)"><span class="icon icon-cross"></span></div></li>\n        </ul>\n    </div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/md-barcode.tpl.html",'<div class="barcode-group" md-actions="{{actions}}">\n\n    <div class="code-display" ng-if="displayValue !== false" ng-class="{\'placeholder\': (!inputModel)}">{{inputModel || \'--\'}}</div>\n\n    <button class="btn btn-primary btn-lg" type="button">\n        <span ng-if="codeType === \'bar\'">\n            <span class="fa fa-barcode"></span> {{ \'Capture Barcode\' | translate }}\n        </span>\n        <span ng-if="codeType === \'qr\'">\n            <span class="fa fa-qrcode"></span> {{ \'Capture QR Code\' | translate }}\n        </span>\n    </button>\n\n    <input type="hidden" validation="{{validators}}" name="{{::name}}" id="{{::name}}" ng-model="inputModel" ng-required="required" class="form-control" />\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/md-checkbox.tpl.html",'<div class="container md-checkbox-container">\n    <div class="checkbox-element" ng-repeat="option in options track by $index" ng-class="{\'vertical\': ($parent.$parent.vertical == true)}">\n        <div class="md-checkbox" ng-class="{ \'no-label\': !option.label, selected: (model[option.id] == true), \'md-checkbox-disabled\': disabled }"\n             md-actions="{{ actions }}"\n             ng-click="makeSelection(option.id)">\n            <span class="fa" ng-class="getClasses(option)"></span>\n            <span>{{option.label | translate}}</span>\n        </div>\n    </div>\n    <input type="hidden" name="{{name}}" validation="{{validators}}" ng-required="{{required}}" ng-model="model" />\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/md-radio.tpl.html",'<div class="container md-checkbox-container">\n    <div class="checkbox-element" ng-repeat="option in options track by $index">\n        <div class="md-checkbox" ng-class="{ \'no-label\': !option.label, selected: (model == option.value), \'md-radio-disabled\': (disabled) }"\n             md-actions="{{ actions }}"\n             ng-click="makeSelection(option.value)">\n            <span class="fa" ng-class="getClasses(option)"></span>\n            <span>{{option.label | translate}}</span>\n        </div>\n    </div>\n    <input type="hidden" name="{{name}}" validation="{{validators}}" ng-required="{{required}}" ng-model="model" />\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/record-audio.tpl.html",'<div class="{{classes}}" ng-class="{ \'audio-recorder-small\': smallrecorder, \'audio-recorder\': !smallrecorder }">\n    <a class="record-button" ng-click="recordButton()" ng-class="{ \'record-active\': state == 2, \'record-populated\': (isPopulated && !multiple) }">\n        <span class="fa fa-stack fa-2x">\n            <i id="mic-background" class="fa fa-stack-2x" ng-class="multiple ? (state == 2 ? \'fa-circle\' : \'fa-circle-thin\') : (state == 2 || isPopulated ? \'fa-circle\' : \'fa-circle-thin\')"></i>\n            <i id="mic-foreground" class="fa fa-microphone fa-stack-1x"></i>\n        </span>\n    </a>\n    <div ng-if="!smallrecorder" class="current-time">\n        {{currentTime}}\n    </div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/imageViewer/imageViewer.tpl.html",'<div class="image-viewer-container {{classes}}" ng-class="{\'dynamic\': (multiple || (image === undefined))}">\n    <div class="image-frame" ng-if="multiple" ng-repeat="fileURI in files track by $index" ng-switch="getFileType(fileURI)">\n        <img ng-switch-when="image" md-thumbnail="{{fileURI}}" md-thumbnail-maxwidth="200" md-thumbnail-maxheight="200" ng-click="open($index)"/>\n        <div ng-switch-when="audio" class="media-player text-center" ng-click="open($index)"><span class="fa fa-file-audio-o fa-3x"></span><br><br><span>{{getViewableFilePath(fileURI)}}</span></div>\n    </div>\n    <div class="image-frame no-data" ng-if="(multiple && files.length === 0) || (!multiple && image === undefined)">\n        <span class="fa fa-picture-o"></span>\n        {{ \'No sources have been added.\' | translate }}\n    </div>\n    <img md-thumbnail="{{image | trusted}}" md-thumbnail-maxwidth="{{maxWidth}}" md-thumbnail-maxheight="{{maxHeight}}" ng-if="!multiple && image !== undefined && scaleImage" ng-click="open($index)"/>\n    <img ng-src="{{image | trusted}}" ng-if="!multiple && image !== undefined && !scaleImage"/>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/imageViewer/imageViewerDisplay.tpl.html",'<div class="image-viewer-display-container"><div class="image-frame"><img ng-src="{{src}}" /></div><div class="image-footer"><a href="javascript:void(0)" class="danger" ng-click="delete()"><span class="fa fa-trash"></span> Delete</a><a href="javascript:void(0)" class="warning"><span class="fa fa-camera"></span> Retake</a><a href="javascript:void(0)" ng-click="close()" class="primary"><span class="fa fa-close"></span> Close</a></div></div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/mediaPlayer/audioPlayer.tpl.html","<div class=\"audio-player\" ng-class=\"{'play-active': (ap.info.state === 'running'), 'play-idle': (ap.info.state !== 'running'), 'disabled': (ap.info.state === null)}\">\n"+'    <a class="play-button" ng-click="ap.button()" ng-disabled="ap.info.state === null">\n        <span class="fa fa-stack fa-2x">\n            <i id="play-background" class="fa fa-stack-2x" ng-class="{\'fa-square\': (ap.info.state === \'running\'), \'fa-circle\': (ap.info.state !== \'running\')}"></i>\n            <i id="play-foreground" class="fa fa-stack-1x" ng-class="{\'fa-pause\': (ap.info.state === \'running\'), \'fa-play\': (ap.info.state !== \'running\')}"></i>\n        </span>\n    </a>\n    <span class="current-time">{{ap.info.currentTime}}</span>\n    <div class="timeline">\n        <div class="filler"></div>\n    </div>\n    <span class="total-time">{{ap.info.totalTime}}</span>\n    <!--<div class="loader" ng-if="ap.load === true">Loading...</div>-->\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/mediaPlayer/mediaPlayer.tpl.html",'<div class="media-player-container {{classes}}" ng-class="{\'dynamic\': (model)}">\n    <div ng-if="itemType == \'audio\'">\n        <audio-player name="{{name}}_player" src="{{src | trusted}}"></audio-player>\n    </div>\n    <div ng-if="itemType == \'video\'">\n        <video type="video/mp4" ng-src="{{src | trusted}}" controls></video>\n    </div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/alert/alert.tpl.html",'<div class="alert" ng-class="[type ? \'alert-\' + type : null]">\n  <button type="button" class="close" ng-if="dismissable" ng-click="$hide()">&times;</button>\n  <strong ng-bind="title"></strong>&nbsp;<span ng-bind-html="content"></span>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/aside/aside.tpl.html",'<div class="aside" tabindex="-1" role="dialog">\n  <div class="aside-dialog">\n    <div class="aside-content">\n      <div class="aside-header" ng-show="title">\n        <button type="button" class="close" ng-click="$hide()">&times;</button>\n        <h4 class="aside-title" ng-bind="title"></h4>\n      </div>\n      <div class="aside-body" ng-bind="content"></div>\n      <div class="aside-footer">\n        <button type="button" class="btn btn-default" ng-click="$hide()">Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/datepicker/datepicker.tpl.html",'<div class="dropdown-menu datepicker" ng-class="\'datepicker-mode-\' + $mode" style="max-width: 320px;">\n<table style="table-layout: fixed; height: 100%; width: 100%;">\n  <thead>\n    <tr class="text-center">\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$selectPane(-1)">\n          <i class="{{$iconLeft}}"></i>\n        </button>\n      </th>\n      <th colspan="{{ rows[0].length - 2 }}">\n        <button tabindex="-1" type="button" class="btn btn-default btn-block text-strong"  ng-click="$toggleMode()">\n          <strong style="text-transform: capitalize;" ng-bind="title"></strong>\n        </button>\n      </th>\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-right" ng-click="$selectPane(+1)">\n          <i class="{{$iconRight}}"></i>\n        </button>\n      </th>\n    </tr>\n    <tr ng-show="showLabels" ng-bind-html="labels"></tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="(i, row) in rows" height="{{ 100 / rows.length }}%">\n      <td class="text-center" ng-repeat="(j, el) in row">\n        <button tabindex="-1" type="button" class="btn btn-default" style="width: 100%" ng-class="{\'btn-primary\': el.selected, \'btn-info btn-today\': el.isToday && !el.selected}" ng-click="$select(el.date)" ng-disabled="el.disabled">\n          <span ng-class="{\'text-muted\': el.muted}" ng-bind="el.label"></span>\n        </button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/dropdown/dropdown.tpl.html",'<ul tabindex="-1" class="dropdown-menu" role="menu">\n  <li role="presentation" ng-class="{divider: item.divider}" ng-repeat="item in content" >\n    <a role="menuitem" tabindex="-1" ng-href="{{item.href}}" ng-if="!item.divider && item.href" target="{{item.target || \'\'}}" ng-bind="item.text"></a>\n    <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()" ng-bind="item.text"></a>\n  </li>\n</ul>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/modal/modal.tpl.html",'<div class="modal" tabindex="-1" role="dialog">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header" ng-show="title">\n        <button type="button" class="close" ng-click="$hide()">&times;</button>\n        <h4 class="modal-title" ng-bind="title"></h4>\n      </div>\n      <div class="modal-body" ng-bind="content"></div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" ng-click="$hide()">Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/popover/popover.tpl.html",'<div class="popover">\n  <div class="arrow"></div>\n  <h3 class="popover-title" ng-bind="title" ng-show="title"></h3>\n  <div class="popover-content" ng-bind="content"></div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/select/select.tpl.html",'<ul tabindex="-1" class="select dropdown-menu" ng-show="$isVisible()" role="select">\n  <li ng-if="$showAllNoneButtons">\n    <div class="btn-group" style="margin-bottom: 5px; margin-left: 5px">\n      <button class="btn btn-default btn-xs" ng-click="$selectAll()">All</button>\n      <button class="btn btn-default btn-xs" ng-click="$selectNone()">None</button>\n    </div>\n  </li>\n  <li role="presentation" ng-repeat="match in $matches" ng-class="{active: $isActive($index)}">\n    <a style="cursor: default;" role="menuitem" tabindex="-1" ng-click="$select($index, $event)">\n      <i class="{{$iconCheckmark}} pull-right" ng-if="$isMultiple && $isActive($index)"></i>\n      <span ng-bind="match.label"></span>\n    </a>\n  </li>\n</ul>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/tab/tab.tpl.html",'<ul class="nav" ng-class="$navClass" role="tablist">\n  <li ng-repeat="$pane in $panes track by $index" ng-class="$index == $panes.$active ? $activeClass : \'\'">\n    <a role="tab" data-toggle="tab" ng-click="$setActive($index)" data-index="{{ $index }}" ng-bind-html="$pane.title"></a>\n  </li>\n</ul>\n<div ng-transclude class="tab-content">\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/timepicker/timepicker.tpl.html",'<div class="dropdown-menu timepicker" style="min-width: 0px;width: auto;">\n<table height="100%">\n  <thead>\n    <tr class="text-center">\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 0)">\n          <i class="{{ $iconUp }}"></i>\n        </button>\n      </th>\n      <th>\n        &nbsp;\n      </th>\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 1)">\n          <i class="{{ $iconUp }}"></i>\n        </button>\n      </th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="(i, row) in rows">\n      <td class="text-center">\n        <button tabindex="-1" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[0].selected}" ng-click="$select(row[0].date, 0)" ng-disabled="row[0].disabled">\n          <span ng-class="{\'text-muted\': row[0].muted}" ng-bind="row[0].label"></span>\n        </button>\n      </td>\n      <td>\n        <span ng-bind="i == midIndex ? timeSeparator : \' \'"></span>\n      </td>\n      <td class="text-center">\n        <button tabindex="-1" ng-if="row[1].date" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[1].selected}" ng-click="$select(row[1].date, 1)" ng-disabled="row[1].disabled">\n          <span ng-class="{\'text-muted\': row[1].muted}" ng-bind="row[1].label"></span>\n        </button>\n      </td>\n      <td ng-if="showAM">\n        &nbsp;\n      </td>\n      <td ng-if="showAM">\n        <button tabindex="-1" ng-show="i == midIndex - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !!isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">AM</button>\n        <button tabindex="-1" ng-show="i == midIndex + 1 - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">PM</button>\n      </td>\n    </tr>\n  </tbody>\n  <tfoot>\n    <tr class="text-center">\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 0)">\n          <i class="{{ $iconDown }}"></i>\n        </button>\n      </th>\n      <th>\n        &nbsp;\n      </th>\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 1)">\n          <i class="{{ $iconDown }}"></i>\n        </button>\n      </th>\n    </tr>\n  </tfoot>\n</table>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/tooltip/tooltip.tpl.html",'<div class="tooltip in" ng-show="title">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="title"></div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/typeahead/typeahead.tpl.html",'<ul tabindex="-1" class="typeahead dropdown-menu" ng-show="$isVisible()" role="select">\n  <li role="presentation" ng-repeat="match in $matches" ng-class="{active: $index == $activeIndex}">\n    <a role="menuitem" tabindex="-1" ng-click="$select($index, $event)" ng-bind="match.label"></a>\n  </li>\n</ul>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/barcode.tpl.html",'<take-barcode code-type="bar" ng-model="$parent.$parent.inputModel"></take-barcode>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/checkbox.tpl.html",'<md-checkbox model="$parent.$parent.inputModel"\n             name="name"\n             required="required"\n             options="options"\n             disabled="disabled"\n             icon-selected="{{iconSelected}}"\n             validators="{{validators}}"\n             actions="{{actions}}"\n             icon-unselected="{{iconUnselected}}">\n</md-checkbox>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/date.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}" >\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="text" pick-a-date="inputModel" pick-a-date-options="options" md-actions="{{actions}}" placeholder="--" class="form-control" ng-disabled="disabled" />\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>\n<input type="hidden" name="{{::name}}" validation="{{validators}}" ng-required="{{required}}" ng-model="inputModel" />')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/datetime.tpl.html",'\n<div class="row datetime-container">\n    <div class="col-xs-6">\n        <div class="input-group">\n            <div class="input-group-addon">\n                <span class="fa fa-calendar"></span>\n            </div>\n            <input type="text" validation="{{validators}}" pick-a-date date-value="$parent.$parent.inputModel" min="min" max="max" ng-model="dateModel" class="form-control" name="{{::name}}" id="{{::name}}" placeholder="{{::placeholder}}" ng-required="{{required}}" ng-disabled="disabled">\n        </div>\n    </div>\n    <div class="col-xs-6">\n        <div class="input-group">\n            <div class="input-group-addon">\n                <span class="fa fa-calendar"></span>\n            </div>\n            <input type="text" validation="{{validators}}" pick-a-time date-value="$parent.$parent.inputModel" tmin="tmin" tmax="tmax" ng-model="dateModel" class="form-control" name="{{::name}}" id="{{::name}}" placeholder="{{::placeholder}}" ng-required="{{required}}" ng-disabled="disabled">\n        </div>\n    </div>\n</div>\n\n');
}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/email.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}">\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="email" md-actions="{{actions}}" valid-email validation="{{validators}}" class="form-control" id="{{::name}}" name="{{::name}}" placeholder="{{::placeholder}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.inputModel" ng-model-options="{debounce: { \'default\': 500, \'blur\': 0 }}">\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/number.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}">\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="number" validation="{{validators}}" md-actions="{{actions}}" min="{{min}}" max="{{max}}" class="form-control" id="{{::name}}" name="{{::name}}" placeholder="{{::placeholder}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.inputModel" ng-model-options="{debounce: { \'default\': 500, \'blur\': 0 }}" number-format decimal-places="{{::decimals}}" />\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/password.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}">\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="password" validation="{{validators}}" md-actions="{{actions}}" class="form-control" id="{{::name}}" name="{{::name}}" placeholder="{{::placeholder}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.inputModel" ng-model-options="{debounce: { \'default\': 500, \'blur\': 0 }}" />\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/photo.tpl.html",'<take-photo ng-model="$parent.$parent.inputModel" image-url="$parent.$parent.inputModel" quality="quality" source="source" disabled="disabled" destination="destination"></take-photo>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/qrcode.tpl.html",'<take-barcode code-type="qr" ng-model="$parent.$parent.inputModel"></take-barcode>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/radio.tpl.html",'<md-radio model="$parent.$parent.inputModel"\n          name="name"\n          required="required"\n          options="options"\n          disabled="disabled"\n          icon-selected="{{iconSelected}}"\n          validators="{{validators}}"\n          actions="{{actions}}"\n          icon-unselected="{{iconUnselected}}">\n</md-radio>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/range-slider.tpl.html",'<md-range-slider name="name"\n                 model="$parent.$parent.inputModel"\n                 required="required"\n                 disabled="disabled"\n                 validators="{{validators}}"\n                 min="{{min}}"\n                 max="{{max}}"\n                 step="{{step}}"\n                 actions="actions">\n</md-range-slider>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/rating.tpl.html",'<div star-rating\n     class="star-rating"\n     rating-value="$parent.$parent.inputModel"\n     max="max || 5"\n     on-rating-selected="inputModel = rating; updateInputValue(rating);"\n     actions="actions"\n     disabled="disabled">\n</div>\n<input type="hidden" md-actions="{{actions}}" validation="{{validators}}" ng-model="$parent.$parent.inputModel" name="{{::name}}" ng-required="{{required}}" />\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/recordAudio.tpl.html",'<record-audio name="{{name}}" model="{{key}}" label="{{label}}" small-player="smallplayer" actions="actions"></record-audio>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/select.tpl.html",'<select ng-if="!searchable"\n        md-select\n        id="{{:: name }}"\n        name="{{:: name }}"\n        ng-model="$parent.$parent.$parent.inputModel"\n        ng-options="option.label group by option.group for option in $parent.options track by option.value"\n        ng-change="$parent.$parent.$parent.userInput()"\n        ng-required="{{ required }}"\n        ng-disabled="disabled"\n        ng-class="{ disabled: disabled }"\n        md-actions="{{ actions }}"\n        validation="{{ validators }}"\n        class="form-control">\n    <option value="">{{ \'Please select...\' | translate }}</option>\n</select>\n\n<div ng-if="searchable">\n    <ol class="nya-bs-select"\n        data-live-search="true"\n        data-size="5"\n        ng-model="$parent.$parent.$parent.inputModel"\n        ng-disabled="disabled"\n        md-actions="{{ actions }}">\n        <li nya-bs-option="option in $parent.options group by option.group track by option.value">\n            <span class="dropdown-header" ng-if="$group">{{ $group | translate }}</span>\n            <a>{{ option.label | translate }}</a>\n        </li>\n    </ol>\n    <input type="hidden" ng-model="$parent.$parent.inputModel" validation="{{validators}}" name="{{::name}}" ng-required="{{required}}"/>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/signature.tpl.html",'<input type="hidden" validation="{{validators}}" name="{{::name}}" ng-model="$parent.$parent.inputModel" ng-required="{{required}}" />\n<div class="signature-frame">\n    <div class="canvas-frame">\n        <canvas md-signature ng-model="$parent.$parent.inputModel" disabled="disabled" md-actions="{{actions}}"></canvas>\n        <div class="sign-line"></div>\n    </div>\n    <div class="controls">\n        <button class="btn btn-default" ng-click="$parent.$parent.inputModel = undefined;" ng-disabled="disabled">{{ \'Clear signature\' | translate }}</button>\n    </div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/slider.tpl.html",'<md-slider name="name"\n           model="$parent.$parent.inputModel"\n           required="required"\n           disabled="disabled"\n           validators="{{validators}}"\n           min="{{min}}"\n           max="{{max}}"\n           step="{{step}}"\n           actions="actions">\n</md-slider>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/smiley.tpl.html",'\n<div class="smiley-container">\n    <a href="javascript:void(0)" class="smile" ng-class="{\'active\': ($parent.$parent.inputModel == true)}" ng-click="$parent.$parent.inputModel = true; $parent.$parent.updateStore(true)"><span class="icon icon-smile"></span></a>\n    <a href="javascript:void(0)" class="frown" ng-class="{\'active\': ($parent.$parent.inputModel == false)}" ng-click="$parent.$parent.inputModel = false; $parent.$parent.updateStore(false)"><span class="icon icon-sad"></span></a>\n</div>\n<input type="hidden" validation="{{validators}}" name="{{::name}}" ng-model="$parent.$parent.inputModel" ng-required="{{required}}" />\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/switch.tpl.html",'<div class="switch-container">\n\n    <span class="switch"\n          ng-class="{ checked: $parent.$parent.inputModel, disabled: disabled }"\n          id="{{::name}}"\n          name="{{::name}}">\n\n        <small></small>\n\n        <input type="checkbox"\n               name="{{::name}}"\n               ng-disabled="disabled"\n               ng-model="$parent.$parent.inputModel"\n               md-actions="{{actions}}"\n               validation="{{validators}}"\n               ng-required="{{required}}"\n               style="width: 100%; height: 100%; margin: 0; opacity: 0; cursor: pointer;"\n               class="ng-pristine ng-untouched ng-valid"\n               ng-hide="disabled"\n               ng-model-options="{ debounce: 0, allowInvalid: true }" />\n\n        <span class="switch-text">\n            <span class="on" ng-if="$parent.$parent.inputModel === true">{{ onText | translate }}</span>\n            <span class="off" ng-if="$parent.$parent.inputModel !== true">{{ offText | translate }}</span>\n        </span>\n\n    </span>\n\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/text.tpl.html",'<div ng-switch="multi">\n    <div ng-switch-when="false" ng-class="{\'input-group\': (leftIcon || rightIcon)}">\n        <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n        <input type="text" validation="{{validators}}" md-actions="{{actions}}" class="form-control" id="{{::name}}" name="{{::name}}" placeholder="{{::placeholder | translate}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.$parent.inputModel" ng-model-options="{debounce: { \'default\': debounce, \'blur\': 0 }}" />\n        <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n    </div>\n    <textarea ng-switch-when="true" class="form-control" validation="{{validators}}" md-actions="{{actions}}" id="{{::name}}" name="{{::name}}" placeholder="{{::placeholder | translate}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.$parent.inputModel" rows="3" ng-model-options="{debounce: { \'default\': debounce, \'blur\': 0 }}">{{default | translate}}</textarea>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/time.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}" id="{{::name}}">\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="text" pick-a-time="inputModel" pick-a-time-options="options" md-actions="{{actions}}" placeholder="--" class="form-control" ng-disabled="disabled" />\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>\n<input type="hidden" name="{{::name}}" validation="{{validators}}" ng-required="{{required}}" ng-model="inputModel" />')}])}();